{{ define "users/index.html" }}

{{ template "shared/_header.html" .}}

<div class="box">
  <div class="box-header">
    <h1 class="h2">Users</h1>
  </div>

  <div class="box-content">


    <div class="is-flex">
      {{ if .CurrentUser.IsAdmin }}
      <button class="button is-primary mr-6 filter-button-offset" data-modal="modal-one" data-xhr-url="/users/new?modal=true">Add new user</button>
      {{ else if userCan .CurrentUser "UserCreate" .CurrentUser.InstitutionID }}
      <a class="button is-primary mr-6" href="/users/new?institution_id={{ .CurrentUser.InstitutionID }}">Add new user</a>
      {{ end }}

      {{ if .CurrentUser.IsAdmin }}
      {{ template "users/_filters.html" . }}
      {{ end }}
    </div>
  </div>

  <table class="table is-fullwidth has-padding is-hoverable">
    <thead>
      <tr>
        <th class="pl-5"><a href="{{ sortUrl .currentUrl `name` }}">Name</a></th>
        <th><a href="{{ sortUrl .currentUrl `email` }}">Email</a></th>
        <th><a href="{{ sortUrl .currentUrl `institution_name` }}">Institution</a></th>
        <th><a href="{{ sortUrl .currentUrl `role` }}">Role</a></th>
        <th><a href="{{ sortUrl .currentUrl `last_sign_in_at` }}">Last Sign In</a></th>
        <th><a href="{{ sortUrl .currentUrl `enabled_two_factor` }}">2FA</a></th>
        <th><a href="{{ sortUrl .currentUrl `deactivated_at` }}">Disabled</a></th>
      </tr>
    </thead>
    <tbody>
          <!-- .items type is UsersView, not User -->
        {{ range $index, $user := .items }}
        {{ $cssClass := "clickable" }}
        {{ if not $user.DeactivatedAt.IsZero }}
          {{ $cssClass = "clickable row-disabled" }}
        {{ end }}
      <tr class="{{ $cssClass }}" onclick="window.location.href='/users/show/{{ $user.ID }}'">
        <td class="pl-5">{{ $user.Name }}</td>
        <td class="is-grey-dark">{{ $user.Email }}</td>
        <td class="is-grey-dark">{{ $user.InstitutionName }}</td>
        <td class="is-grey-dark">{{ roleName $user.Role }}</td>
        <td class="is-grey-dark">{{ dateUS $user.LastSignInAt }}</td>
        <td class="is-grey-dark">{{ yesNo $user.EnabledTwoFactor }}</td>
        <td class="is-grey-dark">{{ dateUS $user.DeactivatedAt }}</td>
      </tr>
      {{ end }}
    </tbody>
  </table>

  {{ template "shared/_pager.html" dict "pager" .pager }}
</div>

{{ template "shared/_footer.html" .}}


{{ end }}
