{{ define "objects/_file_summary.html" }}

<div class="row">
  <div class="column column-100">
    <h2>File Summary</h2>
  </div>
</div>

<div class="row">
  <div class="column column-50">
    <table>
      <thead>
        <th>Format</th>
        <th>Count</th>
        <th>Size</th>
      </thead>
      <tbody>
        {{ range $index, $stat := .depositFormatStats }}
          {{ if eq $stat.FileFormat "Total" }}
            <tr class="total">
          {{ else }}
            <tr>
          {{ end }}
              <td>{{ $stat.FileFormat }}</td>
              <td>{{ $stat.FileCount }}</td>
              <td>{{ humanSize $stat.TotalBytes }}</td>
            </tr>
        {{ end }}
      </tbody>
    </table>
  </div>

  <div class="column column-25">
    <p>Files by Size (GB)</p>
    <canvas id="sizeChart"></canvas>
  </div>

  <div class="column column-25">
    <p>Files by Count</p>
    <canvas id="countChart"></canvas>
  </div>

</div>


<script>

 const depositData = {{ toJSON .depositFormatStats }};

 function renderChart(elementID, metric, label) {
     let ctx = document.getElementById(elementID);
     let data = buildChartData(metric, label)
     return new Chart(ctx, { type: 'doughnut', data: data })
 }

 function buildChartData(metric, label) {
     let labels = getLabels()
     return {
         labels: labels,
         datasets: [{
             label: label,
             data: getDepositData(metric),
             backgroundColor: window.APT.chartColors('fill', labels.length),
             borderColor: window.APT.chartColors('border', labels.length),
             borderWidth: 1
         }],
         hoverOffset: 4
     }
 }

 function getDepositData(metric) {
     return depositData.filter(item => item.file_format != 'Total').map(item => item[metric]);
 }

 function getLabels() {
     return depositData.filter(item => item.file_format != 'Total').map(item => item.file_format);
 }

 // Render the chart after APTLoaded (aptLoadEvent) because it depends
 // on APT.chartColors.
 window.addEventListener('APTLoaded', (event) => {
     renderChart("sizeChart", "total_gb", "File Distribution by Size")
     renderChart("countChart", "file_count", "File Distribution by Count")
 });

</script>

{{ end }}
