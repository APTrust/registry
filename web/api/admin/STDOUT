{"level":"info","time":"2022-06-22T13:30:27-04:00","message":"Email service is disabled. Alerts will be written to the log file."}
{"level":"info","time":"2022-06-22T13:30:27-04:00","message":"Two-factor SMS is disabled. OTP codes will be written to the log file."}
{"level":"info","time":"2022-06-22T13:30:27-04:00","message":"Initializing cron jobs"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"info","time":"2022-06-22T13:30:27-04:00","message":"cron: starting update_counts() to refresh views"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: select update_counts()"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"info","time":"2022-06-22T13:30:27-04:00","message":"cron: update_counts completed after 0.097987 seconds"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:27-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: select update_counts();"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT \"institution\".\"id\", \"institution\".\"created_at\", \"institution\".\"updated_at\", \"institution\".\"name\", \"institution\".\"identifier\", \"institution\".\"state\", \"institution\".\"type\", \"institution\".\"member_institution_id\", \"institution\".\"deactivated_at\", \"institution\".\"otp_enabled\", \"institution\".\"enable_spot_restore\", \"institution\".\"receiving_bucket\", \"institution\".\"restore_bucket\" FROM \"institutions\" AS \"institution\" WHERE ((identifier = 'aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: UPDATE \"users\" AS \"user\" SET \"created_at\" = '2021-01-12 17:14:00+00:00:00', \"updated_at\" = '2022-06-22 17:30:28.913062+00:00:00', \"name\" = 'APTrust System', \"email\" = 'system@aptrust.org', \"phone_number\" = '+14345551212', \"encrypted_password\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"reset_password_token\" = NULL, \"reset_password_sent_at\" = NULL, \"remember_created_at\" = NULL, \"sign_in_count\" = 2, \"current_sign_in_at\" = '2022-06-22 17:30:28.913052+00:00:00', \"last_sign_in_at\" = NULL, \"current_sign_in_ip\" = NULL, \"last_sign_in_ip\" = '127.0.0.1', \"institution_id\" = 1, \"encrypted_api_secret_key\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"password_changed_at\" = NULL, \"encrypted_otp_secret\" = NULL, \"encrypted_otp_secret_iv\" = NULL, \"encrypted_otp_secret_salt\" = NULL, \"encrypted_otp_sent_at\" = NULL, \"consumed_timestep\" = NULL, \"otp_required_for_login\" = NULL, \"deactivated_at\" = NULL, \"enabled_two_factor\" = NULL, \"confirmed_two_factor\" = NULL, \"otp_backup_codes\" = NULL, \"authy_id\" = NULL, \"last_sign_in_with_authy\" = NULL, \"authy_status\" = NULL, \"email_verified\" = TRUE, \"initial_password_updated\" = TRUE, \"force_password_update\" = NULL, \"grace_period\" = '1999-12-31 23:59:00+00:00:00', \"awaiting_second_factor\" = FALSE, \"role\" = 'admin' WHERE \"user\".\"id\" = 1"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":302,"method":"POST","path":"/users/sign_in","ip":"","latency":75.679822,"user-agent":"","time":"2022-06-22T13:30:28-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" ORDER BY \"date_processed\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT \"alert_view\".\"id\", \"alert_view\".\"institution_id\", \"alert_view\".\"institution_name\", \"alert_view\".\"institution_identifier\", \"alert_view\".\"type\", \"alert_view\".\"subject\", \"alert_view\".\"content\", \"alert_view\".\"deletion_request_id\", \"alert_view\".\"created_at\", \"alert_view\".\"user_id\", \"alert_view\".\"user_name\", \"alert_view\".\"sent_at\", \"alert_view\".\"read_at\" FROM \"alerts_view\" AS \"alert_view\" WHERE ((user_id = 1)) ORDER BY \"created_at\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: \n\t\tselect\n\t\t  coalesce(stats.institution_name, 'Total') as institution_name,\n\t\t  i2.id as institution_id,\n\t\t  coalesce(stats.storage_option, 'Total') as storage_option,\n\t\t  stats.file_count,\n\t\t  stats.object_count,\n\t\t  stats.total_bytes,\n\t\t  (stats.total_bytes / 1073741824) as total_gb,\n\t\t  (stats.total_bytes / 1099511627776) as total_tb,\n\t\t  so.cost_gb_per_month,\n\t\t  ((stats.total_bytes / 1073741824) * so.cost_gb_per_month) as monthly_cost\n\t\tfrom\n\t\t  (select\n\t\t\ti.\"name\" as institution_name,\n\t\t\tcount(gf.id) as file_count,\n\t\t\tcount(distinct(gf.intellectual_object_id)) as object_count,\n\t\t\tsum(gf.size) as total_bytes,\n\t\t\tgf.storage_option\n\t\t  from generic_files gf\n\t\t  left join institutions i on i.id = gf.institution_id\n\t\t  where gf.state = 'A'\n\t\t  and (0 = 0 or i.id = 0)\n\t\t  and ('' = '' or gf.storage_option = '')\n\t\t  and ('2022-06-22 17:30:28.926152+00:00:00' = '0001-01-01 00:00:00+00:00:00' or gf.updated_at < '2022-06-22 17:30:28.926152+00:00:00')\n\t\t  group by cube (i.\"name\", gf.storage_option)) stats\n\t\tleft join storage_options so on so.\"name\" = stats.storage_option\n\t\tleft join institutions i2 on i2.\"name\" = stats.institution_name\n\t\torder by stats.institution_name, stats.storage_option\n"}
{"level":"info","status":200,"method":"GET","path":"/dashboard","ip":"","latency":36.037057,"user-agent":"","time":"2022-06-22T13:30:28-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:28-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst1.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: UPDATE \"users\" AS \"user\" SET \"created_at\" = '2021-01-12 17:14:00+00:00:00', \"updated_at\" = '2022-06-22 17:30:29.020749+00:00:00', \"name\" = 'Inst One Admin', \"email\" = 'admin@inst1.edu', \"phone_number\" = '+14345551212', \"encrypted_password\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"reset_password_token\" = NULL, \"reset_password_sent_at\" = NULL, \"remember_created_at\" = NULL, \"sign_in_count\" = 1, \"current_sign_in_at\" = '2022-06-22 17:30:29.020748+00:00:00', \"last_sign_in_at\" = NULL, \"current_sign_in_ip\" = NULL, \"last_sign_in_ip\" = NULL, \"institution_id\" = 2, \"encrypted_api_secret_key\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"password_changed_at\" = NULL, \"encrypted_otp_secret\" = NULL, \"encrypted_otp_secret_iv\" = NULL, \"encrypted_otp_secret_salt\" = NULL, \"encrypted_otp_sent_at\" = NULL, \"consumed_timestep\" = NULL, \"otp_required_for_login\" = NULL, \"deactivated_at\" = NULL, \"enabled_two_factor\" = NULL, \"confirmed_two_factor\" = NULL, \"otp_backup_codes\" = NULL, \"authy_id\" = NULL, \"last_sign_in_with_authy\" = NULL, \"authy_status\" = NULL, \"email_verified\" = TRUE, \"initial_password_updated\" = TRUE, \"force_password_update\" = NULL, \"grace_period\" = '1999-12-31 23:59:00+00:00:00', \"awaiting_second_factor\" = FALSE, \"role\" = 'institutional_admin' WHERE \"user\".\"id\" = 2"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":302,"method":"POST","path":"/users/sign_in","ip":"","latency":70.379636,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" WHERE ((institution_id = 2)) ORDER BY \"date_processed\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"alert_view\".\"id\", \"alert_view\".\"institution_id\", \"alert_view\".\"institution_name\", \"alert_view\".\"institution_identifier\", \"alert_view\".\"type\", \"alert_view\".\"subject\", \"alert_view\".\"content\", \"alert_view\".\"deletion_request_id\", \"alert_view\".\"created_at\", \"alert_view\".\"user_id\", \"alert_view\".\"user_name\", \"alert_view\".\"sent_at\", \"alert_view\".\"read_at\" FROM \"alerts_view\" AS \"alert_view\" WHERE ((user_id = 2)) ORDER BY \"created_at\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: \n\t\tselect\n\t\t  coalesce(stats.institution_name, 'Total') as institution_name,\n\t\t  i2.id as institution_id,\n\t\t  coalesce(stats.storage_option, 'Total') as storage_option,\n\t\t  stats.file_count,\n\t\t  stats.object_count,\n\t\t  stats.total_bytes,\n\t\t  (stats.total_bytes / 1073741824) as total_gb,\n\t\t  (stats.total_bytes / 1099511627776) as total_tb,\n\t\t  so.cost_gb_per_month,\n\t\t  ((stats.total_bytes / 1073741824) * so.cost_gb_per_month) as monthly_cost\n\t\tfrom\n\t\t  (select\n\t\t\ti.\"name\" as institution_name,\n\t\t\tcount(gf.id) as file_count,\n\t\t\tcount(distinct(gf.intellectual_object_id)) as object_count,\n\t\t\tsum(gf.size) as total_bytes,\n\t\t\tgf.storage_option\n\t\t  from generic_files gf\n\t\t  left join institutions i on i.id = gf.institution_id\n\t\t  where gf.state = 'A'\n\t\t  and (2 = 0 or i.id = 2)\n\t\t  and ('' = '' or gf.storage_option = '')\n\t\t  and ('2022-06-22 17:30:29.026542+00:00:00' = '0001-01-01 00:00:00+00:00:00' or gf.updated_at < '2022-06-22 17:30:29.026542+00:00:00')\n\t\t  group by cube (i.\"name\", gf.storage_option)) stats\n\t\tleft join storage_options so on so.\"name\" = stats.storage_option\n\t\tleft join institutions i2 on i2.\"name\" = stats.institution_name\n\t\torder by stats.institution_name, stats.storage_option\n"}
{"level":"info","status":200,"method":"GET","path":"/dashboard","ip":"","latency":24.7809,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst1.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: UPDATE \"users\" AS \"user\" SET \"created_at\" = '2021-01-12 17:14:00+00:00:00', \"updated_at\" = '2022-06-22 17:30:29.116814+00:00:00', \"name\" = 'Inst One User', \"email\" = 'user@inst1.edu', \"phone_number\" = '+14345551212', \"encrypted_password\" = '$2a$10$raEJqJ7eRcEwWmeoiJ2vxenR8dqVXCI1SU9zcgkrxeS.6/haWGi4K', \"reset_password_token\" = NULL, \"reset_password_sent_at\" = NULL, \"remember_created_at\" = NULL, \"sign_in_count\" = 2, \"current_sign_in_at\" = '2022-06-22 17:30:29.116814+00:00:00', \"last_sign_in_at\" = NULL, \"current_sign_in_ip\" = NULL, \"last_sign_in_ip\" = NULL, \"institution_id\" = 2, \"encrypted_api_secret_key\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"password_changed_at\" = NULL, \"encrypted_otp_secret\" = NULL, \"encrypted_otp_secret_iv\" = NULL, \"encrypted_otp_secret_salt\" = NULL, \"encrypted_otp_sent_at\" = NULL, \"consumed_timestep\" = NULL, \"otp_required_for_login\" = NULL, \"deactivated_at\" = NULL, \"enabled_two_factor\" = NULL, \"confirmed_two_factor\" = NULL, \"otp_backup_codes\" = NULL, \"authy_id\" = NULL, \"last_sign_in_with_authy\" = NULL, \"authy_status\" = NULL, \"email_verified\" = TRUE, \"initial_password_updated\" = TRUE, \"force_password_update\" = NULL, \"grace_period\" = '1999-12-31 23:59:00+00:00:00', \"awaiting_second_factor\" = FALSE, \"role\" = 'institutional_user' WHERE \"user\".\"id\" = 3"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":302,"method":"POST","path":"/users/sign_in","ip":"","latency":70.801184,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" WHERE ((institution_id = 2)) ORDER BY \"date_processed\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"alert_view\".\"id\", \"alert_view\".\"institution_id\", \"alert_view\".\"institution_name\", \"alert_view\".\"institution_identifier\", \"alert_view\".\"type\", \"alert_view\".\"subject\", \"alert_view\".\"content\", \"alert_view\".\"deletion_request_id\", \"alert_view\".\"created_at\", \"alert_view\".\"user_id\", \"alert_view\".\"user_name\", \"alert_view\".\"sent_at\", \"alert_view\".\"read_at\" FROM \"alerts_view\" AS \"alert_view\" WHERE ((user_id = 3)) ORDER BY \"created_at\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: \n\t\tselect\n\t\t  coalesce(stats.institution_name, 'Total') as institution_name,\n\t\t  i2.id as institution_id,\n\t\t  coalesce(stats.storage_option, 'Total') as storage_option,\n\t\t  stats.file_count,\n\t\t  stats.object_count,\n\t\t  stats.total_bytes,\n\t\t  (stats.total_bytes / 1073741824) as total_gb,\n\t\t  (stats.total_bytes / 1099511627776) as total_tb,\n\t\t  so.cost_gb_per_month,\n\t\t  ((stats.total_bytes / 1073741824) * so.cost_gb_per_month) as monthly_cost\n\t\tfrom\n\t\t  (select\n\t\t\ti.\"name\" as institution_name,\n\t\t\tcount(gf.id) as file_count,\n\t\t\tcount(distinct(gf.intellectual_object_id)) as object_count,\n\t\t\tsum(gf.size) as total_bytes,\n\t\t\tgf.storage_option\n\t\t  from generic_files gf\n\t\t  left join institutions i on i.id = gf.institution_id\n\t\t  where gf.state = 'A'\n\t\t  and (2 = 0 or i.id = 2)\n\t\t  and ('' = '' or gf.storage_option = '')\n\t\t  and ('2022-06-22 17:30:29.12232+00:00:00' = '0001-01-01 00:00:00+00:00:00' or gf.updated_at < '2022-06-22 17:30:29.12232+00:00:00')\n\t\t  group by cube (i.\"name\", gf.storage_option)) stats\n\t\tleft join storage_options so on so.\"name\" = stats.storage_option\n\t\tleft join institutions i2 on i2.\"name\" = stats.institution_name\n\t\torder by stats.institution_name, stats.storage_option\n"}
{"level":"info","status":200,"method":"GET","path":"/dashboard","ip":"","latency":21.046226,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst2.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: UPDATE \"users\" AS \"user\" SET \"created_at\" = '2021-01-12 17:14:00+00:00:00', \"updated_at\" = '2022-06-22 17:30:29.208408+00:00:00', \"name\" = 'Inst Two Admin', \"email\" = 'admin@inst2.edu', \"phone_number\" = '+14345551212', \"encrypted_password\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"reset_password_token\" = NULL, \"reset_password_sent_at\" = NULL, \"remember_created_at\" = NULL, \"sign_in_count\" = 1, \"current_sign_in_at\" = '2022-06-22 17:30:29.208407+00:00:00', \"last_sign_in_at\" = NULL, \"current_sign_in_ip\" = NULL, \"last_sign_in_ip\" = NULL, \"institution_id\" = 3, \"encrypted_api_secret_key\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"password_changed_at\" = NULL, \"encrypted_otp_secret\" = NULL, \"encrypted_otp_secret_iv\" = NULL, \"encrypted_otp_secret_salt\" = NULL, \"encrypted_otp_sent_at\" = NULL, \"consumed_timestep\" = NULL, \"otp_required_for_login\" = NULL, \"deactivated_at\" = NULL, \"enabled_two_factor\" = NULL, \"confirmed_two_factor\" = NULL, \"otp_backup_codes\" = NULL, \"authy_id\" = NULL, \"last_sign_in_with_authy\" = NULL, \"authy_status\" = NULL, \"email_verified\" = TRUE, \"initial_password_updated\" = TRUE, \"force_password_update\" = NULL, \"grace_period\" = '1999-12-31 23:59:00+00:00:00', \"awaiting_second_factor\" = FALSE, \"role\" = 'institutional_admin' WHERE \"user\".\"id\" = 5"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":302,"method":"POST","path":"/users/sign_in","ip":"","latency":70.051089,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" WHERE ((institution_id = 3)) ORDER BY \"date_processed\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"alert_view\".\"id\", \"alert_view\".\"institution_id\", \"alert_view\".\"institution_name\", \"alert_view\".\"institution_identifier\", \"alert_view\".\"type\", \"alert_view\".\"subject\", \"alert_view\".\"content\", \"alert_view\".\"deletion_request_id\", \"alert_view\".\"created_at\", \"alert_view\".\"user_id\", \"alert_view\".\"user_name\", \"alert_view\".\"sent_at\", \"alert_view\".\"read_at\" FROM \"alerts_view\" AS \"alert_view\" WHERE ((user_id = 5)) ORDER BY \"created_at\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: \n\t\tselect\n\t\t  coalesce(stats.institution_name, 'Total') as institution_name,\n\t\t  i2.id as institution_id,\n\t\t  coalesce(stats.storage_option, 'Total') as storage_option,\n\t\t  stats.file_count,\n\t\t  stats.object_count,\n\t\t  stats.total_bytes,\n\t\t  (stats.total_bytes / 1073741824) as total_gb,\n\t\t  (stats.total_bytes / 1099511627776) as total_tb,\n\t\t  so.cost_gb_per_month,\n\t\t  ((stats.total_bytes / 1073741824) * so.cost_gb_per_month) as monthly_cost\n\t\tfrom\n\t\t  (select\n\t\t\ti.\"name\" as institution_name,\n\t\t\tcount(gf.id) as file_count,\n\t\t\tcount(distinct(gf.intellectual_object_id)) as object_count,\n\t\t\tsum(gf.size) as total_bytes,\n\t\t\tgf.storage_option\n\t\t  from generic_files gf\n\t\t  left join institutions i on i.id = gf.institution_id\n\t\t  where gf.state = 'A'\n\t\t  and (3 = 0 or i.id = 3)\n\t\t  and ('' = '' or gf.storage_option = '')\n\t\t  and ('2022-06-22 17:30:29.21534+00:00:00' = '0001-01-01 00:00:00+00:00:00' or gf.updated_at < '2022-06-22 17:30:29.21534+00:00:00')\n\t\t  group by cube (i.\"name\", gf.storage_option)) stats\n\t\tleft join storage_options so on so.\"name\" = stats.storage_option\n\t\tleft join institutions i2 on i2.\"name\" = stats.institution_name\n\t\torder by stats.institution_name, stats.storage_option\n"}
{"level":"info","status":200,"method":"GET","path":"/dashboard","ip":"","latency":23.885739,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst2.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: UPDATE \"users\" AS \"user\" SET \"created_at\" = '2021-01-12 17:14:00+00:00:00', \"updated_at\" = '2022-06-22 17:30:29.304422+00:00:00', \"name\" = 'Inst Two User', \"email\" = 'user@inst2.edu', \"phone_number\" = '+14345551212', \"encrypted_password\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"reset_password_token\" = NULL, \"reset_password_sent_at\" = NULL, \"remember_created_at\" = NULL, \"sign_in_count\" = 1, \"current_sign_in_at\" = '2022-06-22 17:30:29.304421+00:00:00', \"last_sign_in_at\" = NULL, \"current_sign_in_ip\" = NULL, \"last_sign_in_ip\" = NULL, \"institution_id\" = 3, \"encrypted_api_secret_key\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"password_changed_at\" = NULL, \"encrypted_otp_secret\" = NULL, \"encrypted_otp_secret_iv\" = NULL, \"encrypted_otp_secret_salt\" = NULL, \"encrypted_otp_sent_at\" = NULL, \"consumed_timestep\" = NULL, \"otp_required_for_login\" = NULL, \"deactivated_at\" = NULL, \"enabled_two_factor\" = NULL, \"confirmed_two_factor\" = NULL, \"otp_backup_codes\" = NULL, \"authy_id\" = NULL, \"last_sign_in_with_authy\" = NULL, \"authy_status\" = NULL, \"email_verified\" = TRUE, \"initial_password_updated\" = TRUE, \"force_password_update\" = NULL, \"grace_period\" = '1999-12-31 23:59:00+00:00:00', \"awaiting_second_factor\" = FALSE, \"role\" = 'institutional_user' WHERE \"user\".\"id\" = 7"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":302,"method":"POST","path":"/users/sign_in","ip":"","latency":72.077439,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 7))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" WHERE ((institution_id = 3)) ORDER BY \"date_processed\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"alert_view\".\"id\", \"alert_view\".\"institution_id\", \"alert_view\".\"institution_name\", \"alert_view\".\"institution_identifier\", \"alert_view\".\"type\", \"alert_view\".\"subject\", \"alert_view\".\"content\", \"alert_view\".\"deletion_request_id\", \"alert_view\".\"created_at\", \"alert_view\".\"user_id\", \"alert_view\".\"user_name\", \"alert_view\".\"sent_at\", \"alert_view\".\"read_at\" FROM \"alerts_view\" AS \"alert_view\" WHERE ((user_id = 7)) ORDER BY \"created_at\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: \n\t\tselect\n\t\t  coalesce(stats.institution_name, 'Total') as institution_name,\n\t\t  i2.id as institution_id,\n\t\t  coalesce(stats.storage_option, 'Total') as storage_option,\n\t\t  stats.file_count,\n\t\t  stats.object_count,\n\t\t  stats.total_bytes,\n\t\t  (stats.total_bytes / 1073741824) as total_gb,\n\t\t  (stats.total_bytes / 1099511627776) as total_tb,\n\t\t  so.cost_gb_per_month,\n\t\t  ((stats.total_bytes / 1073741824) * so.cost_gb_per_month) as monthly_cost\n\t\tfrom\n\t\t  (select\n\t\t\ti.\"name\" as institution_name,\n\t\t\tcount(gf.id) as file_count,\n\t\t\tcount(distinct(gf.intellectual_object_id)) as object_count,\n\t\t\tsum(gf.size) as total_bytes,\n\t\t\tgf.storage_option\n\t\t  from generic_files gf\n\t\t  left join institutions i on i.id = gf.institution_id\n\t\t  where gf.state = 'A'\n\t\t  and (3 = 0 or i.id = 3)\n\t\t  and ('' = '' or gf.storage_option = '')\n\t\t  and ('2022-06-22 17:30:29.310615+00:00:00' = '0001-01-01 00:00:00+00:00:00' or gf.updated_at < '2022-06-22 17:30:29.310615+00:00:00')\n\t\t  group by cube (i.\"name\", gf.storage_option)) stats\n\t\tleft join storage_options so on so.\"name\" = stats.storage_option\n\t\tleft join institutions i2 on i2.\"name\" = stats.institution_name\n\t\torder by stats.institution_name, stats.storage_option\n"}
{"level":"info","status":200,"method":"GET","path":"/dashboard","ip":"","latency":23.468536,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'sms_user@example.com'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: UPDATE \"users\" AS \"user\" SET \"created_at\" = '2021-09-10 14:25:00+00:00:00', \"updated_at\" = '2022-06-22 17:30:29.400494+00:00:00', \"name\" = 'Two Factor SMS User', \"email\" = 'sms_user@example.com', \"phone_number\" = '+12125551212', \"encrypted_password\" = '$2a$10$7aoot2KFFqikpTYVEbErYOxZijCHDPvqT4OMoFwdmsYBE9SK2PibC', \"reset_password_token\" = NULL, \"reset_password_sent_at\" = NULL, \"remember_created_at\" = NULL, \"sign_in_count\" = 1, \"current_sign_in_at\" = '2022-06-22 17:30:29.400493+00:00:00', \"last_sign_in_at\" = NULL, \"current_sign_in_ip\" = NULL, \"last_sign_in_ip\" = NULL, \"institution_id\" = 2, \"encrypted_api_secret_key\" = NULL, \"password_changed_at\" = NULL, \"encrypted_otp_secret\" = NULL, \"encrypted_otp_secret_iv\" = NULL, \"encrypted_otp_secret_salt\" = NULL, \"encrypted_otp_sent_at\" = NULL, \"consumed_timestep\" = NULL, \"otp_required_for_login\" = TRUE, \"deactivated_at\" = NULL, \"enabled_two_factor\" = NULL, \"confirmed_two_factor\" = NULL, \"otp_backup_codes\" = NULL, \"authy_id\" = NULL, \"last_sign_in_with_authy\" = NULL, \"authy_status\" = NULL, \"email_verified\" = NULL, \"initial_password_updated\" = NULL, \"force_password_update\" = TRUE, \"grace_period\" = '2021-11-09 05:00:00+00:00:00', \"awaiting_second_factor\" = FALSE, \"role\" = 'institutional_user' WHERE \"user\".\"id\" = 6"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":302,"method":"POST","path":"/users/sign_in","ip":"","latency":72.143649,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 6))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" WHERE ((institution_id = 2)) ORDER BY \"date_processed\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"alert_view\".\"id\", \"alert_view\".\"institution_id\", \"alert_view\".\"institution_name\", \"alert_view\".\"institution_identifier\", \"alert_view\".\"type\", \"alert_view\".\"subject\", \"alert_view\".\"content\", \"alert_view\".\"deletion_request_id\", \"alert_view\".\"created_at\", \"alert_view\".\"user_id\", \"alert_view\".\"user_name\", \"alert_view\".\"sent_at\", \"alert_view\".\"read_at\" FROM \"alerts_view\" AS \"alert_view\" WHERE ((user_id = 6)) ORDER BY \"created_at\" desc LIMIT 10"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: \n\t\tselect\n\t\t  coalesce(stats.institution_name, 'Total') as institution_name,\n\t\t  i2.id as institution_id,\n\t\t  coalesce(stats.storage_option, 'Total') as storage_option,\n\t\t  stats.file_count,\n\t\t  stats.object_count,\n\t\t  stats.total_bytes,\n\t\t  (stats.total_bytes / 1073741824) as total_gb,\n\t\t  (stats.total_bytes / 1099511627776) as total_tb,\n\t\t  so.cost_gb_per_month,\n\t\t  ((stats.total_bytes / 1073741824) * so.cost_gb_per_month) as monthly_cost\n\t\tfrom\n\t\t  (select\n\t\t\ti.\"name\" as institution_name,\n\t\t\tcount(gf.id) as file_count,\n\t\t\tcount(distinct(gf.intellectual_object_id)) as object_count,\n\t\t\tsum(gf.size) as total_bytes,\n\t\t\tgf.storage_option\n\t\t  from generic_files gf\n\t\t  left join institutions i on i.id = gf.institution_id\n\t\t  where gf.state = 'A'\n\t\t  and (2 = 0 or i.id = 2)\n\t\t  and ('' = '' or gf.storage_option = '')\n\t\t  and ('2022-06-22 17:30:29.40607+00:00:00' = '0001-01-01 00:00:00+00:00:00' or gf.updated_at < '2022-06-22 17:30:29.40607+00:00:00')\n\t\t  group by cube (i.\"name\", gf.storage_option)) stats\n\t\tleft join storage_options so on so.\"name\" = stats.storage_option\n\t\tleft join institutions i2 on i2.\"name\" = stats.institution_name\n\t\torder by stats.institution_name, stats.storage_option\n"}
{"level":"info","status":200,"method":"GET","path":"/dashboard","ip":"","latency":23.031283,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst1.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst1.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst2.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst2.edu'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'sms_user@example.com'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"checksum_view\".\"id\", \"checksum_view\".\"algorithm\", \"checksum_view\".\"datetime\", \"checksum_view\".\"digest\", \"checksum_view\".\"state\", \"checksum_view\".\"generic_file_identifier\", \"checksum_view\".\"generic_file_id\", \"checksum_view\".\"intellectual_object_id\", \"checksum_view\".\"institution_id\", \"checksum_view\".\"created_at\", \"checksum_view\".\"updated_at\" FROM \"checksums_view\" AS \"checksum_view\" WHERE ((id = 1))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"generic_file\".\"institution_id\" AS \"generic_file__institution_id\" FROM \"checksums\" AS \"checksum\" LEFT JOIN \"generic_files\" AS \"generic_file\" ON \"generic_file\".\"id\" = \"checksum\".\"generic_file_id\" WHERE (\"checksum\".\"id\" = 1)"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"checksum_view\".\"id\", \"checksum_view\".\"algorithm\", \"checksum_view\".\"datetime\", \"checksum_view\".\"digest\", \"checksum_view\".\"state\", \"checksum_view\".\"generic_file_identifier\", \"checksum_view\".\"generic_file_id\", \"checksum_view\".\"intellectual_object_id\", \"checksum_view\".\"institution_id\", \"checksum_view\".\"created_at\", \"checksum_view\".\"updated_at\" FROM \"checksums_view\" AS \"checksum_view\" WHERE ((id = 1))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/checksums/show/1","ip":"","latency":3.109752,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:29-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.ChecksumShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/checksums/show/:id, Request Path: /admin-api/v3/checksums/show/7, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"IsAPIRoute - YES - /admin-api/v3/checksums/show/7"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/checksums/show/7","ip":"","latency":1.007921,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:29-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.ChecksumShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/checksums/show/:id, Request Path: /admin-api/v3/checksums/show/7, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"IsAPIRoute - YES - /admin-api/v3/checksums/show/7"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/checksums/show/7","ip":"","latency":0.93865,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"checksum_view\".\"id\", \"checksum_view\".\"algorithm\", \"checksum_view\".\"datetime\", \"checksum_view\".\"digest\", \"checksum_view\".\"state\", \"checksum_view\".\"generic_file_identifier\", \"checksum_view\".\"generic_file_id\", \"checksum_view\".\"intellectual_object_id\", \"checksum_view\".\"institution_id\", \"checksum_view\".\"created_at\", \"checksum_view\".\"updated_at\" FROM \"checksums_view\" AS \"checksum_view\" ORDER BY \"id\" asc LIMIT 5 OFFSET 5"}
{"level":"info","time":"2022-06-22T13:30:29-04:00","message":"TypeName (1): ChecksumView"}
{"level":"info","time":"2022-06-22T13:30:29-04:00","message":"Cannot query count view for type ChecksumView: type is not supported for view count"}
{"level":"info","time":"2022-06-22T13:30:29-04:00","message":"API: Using standard count query for ''"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT count(*) FROM \"checksums_view\" AS \"checksum_view\""}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/checksums?page=2&per_page=5&sort=id__asc","ip":"","latency":2.489652,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"checksum_view\".\"id\", \"checksum_view\".\"algorithm\", \"checksum_view\".\"datetime\", \"checksum_view\".\"digest\", \"checksum_view\".\"state\", \"checksum_view\".\"generic_file_identifier\", \"checksum_view\".\"generic_file_id\", \"checksum_view\".\"intellectual_object_id\", \"checksum_view\".\"institution_id\", \"checksum_view\".\"created_at\", \"checksum_view\".\"updated_at\" FROM \"checksums_view\" AS \"checksum_view\" WHERE ((intellectual_object_id = '7') AND (state = 'A')) ORDER BY \"datetime\" desc LIMIT 20"}
{"level":"info","time":"2022-06-22T13:30:29-04:00","message":"TypeName (1): ChecksumView"}
{"level":"info","time":"2022-06-22T13:30:29-04:00","message":"Cannot query count view for type ChecksumView: type is not supported for view count"}
{"level":"info","time":"2022-06-22T13:30:29-04:00","message":"API: Using standard count query for '(intellectual_object_id = ?) AND (state = ?)'"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT count(*) FROM \"checksums_view\" AS \"checksum_view\" WHERE ((intellectual_object_id = '7') AND (state = 'A'))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/checksums?intellectual_object_id=7&state=A","ip":"","latency":4.030292,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:29-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.ChecksumIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/checksums, Request Path: /admin-api/v3/checksums, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"IsAPIRoute - YES - /admin-api/v3/checksums"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/checksums","ip":"","latency":1.206576,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:29-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.ChecksumIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/checksums, Request Path: /admin-api/v3/checksums, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"IsAPIRoute - YES - /admin-api/v3/checksums"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/checksums","ip":"","latency":0.977818,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 12) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (12)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (12)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (12))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"IsAPIRoute - YES - /admin-api/v3/checksums/create/3"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 12) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (12)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (12)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (12))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:29.526488+00:00:00', '2022-06-22 17:30:29.526488+00:00:00', 'sha512', '2022-06-22 17:30:29.453915+00:00:00', 'ManThose512sAreSomeLongAssDigests', 12) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/checksums/create/3","ip":"","latency":74.580605,"user-agent":"","time":"2022-06-22T13:30:29-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((\"checksum\".\"id\" = 33))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: SELECT \"generic_file_view\".\"id\", \"generic_file_view\".\"file_format\", \"generic_file_view\".\"size\", \"generic_file_view\".\"identifier\", \"generic_file_view\".\"intellectual_object_id\", \"generic_file_view\".\"object_identifier\", \"generic_file_view\".\"access\", \"generic_file_view\".\"state\", \"generic_file_view\".\"last_fixity_check\", \"generic_file_view\".\"institution_id\", \"generic_file_view\".\"institution_name\", \"generic_file_view\".\"institution_identifier\", \"generic_file_view\".\"storage_option\", \"generic_file_view\".\"uuid\", \"generic_file_view\".\"md5\", \"generic_file_view\".\"sha1\", \"generic_file_view\".\"sha256\", \"generic_file_view\".\"sha512\", \"generic_file_view\".\"created_at\", \"generic_file_view\".\"updated_at\" FROM \"generic_files_view\" AS \"generic_file_view\" WHERE ((id = 12))"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:29-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: select update_counts();"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"deletion_request\".\"id\", \"deletion_request\".\"institution_id\", \"deletion_request\".\"requested_by_id\", \"deletion_request\".\"requested_at\", \"deletion_request\".\"encrypted_confirmation_token\", \"deletion_request\".\"confirmed_by_id\", \"deletion_request\".\"confirmed_at\", \"deletion_request\".\"cancelled_by_id\", \"deletion_request\".\"cancelled_at\", \"deletion_request\".\"work_item_id\", \"requested_by\".\"id\" AS \"requested_by__id\", \"requested_by\".\"created_at\" AS \"requested_by__created_at\", \"requested_by\".\"updated_at\" AS \"requested_by__updated_at\", \"requested_by\".\"name\" AS \"requested_by__name\", \"requested_by\".\"email\" AS \"requested_by__email\", \"requested_by\".\"phone_number\" AS \"requested_by__phone_number\", \"requested_by\".\"encrypted_password\" AS \"requested_by__encrypted_password\", \"requested_by\".\"reset_password_token\" AS \"requested_by__reset_password_token\", \"requested_by\".\"reset_password_sent_at\" AS \"requested_by__reset_password_sent_at\", \"requested_by\".\"remember_created_at\" AS \"requested_by__remember_created_at\", \"requested_by\".\"sign_in_count\" AS \"requested_by__sign_in_count\", \"requested_by\".\"current_sign_in_at\" AS \"requested_by__current_sign_in_at\", \"requested_by\".\"last_sign_in_at\" AS \"requested_by__last_sign_in_at\", \"requested_by\".\"current_sign_in_ip\" AS \"requested_by__current_sign_in_ip\", \"requested_by\".\"last_sign_in_ip\" AS \"requested_by__last_sign_in_ip\", \"requested_by\".\"institution_id\" AS \"requested_by__institution_id\", \"requested_by\".\"encrypted_api_secret_key\" AS \"requested_by__encrypted_api_secret_key\", \"requested_by\".\"password_changed_at\" AS \"requested_by__password_changed_at\", \"requested_by\".\"encrypted_otp_secret\" AS \"requested_by__encrypted_otp_secret\", \"requested_by\".\"encrypted_otp_secret_iv\" AS \"requested_by__encrypted_otp_secret_iv\", \"requested_by\".\"encrypted_otp_secret_salt\" AS \"requested_by__encrypted_otp_secret_salt\", \"requested_by\".\"encrypted_otp_sent_at\" AS \"requested_by__encrypted_otp_sent_at\", \"requested_by\".\"consumed_timestep\" AS \"requested_by__consumed_timestep\", \"requested_by\".\"otp_required_for_login\" AS \"requested_by__otp_required_for_login\", \"requested_by\".\"deactivated_at\" AS \"requested_by__deactivated_at\", \"requested_by\".\"enabled_two_factor\" AS \"requested_by__enabled_two_factor\", \"requested_by\".\"confirmed_two_factor\" AS \"requested_by__confirmed_two_factor\", \"requested_by\".\"otp_backup_codes\" AS \"requested_by__otp_backup_codes\", \"requested_by\".\"authy_id\" AS \"requested_by__authy_id\", \"requested_by\".\"last_sign_in_with_authy\" AS \"requested_by__last_sign_in_with_authy\", \"requested_by\".\"authy_status\" AS \"requested_by__authy_status\", \"requested_by\".\"email_verified\" AS \"requested_by__email_verified\", \"requested_by\".\"initial_password_updated\" AS \"requested_by__initial_password_updated\", \"requested_by\".\"force_password_update\" AS \"requested_by__force_password_update\", \"requested_by\".\"grace_period\" AS \"requested_by__grace_period\", \"requested_by\".\"awaiting_second_factor\" AS \"requested_by__awaiting_second_factor\", \"requested_by\".\"role\" AS \"requested_by__role\", \"confirmed_by\".\"id\" AS \"confirmed_by__id\", \"confirmed_by\".\"created_at\" AS \"confirmed_by__created_at\", \"confirmed_by\".\"updated_at\" AS \"confirmed_by__updated_at\", \"confirmed_by\".\"name\" AS \"confirmed_by__name\", \"confirmed_by\".\"email\" AS \"confirmed_by__email\", \"confirmed_by\".\"phone_number\" AS \"confirmed_by__phone_number\", \"confirmed_by\".\"encrypted_password\" AS \"confirmed_by__encrypted_password\", \"confirmed_by\".\"reset_password_token\" AS \"confirmed_by__reset_password_token\", \"confirmed_by\".\"reset_password_sent_at\" AS \"confirmed_by__reset_password_sent_at\", \"confirmed_by\".\"remember_created_at\" AS \"confirmed_by__remember_created_at\", \"confirmed_by\".\"sign_in_count\" AS \"confirmed_by__sign_in_count\", \"confirmed_by\".\"current_sign_in_at\" AS \"confirmed_by__current_sign_in_at\", \"confirmed_by\".\"last_sign_in_at\" AS \"confirmed_by__last_sign_in_at\", \"confirmed_by\".\"current_sign_in_ip\" AS \"confirmed_by__current_sign_in_ip\", \"confirmed_by\".\"last_sign_in_ip\" AS \"confirmed_by__last_sign_in_ip\", \"confirmed_by\".\"institution_id\" AS \"confirmed_by__institution_id\", \"confirmed_by\".\"encrypted_api_secret_key\" AS \"confirmed_by__encrypted_api_secret_key\", \"confirmed_by\".\"password_changed_at\" AS \"confirmed_by__password_changed_at\", \"confirmed_by\".\"encrypted_otp_secret\" AS \"confirmed_by__encrypted_otp_secret\", \"confirmed_by\".\"encrypted_otp_secret_iv\" AS \"confirmed_by__encrypted_otp_secret_iv\", \"confirmed_by\".\"encrypted_otp_secret_salt\" AS \"confirmed_by__encrypted_otp_secret_salt\", \"confirmed_by\".\"encrypted_otp_sent_at\" AS \"confirmed_by__encrypted_otp_sent_at\", \"confirmed_by\".\"consumed_timestep\" AS \"confirmed_by__consumed_timestep\", \"confirmed_by\".\"otp_required_for_login\" AS \"confirmed_by__otp_required_for_login\", \"confirmed_by\".\"deactivated_at\" AS \"confirmed_by__deactivated_at\", \"confirmed_by\".\"enabled_two_factor\" AS \"confirmed_by__enabled_two_factor\", \"confirmed_by\".\"confirmed_two_factor\" AS \"confirmed_by__confirmed_two_factor\", \"confirmed_by\".\"otp_backup_codes\" AS \"confirmed_by__otp_backup_codes\", \"confirmed_by\".\"authy_id\" AS \"confirmed_by__authy_id\", \"confirmed_by\".\"last_sign_in_with_authy\" AS \"confirmed_by__last_sign_in_with_authy\", \"confirmed_by\".\"authy_status\" AS \"confirmed_by__authy_status\", \"confirmed_by\".\"email_verified\" AS \"confirmed_by__email_verified\", \"confirmed_by\".\"initial_password_updated\" AS \"confirmed_by__initial_password_updated\", \"confirmed_by\".\"force_password_update\" AS \"confirmed_by__force_password_update\", \"confirmed_by\".\"grace_period\" AS \"confirmed_by__grace_period\", \"confirmed_by\".\"awaiting_second_factor\" AS \"confirmed_by__awaiting_second_factor\", \"confirmed_by\".\"role\" AS \"confirmed_by__role\", \"cancelled_by\".\"id\" AS \"cancelled_by__id\", \"cancelled_by\".\"created_at\" AS \"cancelled_by__created_at\", \"cancelled_by\".\"updated_at\" AS \"cancelled_by__updated_at\", \"cancelled_by\".\"name\" AS \"cancelled_by__name\", \"cancelled_by\".\"email\" AS \"cancelled_by__email\", \"cancelled_by\".\"phone_number\" AS \"cancelled_by__phone_number\", \"cancelled_by\".\"encrypted_password\" AS \"cancelled_by__encrypted_password\", \"cancelled_by\".\"reset_password_token\" AS \"cancelled_by__reset_password_token\", \"cancelled_by\".\"reset_password_sent_at\" AS \"cancelled_by__reset_password_sent_at\", \"cancelled_by\".\"remember_created_at\" AS \"cancelled_by__remember_created_at\", \"cancelled_by\".\"sign_in_count\" AS \"cancelled_by__sign_in_count\", \"cancelled_by\".\"current_sign_in_at\" AS \"cancelled_by__current_sign_in_at\", \"cancelled_by\".\"last_sign_in_at\" AS \"cancelled_by__last_sign_in_at\", \"cancelled_by\".\"current_sign_in_ip\" AS \"cancelled_by__current_sign_in_ip\", \"cancelled_by\".\"last_sign_in_ip\" AS \"cancelled_by__last_sign_in_ip\", \"cancelled_by\".\"institution_id\" AS \"cancelled_by__institution_id\", \"cancelled_by\".\"encrypted_api_secret_key\" AS \"cancelled_by__encrypted_api_secret_key\", \"cancelled_by\".\"password_changed_at\" AS \"cancelled_by__password_changed_at\", \"cancelled_by\".\"encrypted_otp_secret\" AS \"cancelled_by__encrypted_otp_secret\", \"cancelled_by\".\"encrypted_otp_secret_iv\" AS \"cancelled_by__encrypted_otp_secret_iv\", \"cancelled_by\".\"encrypted_otp_secret_salt\" AS \"cancelled_by__encrypted_otp_secret_salt\", \"cancelled_by\".\"encrypted_otp_sent_at\" AS \"cancelled_by__encrypted_otp_sent_at\", \"cancelled_by\".\"consumed_timestep\" AS \"cancelled_by__consumed_timestep\", \"cancelled_by\".\"otp_required_for_login\" AS \"cancelled_by__otp_required_for_login\", \"cancelled_by\".\"deactivated_at\" AS \"cancelled_by__deactivated_at\", \"cancelled_by\".\"enabled_two_factor\" AS \"cancelled_by__enabled_two_factor\", \"cancelled_by\".\"confirmed_two_factor\" AS \"cancelled_by__confirmed_two_factor\", \"cancelled_by\".\"otp_backup_codes\" AS \"cancelled_by__otp_backup_codes\", \"cancelled_by\".\"authy_id\" AS \"cancelled_by__authy_id\", \"cancelled_by\".\"last_sign_in_with_authy\" AS \"cancelled_by__last_sign_in_with_authy\", \"cancelled_by\".\"authy_status\" AS \"cancelled_by__authy_status\", \"cancelled_by\".\"email_verified\" AS \"cancelled_by__email_verified\", \"cancelled_by\".\"initial_password_updated\" AS \"cancelled_by__initial_password_updated\", \"cancelled_by\".\"force_password_update\" AS \"cancelled_by__force_password_update\", \"cancelled_by\".\"grace_period\" AS \"cancelled_by__grace_period\", \"cancelled_by\".\"awaiting_second_factor\" AS \"cancelled_by__awaiting_second_factor\", \"cancelled_by\".\"role\" AS \"cancelled_by__role\", \"work_item\".\"id\" AS \"work_item__id\", \"work_item\".\"created_at\" AS \"work_item__created_at\", \"work_item\".\"updated_at\" AS \"work_item__updated_at\", \"work_item\".\"name\" AS \"work_item__name\", \"work_item\".\"etag\" AS \"work_item__etag\", \"work_item\".\"institution_id\" AS \"work_item__institution_id\", \"work_item\".\"intellectual_object_id\" AS \"work_item__intellectual_object_id\", \"work_item\".\"generic_file_id\" AS \"work_item__generic_file_id\", \"work_item\".\"bucket\" AS \"work_item__bucket\", \"work_item\".\"user\" AS \"work_item__user\", \"work_item\".\"note\" AS \"work_item__note\", \"work_item\".\"action\" AS \"work_item__action\", \"work_item\".\"stage\" AS \"work_item__stage\", \"work_item\".\"status\" AS \"work_item__status\", \"work_item\".\"outcome\" AS \"work_item__outcome\", \"work_item\".\"bag_date\" AS \"work_item__bag_date\", \"work_item\".\"date_processed\" AS \"work_item__date_processed\", \"work_item\".\"retry\" AS \"work_item__retry\", \"work_item\".\"node\" AS \"work_item__node\", \"work_item\".\"pid\" AS \"work_item__pid\", \"work_item\".\"needs_admin_review\" AS \"work_item__needs_admin_review\", \"work_item\".\"queued_at\" AS \"work_item__queued_at\", \"work_item\".\"size\" AS \"work_item__size\", \"work_item\".\"stage_started_at\" AS \"work_item__stage_started_at\", \"work_item\".\"aptrust_approver\" AS \"work_item__aptrust_approver\", \"work_item\".\"inst_approver\" AS \"work_item__inst_approver\" FROM \"deletion_requests\" AS \"deletion_request\" LEFT JOIN \"users\" AS \"requested_by\" ON \"requested_by\".\"id\" = \"deletion_request\".\"requested_by_id\" LEFT JOIN \"users\" AS \"confirmed_by\" ON \"confirmed_by\".\"id\" = \"deletion_request\".\"confirmed_by_id\" LEFT JOIN \"users\" AS \"cancelled_by\" ON \"cancelled_by\".\"id\" = \"deletion_request\".\"cancelled_by_id\" LEFT JOIN \"work_items\" AS \"work_item\" ON \"work_item\".\"id\" = \"deletion_request\".\"work_item_id\" WHERE ((\"deletion_request\".\"id\" = 2))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"deletion_requests_generic_files\".*, \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\" FROM \"generic_files\" AS \"generic_file\" JOIN \"deletion_requests_generic_files\" AS \"deletion_requests_generic_files\" ON (\"deletion_requests_generic_files\".\"deletion_request_id\") IN (2) WHERE (\"generic_file\".\"id\" = \"deletion_requests_generic_files\".\"generic_file_id\")"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"deletion_requests_intellectual_objects\".*, \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" FROM \"intellectual_objects\" AS \"intellectual_object\" JOIN \"deletion_requests_intellectual_objects\" AS \"deletion_requests_intellectual_objects\" ON (\"deletion_requests_intellectual_objects\".\"deletion_request_id\") IN (2) WHERE (\"intellectual_object\".\"id\" = \"deletion_requests_intellectual_objects\".\"intellectual_object_id\")"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"deletion_requests\" AS \"deletion_request\" WHERE (id = 2)"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"deletion_request\".\"id\", \"deletion_request\".\"institution_id\", \"deletion_request\".\"requested_by_id\", \"deletion_request\".\"requested_at\", \"deletion_request\".\"encrypted_confirmation_token\", \"deletion_request\".\"confirmed_by_id\", \"deletion_request\".\"confirmed_at\", \"deletion_request\".\"cancelled_by_id\", \"deletion_request\".\"cancelled_at\", \"deletion_request\".\"work_item_id\", \"requested_by\".\"id\" AS \"requested_by__id\", \"requested_by\".\"created_at\" AS \"requested_by__created_at\", \"requested_by\".\"updated_at\" AS \"requested_by__updated_at\", \"requested_by\".\"name\" AS \"requested_by__name\", \"requested_by\".\"email\" AS \"requested_by__email\", \"requested_by\".\"phone_number\" AS \"requested_by__phone_number\", \"requested_by\".\"encrypted_password\" AS \"requested_by__encrypted_password\", \"requested_by\".\"reset_password_token\" AS \"requested_by__reset_password_token\", \"requested_by\".\"reset_password_sent_at\" AS \"requested_by__reset_password_sent_at\", \"requested_by\".\"remember_created_at\" AS \"requested_by__remember_created_at\", \"requested_by\".\"sign_in_count\" AS \"requested_by__sign_in_count\", \"requested_by\".\"current_sign_in_at\" AS \"requested_by__current_sign_in_at\", \"requested_by\".\"last_sign_in_at\" AS \"requested_by__last_sign_in_at\", \"requested_by\".\"current_sign_in_ip\" AS \"requested_by__current_sign_in_ip\", \"requested_by\".\"last_sign_in_ip\" AS \"requested_by__last_sign_in_ip\", \"requested_by\".\"institution_id\" AS \"requested_by__institution_id\", \"requested_by\".\"encrypted_api_secret_key\" AS \"requested_by__encrypted_api_secret_key\", \"requested_by\".\"password_changed_at\" AS \"requested_by__password_changed_at\", \"requested_by\".\"encrypted_otp_secret\" AS \"requested_by__encrypted_otp_secret\", \"requested_by\".\"encrypted_otp_secret_iv\" AS \"requested_by__encrypted_otp_secret_iv\", \"requested_by\".\"encrypted_otp_secret_salt\" AS \"requested_by__encrypted_otp_secret_salt\", \"requested_by\".\"encrypted_otp_sent_at\" AS \"requested_by__encrypted_otp_sent_at\", \"requested_by\".\"consumed_timestep\" AS \"requested_by__consumed_timestep\", \"requested_by\".\"otp_required_for_login\" AS \"requested_by__otp_required_for_login\", \"requested_by\".\"deactivated_at\" AS \"requested_by__deactivated_at\", \"requested_by\".\"enabled_two_factor\" AS \"requested_by__enabled_two_factor\", \"requested_by\".\"confirmed_two_factor\" AS \"requested_by__confirmed_two_factor\", \"requested_by\".\"otp_backup_codes\" AS \"requested_by__otp_backup_codes\", \"requested_by\".\"authy_id\" AS \"requested_by__authy_id\", \"requested_by\".\"last_sign_in_with_authy\" AS \"requested_by__last_sign_in_with_authy\", \"requested_by\".\"authy_status\" AS \"requested_by__authy_status\", \"requested_by\".\"email_verified\" AS \"requested_by__email_verified\", \"requested_by\".\"initial_password_updated\" AS \"requested_by__initial_password_updated\", \"requested_by\".\"force_password_update\" AS \"requested_by__force_password_update\", \"requested_by\".\"grace_period\" AS \"requested_by__grace_period\", \"requested_by\".\"awaiting_second_factor\" AS \"requested_by__awaiting_second_factor\", \"requested_by\".\"role\" AS \"requested_by__role\", \"confirmed_by\".\"id\" AS \"confirmed_by__id\", \"confirmed_by\".\"created_at\" AS \"confirmed_by__created_at\", \"confirmed_by\".\"updated_at\" AS \"confirmed_by__updated_at\", \"confirmed_by\".\"name\" AS \"confirmed_by__name\", \"confirmed_by\".\"email\" AS \"confirmed_by__email\", \"confirmed_by\".\"phone_number\" AS \"confirmed_by__phone_number\", \"confirmed_by\".\"encrypted_password\" AS \"confirmed_by__encrypted_password\", \"confirmed_by\".\"reset_password_token\" AS \"confirmed_by__reset_password_token\", \"confirmed_by\".\"reset_password_sent_at\" AS \"confirmed_by__reset_password_sent_at\", \"confirmed_by\".\"remember_created_at\" AS \"confirmed_by__remember_created_at\", \"confirmed_by\".\"sign_in_count\" AS \"confirmed_by__sign_in_count\", \"confirmed_by\".\"current_sign_in_at\" AS \"confirmed_by__current_sign_in_at\", \"confirmed_by\".\"last_sign_in_at\" AS \"confirmed_by__last_sign_in_at\", \"confirmed_by\".\"current_sign_in_ip\" AS \"confirmed_by__current_sign_in_ip\", \"confirmed_by\".\"last_sign_in_ip\" AS \"confirmed_by__last_sign_in_ip\", \"confirmed_by\".\"institution_id\" AS \"confirmed_by__institution_id\", \"confirmed_by\".\"encrypted_api_secret_key\" AS \"confirmed_by__encrypted_api_secret_key\", \"confirmed_by\".\"password_changed_at\" AS \"confirmed_by__password_changed_at\", \"confirmed_by\".\"encrypted_otp_secret\" AS \"confirmed_by__encrypted_otp_secret\", \"confirmed_by\".\"encrypted_otp_secret_iv\" AS \"confirmed_by__encrypted_otp_secret_iv\", \"confirmed_by\".\"encrypted_otp_secret_salt\" AS \"confirmed_by__encrypted_otp_secret_salt\", \"confirmed_by\".\"encrypted_otp_sent_at\" AS \"confirmed_by__encrypted_otp_sent_at\", \"confirmed_by\".\"consumed_timestep\" AS \"confirmed_by__consumed_timestep\", \"confirmed_by\".\"otp_required_for_login\" AS \"confirmed_by__otp_required_for_login\", \"confirmed_by\".\"deactivated_at\" AS \"confirmed_by__deactivated_at\", \"confirmed_by\".\"enabled_two_factor\" AS \"confirmed_by__enabled_two_factor\", \"confirmed_by\".\"confirmed_two_factor\" AS \"confirmed_by__confirmed_two_factor\", \"confirmed_by\".\"otp_backup_codes\" AS \"confirmed_by__otp_backup_codes\", \"confirmed_by\".\"authy_id\" AS \"confirmed_by__authy_id\", \"confirmed_by\".\"last_sign_in_with_authy\" AS \"confirmed_by__last_sign_in_with_authy\", \"confirmed_by\".\"authy_status\" AS \"confirmed_by__authy_status\", \"confirmed_by\".\"email_verified\" AS \"confirmed_by__email_verified\", \"confirmed_by\".\"initial_password_updated\" AS \"confirmed_by__initial_password_updated\", \"confirmed_by\".\"force_password_update\" AS \"confirmed_by__force_password_update\", \"confirmed_by\".\"grace_period\" AS \"confirmed_by__grace_period\", \"confirmed_by\".\"awaiting_second_factor\" AS \"confirmed_by__awaiting_second_factor\", \"confirmed_by\".\"role\" AS \"confirmed_by__role\", \"cancelled_by\".\"id\" AS \"cancelled_by__id\", \"cancelled_by\".\"created_at\" AS \"cancelled_by__created_at\", \"cancelled_by\".\"updated_at\" AS \"cancelled_by__updated_at\", \"cancelled_by\".\"name\" AS \"cancelled_by__name\", \"cancelled_by\".\"email\" AS \"cancelled_by__email\", \"cancelled_by\".\"phone_number\" AS \"cancelled_by__phone_number\", \"cancelled_by\".\"encrypted_password\" AS \"cancelled_by__encrypted_password\", \"cancelled_by\".\"reset_password_token\" AS \"cancelled_by__reset_password_token\", \"cancelled_by\".\"reset_password_sent_at\" AS \"cancelled_by__reset_password_sent_at\", \"cancelled_by\".\"remember_created_at\" AS \"cancelled_by__remember_created_at\", \"cancelled_by\".\"sign_in_count\" AS \"cancelled_by__sign_in_count\", \"cancelled_by\".\"current_sign_in_at\" AS \"cancelled_by__current_sign_in_at\", \"cancelled_by\".\"last_sign_in_at\" AS \"cancelled_by__last_sign_in_at\", \"cancelled_by\".\"current_sign_in_ip\" AS \"cancelled_by__current_sign_in_ip\", \"cancelled_by\".\"last_sign_in_ip\" AS \"cancelled_by__last_sign_in_ip\", \"cancelled_by\".\"institution_id\" AS \"cancelled_by__institution_id\", \"cancelled_by\".\"encrypted_api_secret_key\" AS \"cancelled_by__encrypted_api_secret_key\", \"cancelled_by\".\"password_changed_at\" AS \"cancelled_by__password_changed_at\", \"cancelled_by\".\"encrypted_otp_secret\" AS \"cancelled_by__encrypted_otp_secret\", \"cancelled_by\".\"encrypted_otp_secret_iv\" AS \"cancelled_by__encrypted_otp_secret_iv\", \"cancelled_by\".\"encrypted_otp_secret_salt\" AS \"cancelled_by__encrypted_otp_secret_salt\", \"cancelled_by\".\"encrypted_otp_sent_at\" AS \"cancelled_by__encrypted_otp_sent_at\", \"cancelled_by\".\"consumed_timestep\" AS \"cancelled_by__consumed_timestep\", \"cancelled_by\".\"otp_required_for_login\" AS \"cancelled_by__otp_required_for_login\", \"cancelled_by\".\"deactivated_at\" AS \"cancelled_by__deactivated_at\", \"cancelled_by\".\"enabled_two_factor\" AS \"cancelled_by__enabled_two_factor\", \"cancelled_by\".\"confirmed_two_factor\" AS \"cancelled_by__confirmed_two_factor\", \"cancelled_by\".\"otp_backup_codes\" AS \"cancelled_by__otp_backup_codes\", \"cancelled_by\".\"authy_id\" AS \"cancelled_by__authy_id\", \"cancelled_by\".\"last_sign_in_with_authy\" AS \"cancelled_by__last_sign_in_with_authy\", \"cancelled_by\".\"authy_status\" AS \"cancelled_by__authy_status\", \"cancelled_by\".\"email_verified\" AS \"cancelled_by__email_verified\", \"cancelled_by\".\"initial_password_updated\" AS \"cancelled_by__initial_password_updated\", \"cancelled_by\".\"force_password_update\" AS \"cancelled_by__force_password_update\", \"cancelled_by\".\"grace_period\" AS \"cancelled_by__grace_period\", \"cancelled_by\".\"awaiting_second_factor\" AS \"cancelled_by__awaiting_second_factor\", \"cancelled_by\".\"role\" AS \"cancelled_by__role\", \"work_item\".\"id\" AS \"work_item__id\", \"work_item\".\"created_at\" AS \"work_item__created_at\", \"work_item\".\"updated_at\" AS \"work_item__updated_at\", \"work_item\".\"name\" AS \"work_item__name\", \"work_item\".\"etag\" AS \"work_item__etag\", \"work_item\".\"institution_id\" AS \"work_item__institution_id\", \"work_item\".\"intellectual_object_id\" AS \"work_item__intellectual_object_id\", \"work_item\".\"generic_file_id\" AS \"work_item__generic_file_id\", \"work_item\".\"bucket\" AS \"work_item__bucket\", \"work_item\".\"user\" AS \"work_item__user\", \"work_item\".\"note\" AS \"work_item__note\", \"work_item\".\"action\" AS \"work_item__action\", \"work_item\".\"stage\" AS \"work_item__stage\", \"work_item\".\"status\" AS \"work_item__status\", \"work_item\".\"outcome\" AS \"work_item__outcome\", \"work_item\".\"bag_date\" AS \"work_item__bag_date\", \"work_item\".\"date_processed\" AS \"work_item__date_processed\", \"work_item\".\"retry\" AS \"work_item__retry\", \"work_item\".\"node\" AS \"work_item__node\", \"work_item\".\"pid\" AS \"work_item__pid\", \"work_item\".\"needs_admin_review\" AS \"work_item__needs_admin_review\", \"work_item\".\"queued_at\" AS \"work_item__queued_at\", \"work_item\".\"size\" AS \"work_item__size\", \"work_item\".\"stage_started_at\" AS \"work_item__stage_started_at\", \"work_item\".\"aptrust_approver\" AS \"work_item__aptrust_approver\", \"work_item\".\"inst_approver\" AS \"work_item__inst_approver\" FROM \"deletion_requests\" AS \"deletion_request\" LEFT JOIN \"users\" AS \"requested_by\" ON \"requested_by\".\"id\" = \"deletion_request\".\"requested_by_id\" LEFT JOIN \"users\" AS \"confirmed_by\" ON \"confirmed_by\".\"id\" = \"deletion_request\".\"confirmed_by_id\" LEFT JOIN \"users\" AS \"cancelled_by\" ON \"cancelled_by\".\"id\" = \"deletion_request\".\"cancelled_by_id\" LEFT JOIN \"work_items\" AS \"work_item\" ON \"work_item\".\"id\" = \"deletion_request\".\"work_item_id\" WHERE ((\"deletion_request\".\"id\" = 2))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"deletion_requests_generic_files\".*, \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\" FROM \"generic_files\" AS \"generic_file\" JOIN \"deletion_requests_generic_files\" AS \"deletion_requests_generic_files\" ON (\"deletion_requests_generic_files\".\"deletion_request_id\") IN (2) WHERE (\"generic_file\".\"id\" = \"deletion_requests_generic_files\".\"generic_file_id\")"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"deletion_requests_intellectual_objects\".*, \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" FROM \"intellectual_objects\" AS \"intellectual_object\" JOIN \"deletion_requests_intellectual_objects\" AS \"deletion_requests_intellectual_objects\" ON (\"deletion_requests_intellectual_objects\".\"deletion_request_id\") IN (2) WHERE (\"intellectual_object\".\"id\" = \"deletion_requests_intellectual_objects\".\"intellectual_object_id\")"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/deletions/show/2","ip":"","latency":9.393517,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:30-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.DeletionRequestShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/deletions/show/:id, Request Path: /admin-api/v3/deletions/show/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"IsAPIRoute - YES - /admin-api/v3/deletions/show/2"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/deletions/show/2","ip":"","latency":1.128253,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:30-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.DeletionRequestShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/deletions/show/:id, Request Path: /admin-api/v3/deletions/show/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"IsAPIRoute - YES - /admin-api/v3/deletions/show/2"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/deletions/show/2","ip":"","latency":0.909385,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:30-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.DeletionRequestShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/deletions/show/:id, Request Path: /admin-api/v3/deletions/show/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"IsAPIRoute - YES - /admin-api/v3/deletions/show/2"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/deletions/show/2","ip":"","latency":1.038079,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 1) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (1)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (1)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (1))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 1)"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 1) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (1)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (1)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (1))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/files/show/1","ip":"","latency":72.462727,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:30-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.GenericFileShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/files/show/*id, Request Path: /admin-api/v3/files/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/files/show/1","ip":"","latency":0.953631,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:30-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.GenericFileShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/files/show/*id, Request Path: /admin-api/v3/files/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/files/show/1","ip":"","latency":1.244183,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"intellectual_objects\" (\"id\", \"created_at\", \"updated_at\", \"title\", \"description\", \"identifier\", \"alt_identifier\", \"access\", \"bag_name\", \"institution_id\", \"state\", \"etag\", \"bag_group_identifier\", \"storage_option\", \"bagit_profile_identifier\", \"source_organization\", \"internal_sender_identifier\", \"internal_sender_description\") VALUES (DEFAULT, '2022-06-22 17:30:30.427476+00:00:00', '2022-06-22 17:30:30.427476+00:00:00', 'wireless Ameliorated user-centric', 'We need to transmit the back-end PCI array!', 'test.edu/Tigerlike', 'Llama', 'institution', 'optical.tar', 4, 'A', '8fbcbc913ffe42f78bab015a82a21c06', 'prison', 'Standard', 'https://example.com/profile.json', 'Test University', 'Butterball', 'Yr scenester brunch chicharrones tilde aesthetic knausgaard disrupt shabby chic chambray migas pour-over.') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:30.429414+00:00:00', '2022-06-22 17:30:30.430448+00:00:00', 'invertebrates', 3362603006661230478, 'test.edu/Tigerlike/data/leagueinvite706.fon', 15, 'A', '2022-02-22 17:30:30.429414+00:00:00', 4, 'Standard', 'cbe8d58b-b1be-42fe-ad29-6509fd75717b') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.432523+00:00:00', '2022-06-22 17:30:30.432561+00:00:00', 'Duck', '2022-06-22 17:30:30.432523+00:00:00', 'Convince adopt offence enable.', 'ingestion', 63, '56a4d53e-7c28-43da-b667-1841b8dbe300', 4, 15, 'Stretch time fire spot.', DEFAULT, 'Close overcome path contact accommodate.', 'Chimay Grande Réserve', 'Alexis Harvey') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.432553+00:00:00', '2022-06-22 17:30:30.433878+00:00:00', 'Chicken', '2022-06-22 17:30:30.432553+00:00:00', 'Produce show stretch murder.', 'identifier assignment', 63, 'eee032a9-ca9c-417e-8087-c911747dff3a', 4, 15, 'Stick family examine return.', DEFAULT, 'Depend dinner supply match centre.', 'Trappistes Rochefort 8', 'Alivia Champlin') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.434944+00:00:00', '2022-06-22 17:30:30.434967+00:00:00', 'md5', '2022-06-22 17:30:30.434944+00:00:00', 'cd44108f5b984dce9ac2fc82c9e09e87', 63) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.434965+00:00:00', '2022-06-22 17:30:30.436395+00:00:00', 'sha256', '2022-06-22 17:30:30.434965+00:00:00', 'bd5f9f0501894a36932ff68d0ab063e2', 63) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 63, 'http://www.humanplug-and-play.com/interfaces/grow/synergistic') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 63, 'http://www.investorgenerate.io/architectures/niches/optimize/leverage') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:30.440507+00:00:00', '2022-06-22 17:30:30.440689+00:00:00', 'invertebrates', 5114770053730840132, 'test.edu/Tigerlike/data/labourtell873.mpa', 15, 'A', '2022-02-22 17:30:30.440507+00:00:00', 4, 'Standard', 'bf1ff26e-761f-433d-b3b0-763c4f5fc69f') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.441534+00:00:00', '2022-06-22 17:30:30.44156+00:00:00', 'Turkey', '2022-06-22 17:30:30.441534+00:00:00', 'Publication health persuade direction.', 'ingestion', 64, '5d011727-f75f-417f-8cdc-8cd49dd5a994', 4, 15, 'Charge point burst watch.', DEFAULT, 'Train seem safety representation memory.', 'Schneider Aventinus', 'Daphnee Koepp') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.441552+00:00:00', '2022-06-22 17:30:30.44277+00:00:00', 'Pig', '2022-06-22 17:30:30.441552+00:00:00', 'Introduce link travel leg.', 'identifier assignment', 64, 'd517a095-0604-40ce-b32c-9b458f7e863e', 4, 15, 'Act ball split brother.', DEFAULT, 'Shift sign cat ride realise.', 'Stone Imperial Russian Stout', 'Alexie Dach') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.443888+00:00:00', '2022-06-22 17:30:30.443905+00:00:00', 'md5', '2022-06-22 17:30:30.443888+00:00:00', '0b050ef6f3824a6e8672d3df1bb79f9d', 64) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.443902+00:00:00', '2022-06-22 17:30:30.4455+00:00:00', 'sha256', '2022-06-22 17:30:30.443902+00:00:00', 'aac066887a464c11be0bc22eeab1654e', 64) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 64, 'http://www.dynamicback-end.io/roi/enhance/mesh/initiatives') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 64, 'http://www.leadtransition.biz/real-time') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:30.448795+00:00:00', '2022-06-22 17:30:30.448962+00:00:00', 'mammals', 4358100777604385545, 'test.edu/Tigerlike/data/divisioninfluence741.wav', 15, 'A', '2022-02-22 17:30:30.448795+00:00:00', 4, 'Standard', '1bbd9a94-ff8f-43c6-8ce9-8792cf7c23b8') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.449777+00:00:00', '2022-06-22 17:30:30.4498+00:00:00', 'Chicken', '2022-06-22 17:30:30.449777+00:00:00', 'Property strike paint protect.', 'ingestion', 65, '2687fcfd-792b-454a-a990-5b2d86ee6eda', 4, 15, 'Hotel search stop century.', DEFAULT, 'Oil implement reach walk improvement.', 'Alpha King Pale Ale', 'Fuzion Apps, Inc.') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.449791+00:00:00', '2022-06-22 17:30:30.450655+00:00:00', 'Turkey', '2022-06-22 17:30:30.449791+00:00:00', 'Relationship receive centre settle.', 'identifier assignment', 65, 'a9b35df2-9598-4cd2-ae46-31b00a72fc84', 4, 15, 'Panel scope bank exploit.', DEFAULT, 'Buy river separate solve purchase.', 'Pliny The Elder', 'Ara Cronin') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.451452+00:00:00', '2022-06-22 17:30:30.451461+00:00:00', 'md5', '2022-06-22 17:30:30.451452+00:00:00', 'be04c6d9549045f7a04f9dec67ee07e9', 65) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.451459+00:00:00', '2022-06-22 17:30:30.452503+00:00:00', 'sha256', '2022-06-22 17:30:30.451459+00:00:00', '0ab75a756625499da38e83d65c053dc9', 65) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 65, 'https://www.internalclicks-and-mortar.biz/bricks-and-clicks/systems/extensible/killer') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 65, 'https://www.dynamicinnovate.net/revolutionize/experiences') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:30.456941+00:00:00', '2022-06-22 17:30:30.457104+00:00:00', 'amphibians', 6576688112211341432, 'test.edu/Tigerlike/data/varietyrefer185.java', 15, 'A', '2022-02-22 17:30:30.456941+00:00:00', 4, 'Standard', 'c021ebc9-3e5b-4ffb-9fd6-fdd8cd02c23e') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.45799+00:00:00', '2022-06-22 17:30:30.458017+00:00:00', 'Chicken', '2022-06-22 17:30:30.45799+00:00:00', 'Lady inform generate extent.', 'ingestion', 66, '834387c0-e0fb-47e7-a962-f07220bb62ec', 4, 15, 'English dare of construct.', DEFAULT, 'Return fit will ability clear.', '90 Minute IPA', 'Penelope Towne') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.458009+00:00:00', '2022-06-22 17:30:30.45946+00:00:00', 'Horse', '2022-06-22 17:30:30.458009+00:00:00', 'Town alter manager fall.', 'identifier assignment', 66, '073aeb5f-dfdd-49c8-a5c3-9fcc1c32ae9e', 4, 15, 'Agency spread rid protect.', DEFAULT, 'Land express result no light.', 'Sierra Nevada Celebration Ale', 'Harrison Howell') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.460629+00:00:00', '2022-06-22 17:30:30.460647+00:00:00', 'md5', '2022-06-22 17:30:30.460629+00:00:00', 'd96b28267615487abde42715c4a9c2fc', 66) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.460644+00:00:00', '2022-06-22 17:30:30.462073+00:00:00', 'sha256', '2022-06-22 17:30:30.460644+00:00:00', '80becdf2ed7c4bc0aead2598de2f2399', 66) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 66, 'http://www.principale-commerce.io/bricks-and-clicks/embrace/leading-edge/envisioneer') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 66, 'http://www.customerstreamline.biz/convergence/innovate') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:30.465438+00:00:00', '2022-06-22 17:30:30.465621+00:00:00', 'amphibians', 163982360732257213, 'test.edu/Tigerlike/data/needwill245.xcodeproj', 15, 'A', '2022-02-22 17:30:30.465438+00:00:00', 4, 'Standard', '0b85004d-d19b-4fc3-b648-6cbf97f19d3b') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.466401+00:00:00', '2022-06-22 17:30:30.466424+00:00:00', 'Duck', '2022-06-22 17:30:30.466401+00:00:00', 'Negotiate mother atmosphere date.', 'ingestion', 67, '7050068b-c672-4830-9821-bf99cf96798d', 4, 15, 'Market island remind institute.', DEFAULT, 'Port remain should focus professor.', 'Sierra Nevada Bigfoot Barleywine Style Ale', 'Reed Jast') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.466417+00:00:00', '2022-06-22 17:30:30.467478+00:00:00', 'Goat', '2022-06-22 17:30:30.466417+00:00:00', 'Work school aim roof.', 'identifier assignment', 67, 'd6eef2d6-56b9-4607-af09-e1c6a6dcfcbe', 4, 15, 'Trust soil board spokesman.', DEFAULT, 'Collection payment foundation teach rid.', 'Samuel Smith’s Imperial IPA', 'Leif Ryan') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.468469+00:00:00', '2022-06-22 17:30:30.468483+00:00:00', 'md5', '2022-06-22 17:30:30.468469+00:00:00', '551e2a41cb934d53b6b68af13b776502', 67) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"checksums\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:30.468478+00:00:00', '2022-06-22 17:30:30.469379+00:00:00', 'sha256', '2022-06-22 17:30:30.468478+00:00:00', '5175ee15831848da8f667a5ce5f9c0e4', 67) RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 67, 'http://www.futureunleash.org/convergence/engage') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 67, 'https://www.internalarchitect.org/portals/scalable/incubate') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.471979+00:00:00', '2022-06-22 17:30:30.472005+00:00:00', 'Horse', '2022-06-22 17:30:30.471979+00:00:00', 'Wall transport panel fall.', 'ingestion', DEFAULT, 'b323df6c-fe3c-4b87-b7de-cda68e6d1942', 4, 15, 'Standard decide thank jones.', DEFAULT, 'Justice council mouth run tackle.', 'Sublimely Self-Righteous Ale', 'Practice Fusion') RETURNING \"id\", \"generic_file_id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:30.471997+00:00:00', '2022-06-22 17:30:30.47305+00:00:00', 'Chicken', '2022-06-22 17:30:30.471997+00:00:00', 'Officer song course try.', 'identifier assignment', DEFAULT, 'f83ab386-0674-4652-9fa8-110c6cf3afc8', 4, 15, 'Pay meet drive position.', DEFAULT, 'Team handle enhance window shoot.', 'Pliny The Elder', 'Marlin & Associates') RETURNING \"id\", \"generic_file_id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\" FROM \"generic_files\" AS \"generic_file\" WHERE ((intellectual_object_id = '15')) ORDER BY \"id\" asc LIMIT 5"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (63, 64, 65, 66, 67))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (63, 64, 65, 66, 67))"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (63, 64, 65, 66, 67))"}
{"level":"info","time":"2022-06-22T13:30:30-04:00","message":"TypeName (1): GenericFile"}
{"level":"info","time":"2022-06-22T13:30:30-04:00","message":"Filter too specific for GenericFile: intellectual_object_id -> institution_id, state"}
{"level":"info","time":"2022-06-22T13:30:30-04:00","message":"API: Using standard count query for '(intellectual_object_id = ?)'"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: SELECT count(*) FROM \"generic_files\" AS \"generic_file\" WHERE ((intellectual_object_id = '15'))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/files?intellectual_object_id=15&page=1&per_page=5&sort=id__asc","ip":"","latency":72.594602,"user-agent":"","time":"2022-06-22T13:30:30-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:30-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: select update_counts();"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\" FROM \"generic_files\" AS \"generic_file\" ORDER BY \"id\" asc LIMIT 5 OFFSET 5"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (6, 7, 8, 9, 10))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (6, 7, 8, 9, 10))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (6, 7, 8, 9, 10))"}
{"level":"info","time":"2022-06-22T13:30:31-04:00","message":"TypeName (1): GenericFile"}
{"level":"info","time":"2022-06-22T13:30:31-04:00","message":"API: Using view to count query ''"}
{"level":"info","time":"2022-06-22T13:30:31-04:00","message":"TypeName (1): GenericFile"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"row_count\" FROM \"generic_file_counts\" AS \"generic_file_count\" WHERE ((institution_id is null) AND (state is null))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/files?page=2&per_page=5&sort=id__asc","ip":"","latency":75.365255,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\" FROM \"generic_files\" AS \"generic_file\" WHERE ((intellectual_object_id = '3') AND (state = 'A')) ORDER BY \"updated_at\" desc LIMIT 20"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (49, 9, 8, 7))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (49, 9, 8, 7))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (49, 9, 8, 7))"}
{"level":"info","time":"2022-06-22T13:30:31-04:00","message":"TypeName (1): GenericFile"}
{"level":"info","time":"2022-06-22T13:30:31-04:00","message":"Filter too specific for GenericFile: intellectual_object_id -> institution_id, state"}
{"level":"info","time":"2022-06-22T13:30:31-04:00","message":"API: Using standard count query for '(intellectual_object_id = ?) AND (state = ?)'"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT count(*) FROM \"generic_files\" AS \"generic_file\" WHERE ((intellectual_object_id = '3') AND (state = 'A'))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/files?intellectual_object_id=3&state=A","ip":"","latency":72.052406,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:31-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.GenericFileIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/files, Request Path: /admin-api/v3/files, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/files","ip":"","latency":1.051635,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:31-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.GenericFileIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/files, Request Path: /admin-api/v3/files, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/files","ip":"","latency":1.119124,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((institution_id = 4)) LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files/create/4"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:31.505396+00:00:00', '2022-06-22 17:30:31.575103+00:00:00', 'fish', 6508931128368460211, 'test.edu/btr-512-test-restore/data/partnermonitor136.rtf', 7, 'A', '2022-02-22 17:30:31.505396+00:00:00', 4, 'Standard', '5b4c5af6-8d2e-4e76-9571-65868d89fd77') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/files/create/4","ip":"","latency":70.906796,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 63)"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files/update/63"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 63) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (63)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (63)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (63))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: UPDATE \"generic_files\" AS \"generic_file\" SET \"created_at\" = '2022-06-22 17:30:31.505396+00:00:00', \"updated_at\" = '2022-06-22 17:30:31.648994+00:00:00', \"file_format\" = 'txt/screed', \"size\" = 6508931128368460411, \"identifier\" = 'test.edu/btr-512-test-restore/data/partnermonitor136.rtf', \"intellectual_object_id\" = 7, \"state\" = 'A', \"last_fixity_check\" = '2022-02-22 17:30:31.505396+00:00:00', \"institution_id\" = 4, \"storage_option\" = 'Standard', \"uuid\" = '5b4c5af6-8d2e-4e76-9571-65868d89fd77' WHERE \"generic_file\".\"id\" = 63"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"PUT","path":"/admin-api/v3/files/update/63","ip":"","latency":73.548804,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 63)"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/63"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 63) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (63)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (63)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (63))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((institution_id = 4) AND (role = 'institutional_admin') AND (\"user\".\"deactivated_at\" is null)) LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:31.722937+00:00:00', '2022-06-22 17:30:31.722955+00:00:00', 'Llama', '2022-06-22 17:30:31.722937+00:00:00', 'Gas argue sign woman.', 'ingestion', 63, '9c10ebcd-43fb-42f9-ab55-3c1bed11933f', 4, 7, 'Paul keep lack variety.', DEFAULT, 'School tom limit manner risk.', 'Arrogant Bastard Ale', 'Jerod Gleason') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: INSERT INTO \"work_items\" (\"id\", \"created_at\", \"updated_at\", \"name\", \"etag\", \"institution_id\", \"intellectual_object_id\", \"generic_file_id\", \"bucket\", \"user\", \"note\", \"action\", \"stage\", \"status\", \"outcome\", \"bag_date\", \"date_processed\", \"retry\", \"node\", \"pid\", \"needs_admin_review\", \"queued_at\", \"size\", \"stage_started_at\", \"aptrust_approver\", \"inst_approver\") VALUES (DEFAULT, '2022-06-22 17:30:31.724294+00:00:00', '2022-06-22 17:30:31.72432+00:00:00', 'btr-512-test-restore', 'c2813b0bd15244f6b5a46a93c4a374ef', 4, 7, 63, 'blah.receiving.blah', 'admin@test.edu', 'This item was created by the factory', 'Delete', 'Requested', 'Started', 'Outcome? WTF?', '2022-02-22 17:30:31.724294+00:00:00', '2022-06-22 17:30:31.724294+00:00:00', TRUE, DEFAULT, DEFAULT, FALSE, '2022-06-22 17:30:31.724294+00:00:00', 8929095457649847393, DEFAULT, DEFAULT, 'admin@test.edu') RETURNING \"id\", \"node\", \"pid\", \"stage_started_at\", \"aptrust_approver\""}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 8))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 8))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: INSERT INTO \"deletion_requests\" (\"id\", \"institution_id\", \"requested_by_id\", \"requested_at\", \"encrypted_confirmation_token\", \"confirmed_by_id\", \"confirmed_at\", \"cancelled_by_id\", \"cancelled_at\", \"work_item_id\") VALUES (DEFAULT, 4, 8, '2022-06-22 17:30:31.725831+00:00:00', '$2a$10$LTNhrG0yotkONfZRbWvz2.KNehCPLEu8FQzXGXd9X894ZBjfKAvla', 8, '2022-06-22 17:30:31.725831+00:00:00', DEFAULT, DEFAULT, 33) RETURNING \"id\", \"cancelled_by_id\", \"cancelled_at\""}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: insert into deletion_requests_generic_files (deletion_request_id, generic_file_id) values (4, 63) on conflict do nothing"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"POST","path":"/admin-api/v3/prepare_file_delete/63","ip":"","latency":150.215255,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 63)"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files/delete/63"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 63) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (63)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (63)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (63))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"work_item\".\"id\", \"work_item\".\"created_at\", \"work_item\".\"updated_at\", \"work_item\".\"name\", \"work_item\".\"etag\", \"work_item\".\"institution_id\", \"work_item\".\"intellectual_object_id\", \"work_item\".\"generic_file_id\", \"work_item\".\"bucket\", \"work_item\".\"user\", \"work_item\".\"note\", \"work_item\".\"action\", \"work_item\".\"stage\", \"work_item\".\"status\", \"work_item\".\"outcome\", \"work_item\".\"bag_date\", \"work_item\".\"date_processed\", \"work_item\".\"retry\", \"work_item\".\"node\", \"work_item\".\"pid\", \"work_item\".\"needs_admin_review\", \"work_item\".\"queued_at\", \"work_item\".\"size\", \"work_item\".\"stage_started_at\", \"work_item\".\"aptrust_approver\", \"work_item\".\"inst_approver\" FROM \"work_items\" AS \"work_item\" WHERE ((generic_file_id = 63 OR intellectual_object_id = 7) AND (action = 'Delete') AND (status = 'Started')) ORDER BY \"updated_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"deletion_request_view\".\"id\", \"deletion_request_view\".\"institution_id\", \"deletion_request_view\".\"institution_name\", \"deletion_request_view\".\"institution_identifier\", \"deletion_request_view\".\"requested_by_id\", \"deletion_request_view\".\"requested_by_name\", \"deletion_request_view\".\"requested_by_email\", \"deletion_request_view\".\"requested_at\", \"deletion_request_view\".\"confirmed_by_id\", \"deletion_request_view\".\"confirmed_by_name\", \"deletion_request_view\".\"confirmed_by_email\", \"deletion_request_view\".\"confirmed_at\", \"deletion_request_view\".\"cancelled_by_id\", \"deletion_request_view\".\"cancelled_by_name\", \"deletion_request_view\".\"cancelled_by_email\", \"deletion_request_view\".\"cancelled_at\", \"deletion_request_view\".\"file_count\", \"deletion_request_view\".\"object_count\", \"deletion_request_view\".\"work_item_id\", \"deletion_request_view\".\"stage\", \"deletion_request_view\".\"status\", \"deletion_request_view\".\"date_processed\", \"deletion_request_view\".\"size\", \"deletion_request_view\".\"note\" FROM \"deletion_requests_view\" AS \"deletion_request_view\" WHERE ((work_item_id = 33))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"work_item\".\"id\", \"work_item\".\"created_at\", \"work_item\".\"updated_at\", \"work_item\".\"name\", \"work_item\".\"etag\", \"work_item\".\"institution_id\", \"work_item\".\"intellectual_object_id\", \"work_item\".\"generic_file_id\", \"work_item\".\"bucket\", \"work_item\".\"user\", \"work_item\".\"note\", \"work_item\".\"action\", \"work_item\".\"stage\", \"work_item\".\"status\", \"work_item\".\"outcome\", \"work_item\".\"bag_date\", \"work_item\".\"date_processed\", \"work_item\".\"retry\", \"work_item\".\"node\", \"work_item\".\"pid\", \"work_item\".\"needs_admin_review\", \"work_item\".\"queued_at\", \"work_item\".\"size\", \"work_item\".\"stage_started_at\", \"work_item\".\"aptrust_approver\", \"work_item\".\"inst_approver\" FROM \"work_items\" AS \"work_item\" WHERE ((generic_file_id = 63 OR intellectual_object_id = 7) AND (action = 'Delete') AND (status = 'Started')) ORDER BY \"updated_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"deletion_request_view\".\"id\", \"deletion_request_view\".\"institution_id\", \"deletion_request_view\".\"institution_name\", \"deletion_request_view\".\"institution_identifier\", \"deletion_request_view\".\"requested_by_id\", \"deletion_request_view\".\"requested_by_name\", \"deletion_request_view\".\"requested_by_email\", \"deletion_request_view\".\"requested_at\", \"deletion_request_view\".\"confirmed_by_id\", \"deletion_request_view\".\"confirmed_by_name\", \"deletion_request_view\".\"confirmed_by_email\", \"deletion_request_view\".\"confirmed_at\", \"deletion_request_view\".\"cancelled_by_id\", \"deletion_request_view\".\"cancelled_by_name\", \"deletion_request_view\".\"cancelled_by_email\", \"deletion_request_view\".\"cancelled_at\", \"deletion_request_view\".\"file_count\", \"deletion_request_view\".\"object_count\", \"deletion_request_view\".\"work_item_id\", \"deletion_request_view\".\"stage\", \"deletion_request_view\".\"status\", \"deletion_request_view\".\"date_processed\", \"deletion_request_view\".\"size\", \"deletion_request_view\".\"note\" FROM \"deletion_requests_view\" AS \"deletion_request_view\" WHERE ((work_item_id = 33))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: UPDATE \"generic_files\" AS \"generic_file\" SET \"created_at\" = '2022-06-22 17:30:31.505396+00:00:00', \"updated_at\" = '2022-06-22 17:30:31.880156+00:00:00', \"file_format\" = 'txt/screed', \"size\" = 6508931128368460411, \"identifier\" = 'test.edu/btr-512-test-restore/data/partnermonitor136.rtf', \"intellectual_object_id\" = 7, \"state\" = 'D', \"last_fixity_check\" = '2022-02-22 17:30:31.505396+00:00:00', \"institution_id\" = 4, \"storage_option\" = 'Standard', \"uuid\" = '5b4c5af6-8d2e-4e76-9571-65868d89fd77' WHERE \"generic_file\".\"id\" = 63"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:31.883709+00:00:00', '2022-06-22 17:30:31.883709+00:00:00', 'APTrust preservation services', '2022-06-22 17:30:31.883691+00:00:00', 'All copies of this file have been deleted from preservation storage', 'deletion', 63, 'b9df5a89-dfc6-4a8a-beff-1461e375d35c', 4, 7, 'Minio S3 library', DEFAULT, 'Success', 'admin@test.edu', 'File deleted at the request of admin@test.edu. Institutional approver: admin@test.edu. This event confirms all preservation copies have been deleted.') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"DELETE","path":"/admin-api/v3/files/delete/63","ip":"","latency":85.35875,"user-agent":"","time":"2022-06-22T13:30:31-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 63) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (63)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (63)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (63))"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 63) AND (event_type = 'deletion')) ORDER BY \"created_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:31-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: select update_counts();"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"intellectual_objects\" (\"id\", \"created_at\", \"updated_at\", \"title\", \"description\", \"identifier\", \"alt_identifier\", \"access\", \"bag_name\", \"institution_id\", \"state\", \"etag\", \"bag_group_identifier\", \"storage_option\", \"bagit_profile_identifier\", \"source_organization\", \"internal_sender_identifier\", \"internal_sender_description\") VALUES (DEFAULT, '2022-06-22 17:30:32.424484+00:00:00', '2022-06-22 17:30:32.424484+00:00:00', 'cross-platform Stand-alone reintermediate', 'The TCP driver is down, generate the 1080p hard drive so we can hack the JBOD pixel!', 'test.edu/Lordowe', 'Donkey', 'institution', 'open-source.tar', 4, 'A', '31532d10ef234726885bd107706263cd', 'beauty', 'Standard', 'https://example.com/profile.json', 'Test University', 'Hairy Paw-ter', 'Marfa trust fund chia bicycle rights listicle vinyl distillery mixtape plaid fingerstache street dreamcatcher.') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"IsAPIRoute - YES - /admin-api/v3/files/create_batch/4"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.425967+00:00:00', '2022-06-22 17:30:32.502545+00:00:00', 'reptiles', 7076879028683699148, 'test.edu/Lordowe/data/communityexist740.exe', 15, 'A', '2022-02-22 17:30:32.425967+00:00:00', 4, 'Standard', '86ffc683-787b-4841-b017-d2be678b7eb4') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.425991+00:00:00', '2022-06-22 17:30:32.503302+00:00:00', 'sha1', '2022-06-22 17:30:32.425991+00:00:00', 'c14a70bc197f4651b8aca4d471331825', 63) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426006+00:00:00', '2022-06-22 17:30:32.504201+00:00:00', 'sha1', '2022-06-22 17:30:32.426006+00:00:00', 'cd8704fe67e54eaca4d71fcd981fe0b4', 63) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426043+00:00:00', '2022-06-22 17:30:32.504794+00:00:00', 'sha1', '2022-06-22 17:30:32.426043+00:00:00', '42cf0ff3989f46dea785ce19c8a43060', 63) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426053+00:00:00', '2022-06-22 17:30:32.505308+00:00:00', 'sha1', '2022-06-22 17:30:32.426053+00:00:00', '02d072136ebf4eb89473168d87418688', 63) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 63, 'https://www.internationalinfrastructures.org/visualize/viral/seamless') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 63, 'https://www.internationale-business.net/architect/synergistic/streamline') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 63, 'https://www.chiefdot-com.org/relationships') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 63, 'https://www.districtsexy.com/integrate') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.425982+00:00:00', '2022-06-22 17:30:32.508709+00:00:00', 'Sheep', '2022-06-22 17:30:32.425982+00:00:00', 'Majority police dad direct.', 'ingestion', 63, 'c361dd0e-fd4a-4c10-a1cd-4c3e3424ac2c', 4, 15, 'Collection judge show do.', DEFAULT, 'Success', 'Two Hearted Ale', 'IW Financial') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.425999+00:00:00', '2022-06-22 17:30:32.509343+00:00:00', 'Cow', '2022-06-22 17:30:32.425999+00:00:00', 'Turn voice display touch.', 'ingestion', 63, 'cfda52c9-c3da-4c14-98ed-3f46315b2542', 4, 15, 'Travel plan frank case.', DEFAULT, 'Success', 'Weihenstephaner Hefeweissbier', 'iFactor Consulting') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426035+00:00:00', '2022-06-22 17:30:32.50984+00:00:00', 'Sheep', '2022-06-22 17:30:32.426035+00:00:00', 'Lane report walk transfer.', 'ingestion', 63, '21cda50e-3207-4db1-858b-1a6829986e41', 4, 15, 'Welcome damage method separate.', DEFAULT, 'Success', 'Hercules Double IPA', 'Teresa Leffler') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426047+00:00:00', '2022-06-22 17:30:32.51043+00:00:00', 'Sheep', '2022-06-22 17:30:32.426047+00:00:00', 'Study design brown rise.', 'ingestion', 63, '283dac88-2561-4782-b19d-66f76b0d55b7', 4, 15, 'Fit practise us flight.', DEFAULT, 'Success', 'Schneider Aventinus', 'Spikes Cavell Analytic Inc') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426056+00:00:00', '2022-06-22 17:30:32.511236+00:00:00', 'mammals', 5436369073258916054, 'test.edu/Lordowe/data/teaparticipate909.wpd', 15, 'A', '2022-02-22 17:30:32.426056+00:00:00', 4, 'Standard', '4769fe07-9b80-4dc5-8a9c-a7ae5867cb46') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426066+00:00:00', '2022-06-22 17:30:32.512+00:00:00', 'sha1', '2022-06-22 17:30:32.426066+00:00:00', 'd4deaccc95bc4e2dacb4bfc1a2ac7bf2', 64) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426079+00:00:00', '2022-06-22 17:30:32.512896+00:00:00', 'sha1', '2022-06-22 17:30:32.426079+00:00:00', '32af81ad2f6b407a9832991f4d21778e', 64) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426087+00:00:00', '2022-06-22 17:30:32.513534+00:00:00', 'sha1', '2022-06-22 17:30:32.426087+00:00:00', 'ea977dfc2363470aabdc2c5839595922', 64) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426096+00:00:00', '2022-06-22 17:30:32.51398+00:00:00', 'sha1', '2022-06-22 17:30:32.426096+00:00:00', 'a0736999c9e04fa7ac346a9f21e12dc6', 64) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 64, 'http://www.seniorinteractive.info/global/networks') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 64, 'http://www.globalexperiences.org/disintermediate/turn-key') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 64, 'http://www.corporateenterprise.biz/grow/empower') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 64, 'http://www.nationalcross-media.com/dot-com/b2b/extend') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42606+00:00:00', '2022-06-22 17:30:32.516545+00:00:00', 'Donkey', '2022-06-22 17:30:32.42606+00:00:00', 'Try police persuade show.', 'ingestion', 64, '779a4354-5fe5-4273-aba5-c5900c64b70a', 4, 15, 'Government feel watch figure.', DEFAULT, 'Success', 'Chocolate St', 'Cathryn Johnson') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42607+00:00:00', '2022-06-22 17:30:32.517041+00:00:00', 'Pig', '2022-06-22 17:30:32.42607+00:00:00', 'English insurance liability distinguish.', 'ingestion', 64, 'bf91b275-ab38-4e33-8934-7ae515f50480', 4, 15, 'Seat belong identity decline.', DEFAULT, 'Success', 'Old Rasputin Russian Imperial Stout', 'Devonte Eichmann') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426082+00:00:00', '2022-06-22 17:30:32.517537+00:00:00', 'Pig', '2022-06-22 17:30:32.426082+00:00:00', 'Care hurt formation manage.', 'ingestion', 64, '77dc23aa-5c60-4a93-aea4-8417d027de41', 4, 15, 'Stuff wish manage deliver.', DEFAULT, 'Success', 'Founders Kentucky Breakfast', 'Knowledge Agency') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426091+00:00:00', '2022-06-22 17:30:32.517986+00:00:00', 'Sheep', '2022-06-22 17:30:32.426091+00:00:00', 'Total vote repeat risk.', 'ingestion', 64, '041eec42-d7ce-43f4-8f43-41ad129e6f2c', 4, 15, 'Future bath feel deal.', DEFAULT, 'Success', 'Celebrator Doppelbock', 'Factual') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426101+00:00:00', '2022-06-22 17:30:32.518436+00:00:00', 'amphibians', 7740161181642424469, 'test.edu/Lordowe/data/eastexercise762.rtf', 15, 'A', '2022-02-22 17:30:32.426101+00:00:00', 4, 'Standard', '76cd5d65-3202-4de7-b05b-045393ed346d') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426109+00:00:00', '2022-06-22 17:30:32.518879+00:00:00', 'sha1', '2022-06-22 17:30:32.426109+00:00:00', '980536225ad44124b584f572217f6601', 65) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426118+00:00:00', '2022-06-22 17:30:32.519316+00:00:00', 'sha1', '2022-06-22 17:30:32.426118+00:00:00', '294ef4e1d70d4384978e8333d297bd61', 65) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426126+00:00:00', '2022-06-22 17:30:32.519747+00:00:00', 'sha1', '2022-06-22 17:30:32.426126+00:00:00', '25ff9ab6999544aca82111481ecbf59c', 65) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426135+00:00:00', '2022-06-22 17:30:32.520207+00:00:00', 'sha1', '2022-06-22 17:30:32.426135+00:00:00', '4653e09b78e242d68300840d43ed167c', 65) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 65, 'https://www.chiefroi.name/synergistic') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 65, 'https://www.centraldeliver.com/b2c/relationships') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 65, 'http://www.humanaggregate.info/orchestrate/viral/deploy/24-365') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 65, 'http://www.investorembrace.net/partnerships/brand/seize') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426104+00:00:00', '2022-06-22 17:30:32.522542+00:00:00', 'Donkey', '2022-06-22 17:30:32.426104+00:00:00', 'Insist be question panel.', 'ingestion', 65, 'be6796b1-a175-4ccb-acbf-a6730ea0cd1e', 4, 15, 'Draw rely structure self.', DEFAULT, 'Success', 'Maudite', 'Overture Technologies') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426113+00:00:00', '2022-06-22 17:30:32.523066+00:00:00', 'Pig', '2022-06-22 17:30:32.426113+00:00:00', 'Achieve drop mark borrow.', 'ingestion', 65, 'f9b92c06-0af7-400d-ae8f-1c27f228660f', 4, 15, 'Drive guide video lead.', DEFAULT, 'Success', 'Edmund Fitzgerald Porter', 'ClearStory Data') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426121+00:00:00', '2022-06-22 17:30:32.523611+00:00:00', 'Horse', '2022-06-22 17:30:32.426121+00:00:00', 'Rest name tv emerge.', 'ingestion', 65, 'c65a98c6-8bcc-41a3-a632-2b3fb9b5588a', 4, 15, 'Distance independence want minute.', DEFAULT, 'Success', 'Storm King Stout', 'Beverly Hessel') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42613+00:00:00', '2022-06-22 17:30:32.524099+00:00:00', 'Donkey', '2022-06-22 17:30:32.42613+00:00:00', 'Land shift fit reputation.', 'ingestion', 65, '895b0af8-8071-43d8-9eb9-a3408722ea65', 4, 15, 'Palace clause oxford level.', DEFAULT, 'Success', 'Hercules Double IPA', 'OnDeck') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426142+00:00:00', '2022-06-22 17:30:32.524619+00:00:00', 'mammals', 3855858498330200724, 'test.edu/Lordowe/data/dealassist717.dds', 15, 'A', '2022-02-22 17:30:32.426142+00:00:00', 4, 'Standard', '23f5101d-eb73-4a22-91d0-ff895e68a86f') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426152+00:00:00', '2022-06-22 17:30:32.525108+00:00:00', 'sha1', '2022-06-22 17:30:32.426152+00:00:00', 'c4596d527c6847c3ba787cee6bf1b318', 66) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426161+00:00:00', '2022-06-22 17:30:32.525557+00:00:00', 'sha1', '2022-06-22 17:30:32.426161+00:00:00', '997227d359474d3aa522ed7f5ec6594a', 66) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42617+00:00:00', '2022-06-22 17:30:32.525957+00:00:00', 'sha1', '2022-06-22 17:30:32.42617+00:00:00', 'e8e4eae86d494dc8973251107b007ff7', 66) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426178+00:00:00', '2022-06-22 17:30:32.526414+00:00:00', 'sha1', '2022-06-22 17:30:32.426178+00:00:00', '6b9b2836c71c476b9c18ff6b18a5fe9e', 66) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 66, 'https://www.principaldeploy.com/convergence/channels/revolutionize') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 66, 'https://www.globalmaximize.biz/bandwidth/web-enabled/experiences/exploit') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 66, 'http://www.centralout-of-the-box.io/viral/evolve') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 66, 'http://www.chiefexploit.com/collaborative/architectures/empower') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426145+00:00:00', '2022-06-22 17:30:32.529418+00:00:00', 'Duck', '2022-06-22 17:30:32.426145+00:00:00', 'Study investigate emphasis variety.', 'ingestion', 66, '8046f2bc-f491-47dd-9a74-ff5effc86fd9', 4, 15, 'Offer recover reason preserve.', DEFAULT, 'Success', 'Orval Trappist Ale', 'Stevens Worldwide Van Lines') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426156+00:00:00', '2022-06-22 17:30:32.529924+00:00:00', 'Goose', '2022-06-22 17:30:32.426156+00:00:00', 'Create heart soil drink.', 'ingestion', 66, 'f23cb56b-2365-4f92-897a-805cb1dcc067', 4, 15, 'Thatcher split cancer love.', DEFAULT, 'Success', 'Dreadnaught IPA', 'Addie Romaguera') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426165+00:00:00', '2022-06-22 17:30:32.530412+00:00:00', 'Chicken', '2022-06-22 17:30:32.426165+00:00:00', 'Court complain lie admit.', 'ingestion', 66, 'a3a46c28-df0b-4842-9d6f-5466c5049f31', 4, 15, 'Difficulty order conclude conduct.', DEFAULT, 'Success', 'Hercules Double IPA', 'Keyshawn Howell') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426174+00:00:00', '2022-06-22 17:30:32.53095+00:00:00', 'Turkey', '2022-06-22 17:30:32.426174+00:00:00', 'Like stand must panel.', 'ingestion', 66, '46de648d-5cd0-4892-bfdb-cb5ba4c74f82', 4, 15, 'Allow lift abuse permit.', DEFAULT, 'Success', 'Bell’s Expedition', 'Fausto Koss') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426182+00:00:00', '2022-06-22 17:30:32.531416+00:00:00', 'fish', 7844759876545294087, 'test.edu/Lordowe/data/dayapply199.pdf', 15, 'A', '2022-02-22 17:30:32.426182+00:00:00', 4, 'Standard', '8421baf5-64c9-4ece-b081-4689d023f95e') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42619+00:00:00', '2022-06-22 17:30:32.531862+00:00:00', 'sha1', '2022-06-22 17:30:32.42619+00:00:00', '9226bee57d86401380b0e7e684fa7bca', 67) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426198+00:00:00', '2022-06-22 17:30:32.532349+00:00:00', 'sha1', '2022-06-22 17:30:32.426198+00:00:00', 'a903b5551ea74952bf0e61c65dee9920', 67) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426206+00:00:00', '2022-06-22 17:30:32.532817+00:00:00', 'sha1', '2022-06-22 17:30:32.426206+00:00:00', 'bdcdec76f5e6422faa79ec84dbfd1f43', 67) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426214+00:00:00', '2022-06-22 17:30:32.533264+00:00:00', 'sha1', '2022-06-22 17:30:32.426214+00:00:00', 'e317235181404457a077b0b8d4e4d07f', 67) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 67, 'https://www.humansynergies.name/matrix/e-markets') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 67, 'https://www.regionalchannels.org/grow/engineer/synergies') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 67, 'http://www.regionalintegrated.net/revolutionize') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 67, 'http://www.globalsystems.org/iterate/cross-platform/wireless/infomediaries') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426184+00:00:00', '2022-06-22 17:30:32.535624+00:00:00', 'Sheep', '2022-06-22 17:30:32.426184+00:00:00', 'Proportion worker owner legislation.', 'ingestion', 67, '30b60977-446e-48d5-aef0-123be331c6b8', 4, 15, 'Prepare give solve identify.', DEFAULT, 'Success', 'Old Rasputin Russian Imperial Stout', 'Annabel Sauer') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426193+00:00:00', '2022-06-22 17:30:32.536204+00:00:00', 'Cow', '2022-06-22 17:30:32.426193+00:00:00', 'Emerge cash name vote.', 'ingestion', 67, '810f9d49-c20a-4b54-8ba4-96f4bf6cda09', 4, 15, 'Extend imagine motor study.', DEFAULT, 'Success', 'Brooklyn Black', 'Pedro Dach') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426201+00:00:00', '2022-06-22 17:30:32.536745+00:00:00', 'Duck', '2022-06-22 17:30:32.426201+00:00:00', 'May bring purchase pub.', 'ingestion', 67, '240ba269-47a7-4ece-8772-cbf60148fc31', 4, 15, 'Entry sugar face split.', DEFAULT, 'Success', 'Hercules Double IPA', 'Henderson Schinner') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426209+00:00:00', '2022-06-22 17:30:32.537242+00:00:00', 'Cow', '2022-06-22 17:30:32.426209+00:00:00', 'Direct possess determine publication.', 'ingestion', 67, '623bfbd4-8a1a-466d-8ac0-182b27478d55', 4, 15, 'Handle employment match rid.', DEFAULT, 'Success', 'Samuel Smith’s Imperial IPA', 'Chase Schiller') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426219+00:00:00', '2022-06-22 17:30:32.537715+00:00:00', 'mammals', 8550560607232578627, 'test.edu/Lordowe/data/peacefinish207.pdb', 15, 'A', '2022-02-22 17:30:32.426219+00:00:00', 4, 'Standard', '3e1bbecd-dfca-4e59-99ff-d7aab3a28e5b') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426226+00:00:00', '2022-06-22 17:30:32.538219+00:00:00', 'sha1', '2022-06-22 17:30:32.426226+00:00:00', '99f633a5e880414b9b19a3588b2fcc87', 68) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426234+00:00:00', '2022-06-22 17:30:32.53867+00:00:00', 'sha1', '2022-06-22 17:30:32.426234+00:00:00', '6534e389e8df488993d63def68747542', 68) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426242+00:00:00', '2022-06-22 17:30:32.539116+00:00:00', 'sha1', '2022-06-22 17:30:32.426242+00:00:00', 'bd75ae2b60ec4741bfed9a11d86c4fde', 68) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426251+00:00:00', '2022-06-22 17:30:32.539555+00:00:00', 'sha1', '2022-06-22 17:30:32.426251+00:00:00', '8ae3762d174b472289b48acc2796f350', 68) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 68, 'http://www.seniorinfrastructures.info/innovate/web-enabled') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 68, 'http://www.centralchannels.io/cutting-edge') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 68, 'http://www.futureleverage.name/cultivate/orchestrate/innovate') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 68, 'https://www.districtutilize.biz/transition/bleeding-edge/whiteboard') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426221+00:00:00', '2022-06-22 17:30:32.541809+00:00:00', 'Chicken', '2022-06-22 17:30:32.426221+00:00:00', 'Pub influence hell occur.', 'ingestion', 68, 'bba86d1d-1764-4d39-b483-90df63e53b76', 4, 15, 'Computer lead define appeal.', DEFAULT, 'Success', 'Storm King Stout', 'Felix Schulist') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426229+00:00:00', '2022-06-22 17:30:32.542311+00:00:00', 'Goose', '2022-06-22 17:30:32.426229+00:00:00', 'Develop fact prove danger.', 'ingestion', 68, 'c0438fca-4e02-47b4-b7ab-0587b852a842', 4, 15, 'Wish indicate film protection.', DEFAULT, 'Success', 'Trappistes Rochefort 8', 'Civic Insight') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426237+00:00:00', '2022-06-22 17:30:32.542755+00:00:00', 'Duck', '2022-06-22 17:30:32.426237+00:00:00', 'Release average institution boy.', 'ingestion', 68, '2321f1a9-9a7b-4146-932f-31a5c37849db', 4, 15, 'Employ sister lift link.', DEFAULT, 'Success', 'Maudite', 'Tableau Software') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426245+00:00:00', '2022-06-22 17:30:32.543274+00:00:00', 'Chicken', '2022-06-22 17:30:32.426245+00:00:00', 'Match withdraw disease board.', 'ingestion', 68, 'adf8e404-9b3b-43f9-94bb-32c0c602669e', 4, 15, '''re propose compete knock.', DEFAULT, 'Success', 'Pliny The Elder', 'Keychain Logistics Corp.') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426254+00:00:00', '2022-06-22 17:30:32.544095+00:00:00', 'mammals', 6957258121959840602, 'test.edu/Lordowe/data/morningcompete545.cpl', 15, 'A', '2022-02-22 17:30:32.426254+00:00:00', 4, 'Standard', '597eb1c7-497b-4d6d-a8ff-7e274576be76') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426262+00:00:00', '2022-06-22 17:30:32.545012+00:00:00', 'sha1', '2022-06-22 17:30:32.426262+00:00:00', '250d932c438744ee93bf1d67db279b84', 69) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426271+00:00:00', '2022-06-22 17:30:32.54552+00:00:00', 'sha1', '2022-06-22 17:30:32.426271+00:00:00', '8a7cfa2bd124425eb7686bfbf2964bac', 69) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42628+00:00:00', '2022-06-22 17:30:32.546043+00:00:00', 'sha1', '2022-06-22 17:30:32.42628+00:00:00', '8d0469cbb2584941a0e6e18e04085135', 69) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42629+00:00:00', '2022-06-22 17:30:32.546584+00:00:00', 'sha1', '2022-06-22 17:30:32.42629+00:00:00', 'c45a0fdd7ac84e0e81e85cac77f0a8a9', 69) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 69, 'http://www.districtarchitectures.com/bricks-and-clicks/brand') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 69, 'https://www.directtransparent.io/b2b/e-business/e-commerce/solutions') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 69, 'http://www.regionalcultivate.com/users/visualize/target') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 69, 'http://www.districttransparent.io/technologies/reinvent/webservices') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426257+00:00:00', '2022-06-22 17:30:32.548814+00:00:00', 'Chicken', '2022-06-22 17:30:32.426257+00:00:00', 'Collect treat find measure.', 'ingestion', 69, '5baa84d2-3bb9-4b93-884f-a7689f2ab63d', 4, 15, 'Damage responsibility john competition.', DEFAULT, 'Success', 'Duvel', 'Everyday Health') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426265+00:00:00', '2022-06-22 17:30:32.549282+00:00:00', 'Duck', '2022-06-22 17:30:32.426265+00:00:00', 'Rule tax drive silver.', 'ingestion', 69, '9c60acc1-8dff-4db1-bf38-a1fc125d84e5', 4, 15, 'Vehicle appointment source seek.', DEFAULT, 'Success', 'Founders Kentucky Breakfast', 'Marietta Paucek') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426276+00:00:00', '2022-06-22 17:30:32.549782+00:00:00', 'Cow', '2022-06-22 17:30:32.426276+00:00:00', 'Price contact promote victory.', 'ingestion', 69, '048b0abc-1e6f-4634-9051-cdc2d70f04be', 4, 15, 'Push repeat prepare cover.', DEFAULT, 'Success', 'Ruination IPA', 'SpaceCurve') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426285+00:00:00', '2022-06-22 17:30:32.550324+00:00:00', 'Turkey', '2022-06-22 17:30:32.426285+00:00:00', 'Intelligence plan argument control.', 'ingestion', 69, '9f722b7d-bdcd-4024-8d13-b3f9f9803f63', 4, 15, 'Promise time introduce concern.', DEFAULT, 'Success', 'Alpha King Pale Ale', 'Birdie Reichert') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426294+00:00:00', '2022-06-22 17:30:32.550823+00:00:00', 'amphibians', 4129932996928304347, 'test.edu/Lordowe/data/rangebreak139.msi', 15, 'A', '2022-02-22 17:30:32.426294+00:00:00', 4, 'Standard', '8ed45c7d-4fcc-443f-b9bb-39f5ea61b3dd') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426303+00:00:00', '2022-06-22 17:30:32.551326+00:00:00', 'sha1', '2022-06-22 17:30:32.426303+00:00:00', 'b4515fa36226436c83d62dd9b2de9266', 70) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426311+00:00:00', '2022-06-22 17:30:32.551778+00:00:00', 'sha1', '2022-06-22 17:30:32.426311+00:00:00', '7164fca5412a47839403d478bc78533a', 70) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426319+00:00:00', '2022-06-22 17:30:32.552202+00:00:00', 'sha1', '2022-06-22 17:30:32.426319+00:00:00', '7d52ffdcab3a4a09ae52d42b699fb593', 70) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426327+00:00:00', '2022-06-22 17:30:32.552639+00:00:00', 'sha1', '2022-06-22 17:30:32.426327+00:00:00', '2c1b51cf7f9245c6b73d48e2e6d17587', 70) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 70, 'http://www.centralmorph.biz/maximize/utilize/functionalities') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 70, 'http://www.senioropen-source.name/synergistic/deploy/user-centric/cultivate') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 70, 'http://www.leadend-to-end.org/users') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 70, 'http://www.centralbandwidth.biz/implement') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426296+00:00:00', '2022-06-22 17:30:32.554895+00:00:00', 'Llama', '2022-06-22 17:30:32.426296+00:00:00', 'Illustrate kingdom expect review.', 'ingestion', 70, '94ce214e-c9c4-46be-8461-d243ea5e31a0', 4, 15, 'Owner meet winter stop.', DEFAULT, 'Success', 'Founders Kentucky Breakfast', 'Tyler Becker') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426306+00:00:00', '2022-06-22 17:30:32.555464+00:00:00', 'Duck', '2022-06-22 17:30:32.426306+00:00:00', 'Curriculum bottom differ alternative.', 'ingestion', 70, '63879f80-2fb3-44eb-b55e-f46750d17c09', 4, 15, 'Television burn cause fish.', DEFAULT, 'Success', 'Nugget Nectar', 'Chemical Abstracts Service') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426314+00:00:00', '2022-06-22 17:30:32.555996+00:00:00', 'Pig', '2022-06-22 17:30:32.426314+00:00:00', 'Match middle goal exercise.', 'ingestion', 70, '5a8115c2-6f57-4781-a634-0ed1b338b1ac', 4, 15, 'Impression end vote day.', DEFAULT, 'Success', 'Péché Mortel', 'Jocelyn Wilkinson') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426322+00:00:00', '2022-06-22 17:30:32.556519+00:00:00', 'Sheep', '2022-06-22 17:30:32.426322+00:00:00', 'Event framework indicate picture.', 'ingestion', 70, '5a7532cf-97d5-4a9d-9e47-8746d6b6c72b', 4, 15, 'Visit fruit competition pursue.', DEFAULT, 'Success', 'Bourbon County Stout', 'Otilia Schuppe') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.42633+00:00:00', '2022-06-22 17:30:32.556976+00:00:00', 'mammals', 5698208103603461936, 'test.edu/Lordowe/data/furnitureassist396.pl', 15, 'A', '2022-02-22 17:30:32.42633+00:00:00', 4, 'Standard', '866e7a5e-300d-4f87-9a4d-d4c293411dad') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426337+00:00:00', '2022-06-22 17:30:32.557447+00:00:00', 'sha1', '2022-06-22 17:30:32.426337+00:00:00', '3ec8a562aab24c81bda8711bf95aa744', 71) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426345+00:00:00', '2022-06-22 17:30:32.557907+00:00:00', 'sha1', '2022-06-22 17:30:32.426345+00:00:00', '5d7ec322c4bb499792945a3229b5b24b', 71) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426354+00:00:00', '2022-06-22 17:30:32.558341+00:00:00', 'sha1', '2022-06-22 17:30:32.426354+00:00:00', '74c86cbc606d4a5db7f745ed07544c64', 71) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426362+00:00:00', '2022-06-22 17:30:32.559053+00:00:00', 'sha1', '2022-06-22 17:30:32.426362+00:00:00', '9bd531b2200949139cbfde82a5cf3b8d', 71) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 71, 'https://www.nationalturn-key.info/open-source/intuitive/incentivize/virtual') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 71, 'https://www.customerturn-key.name/e-business/real-time') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 71, 'http://www.dynamicarchitectures.com/best-of-breed/convergence/best-of-breed/robust') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 71, 'http://www.districtbleeding-edge.org/transparent') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426332+00:00:00', '2022-06-22 17:30:32.563435+00:00:00', 'Chicken', '2022-06-22 17:30:32.426332+00:00:00', 'Newspaper qualify strike occur.', 'ingestion', 71, '5a66ea58-9063-4700-8066-a9773ad92a00', 4, 15, 'Power demonstrate apply curriculum.', DEFAULT, 'Success', 'Chimay Grande Réserve', 'Vito Kunze') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42634+00:00:00', '2022-06-22 17:30:32.564009+00:00:00', 'Pig', '2022-06-22 17:30:32.42634+00:00:00', 'Touch act depend danger.', 'ingestion', 71, '83591c06-27c7-4ee1-9d5e-eb168f9babc9', 4, 15, 'Convention director ensure bear.', DEFAULT, 'Success', 'Racer 5 India Pale Ale, Bear Republic Bre', 'Norene Metz') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426349+00:00:00', '2022-06-22 17:30:32.564503+00:00:00', 'Goose', '2022-06-22 17:30:32.426349+00:00:00', 'Wish receive republic customer.', 'ingestion', 71, '02a027e4-e369-4558-8528-12ea816645cf', 4, 15, 'Ring aim cause technology.', DEFAULT, 'Success', 'Pliny The Elder', 'Shaina Ortiz') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426358+00:00:00', '2022-06-22 17:30:32.564923+00:00:00', 'Chicken', '2022-06-22 17:30:32.426358+00:00:00', 'Match gather rid leave.', 'ingestion', 71, '443cc8b9-fa08-4dfb-bd7a-076bfa9e8741', 4, 15, 'House surface college win.', DEFAULT, 'Success', 'Founders Kentucky Breakfast', 'Galorath Incorporated') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426365+00:00:00', '2022-06-22 17:30:32.565338+00:00:00', 'fish', 7928366119684111719, 'test.edu/Lordowe/data/impactdiffer189.zipx', 15, 'A', '2022-02-22 17:30:32.426365+00:00:00', 4, 'Standard', '3c9d047f-0f0a-444b-ae35-c13b4376d9f1') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426372+00:00:00', '2022-06-22 17:30:32.565742+00:00:00', 'sha1', '2022-06-22 17:30:32.426372+00:00:00', '13e01a246d9e4b269605cbbcd613c8a3', 72) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42638+00:00:00', '2022-06-22 17:30:32.566169+00:00:00', 'sha1', '2022-06-22 17:30:32.42638+00:00:00', 'cda7b2a839d64138ba30586f1f293620', 72) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426387+00:00:00', '2022-06-22 17:30:32.566527+00:00:00', 'sha1', '2022-06-22 17:30:32.426387+00:00:00', '73508e22fe994924a1d0bca6632e1232', 72) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426395+00:00:00', '2022-06-22 17:30:32.566894+00:00:00', 'sha1', '2022-06-22 17:30:32.426395+00:00:00', '34c58b372682425bbe4da1218a550f27', 72) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 72, 'https://www.forwarditerate.net/reinvent/orchestrate') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 72, 'https://www.futurevirtual.com/channels/empower/customized') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 72, 'https://www.dynamicrevolutionize.org/generate/embrace/bleeding-edge/interfaces') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 72, 'https://www.principalweb-enabled.io/frictionless/revolutionize/viral/best-of-breed') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426367+00:00:00', '2022-06-22 17:30:32.569201+00:00:00', 'Cow', '2022-06-22 17:30:32.426367+00:00:00', 'Paint base push vehicle.', 'ingestion', 72, '53fe1969-1cb7-4aaa-8a8b-ca6b11a0ab43', 4, 15, 'Require list steel variety.', DEFAULT, 'Success', 'Double Bastard Ale', 'SigFig') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426375+00:00:00', '2022-06-22 17:30:32.569782+00:00:00', 'Pig', '2022-06-22 17:30:32.426375+00:00:00', 'Method end sustain end.', 'ingestion', 72, '983089f5-5f93-4578-8dea-884c9ce2134a', 4, 15, 'Send comparison bishop alter.', DEFAULT, 'Success', 'Alpha King Pale Ale', 'Elta Goodwin') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426383+00:00:00', '2022-06-22 17:30:32.5703+00:00:00', 'Pig', '2022-06-22 17:30:32.426383+00:00:00', 'Task authority house sell.', 'ingestion', 72, 'e8a86466-fc0b-43e0-ac0b-cf78b4293b1d', 4, 15, 'Model passage notice begin.', DEFAULT, 'Success', 'Yeti Imperial Stout', 'Xatori') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426391+00:00:00', '2022-06-22 17:30:32.570809+00:00:00', 'Llama', '2022-06-22 17:30:32.426391+00:00:00', 'Monitor advise series of.', 'ingestion', 72, '29609f7f-621f-4199-8ac8-39b5488a9ef1', 4, 15, 'Procedure air distribution assume.', DEFAULT, 'Success', 'Hennepin', 'Teradata') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426399+00:00:00', '2022-06-22 17:30:32.571284+00:00:00', 'invertebrates', 8837109075287164330, 'test.edu/Lordowe/data/silvercome545.ged', 15, 'A', '2022-02-22 17:30:32.426399+00:00:00', 4, 'Standard', 'd821b971-407d-4711-b996-a00db46c6f74') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426406+00:00:00', '2022-06-22 17:30:32.571786+00:00:00', 'sha1', '2022-06-22 17:30:32.426406+00:00:00', '0eaecb6deec84e5f989b67ef5055aa2d', 73) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426413+00:00:00', '2022-06-22 17:30:32.57224+00:00:00', 'sha1', '2022-06-22 17:30:32.426413+00:00:00', '49be7a39e7394cee9a0a3fab9411390d', 73) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426421+00:00:00', '2022-06-22 17:30:32.572729+00:00:00', 'sha1', '2022-06-22 17:30:32.426421+00:00:00', '10be7dc6560144d29b110fbb52082202', 73) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42643+00:00:00', '2022-06-22 17:30:32.573134+00:00:00', 'sha1', '2022-06-22 17:30:32.42643+00:00:00', '707be8c27fe146c882153f0d403f0b48', 73) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 73, 'http://www.seniorproductize.net/scale/transition') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 73, 'http://www.nationaldot-com.net/innovate/engineer') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 73, 'https://www.globalbest-of-breed.org/user-centric/magnetic/cross-media/architectures') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 73, 'http://www.legacyreintermediate.net/best-of-breed') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426401+00:00:00', '2022-06-22 17:30:32.575379+00:00:00', 'Chicken', '2022-06-22 17:30:32.426401+00:00:00', 'Brain unit borrow resistance.', 'ingestion', 73, '8d061130-0ab8-40e9-8fc5-f891a5b4aa24', 4, 15, 'Introduce service framework walk.', DEFAULT, 'Success', 'Weihenstephaner Hefeweissbier', 'Funding Circle') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426409+00:00:00', '2022-06-22 17:30:32.575883+00:00:00', 'Goose', '2022-06-22 17:30:32.426409+00:00:00', 'Bring appeal happen appear.', 'ingestion', 73, '39ec91d1-6f3a-443b-bb78-4e880d9c9293', 4, 15, 'Interpret simon enable replace.', DEFAULT, 'Success', 'Racer 5 India Pale Ale, Bear Republic Bre', 'HealthMap') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426416+00:00:00', '2022-06-22 17:30:32.576702+00:00:00', 'Goose', '2022-06-22 17:30:32.426416+00:00:00', 'District gain shake boat.', 'ingestion', 73, '32c691de-4dbe-4a44-8259-dc704230adda', 4, 15, 'Demonstrate end address feel.', DEFAULT, 'Success', 'Bourbon County Stout', 'Ebba Swaniawski') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426425+00:00:00', '2022-06-22 17:30:32.577397+00:00:00', 'Chicken', '2022-06-22 17:30:32.426425+00:00:00', 'Occur test support peace.', 'ingestion', 73, '5e3f8a8c-f13f-4336-a524-e7d00c60d5bc', 4, 15, 'Lifespan measure half charity.', DEFAULT, 'Success', 'Bourbon County Stout', 'Frederique Feeney') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426433+00:00:00', '2022-06-22 17:30:32.578134+00:00:00', 'mammals', 27712155782656389, 'test.edu/Lordowe/data/shipapply494.mdb', 15, 'A', '2022-02-22 17:30:32.426433+00:00:00', 4, 'Standard', '312e7d2a-b8b0-4dde-9597-b3db4182e1c6') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42644+00:00:00', '2022-06-22 17:30:32.579036+00:00:00', 'sha1', '2022-06-22 17:30:32.42644+00:00:00', '124a01b6e6dc4a9cb3491f4770ba555e', 74) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426447+00:00:00', '2022-06-22 17:30:32.579551+00:00:00', 'sha1', '2022-06-22 17:30:32.426447+00:00:00', '2a81f39da33b46359a078ce38a627f92', 74) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426455+00:00:00', '2022-06-22 17:30:32.579953+00:00:00', 'sha1', '2022-06-22 17:30:32.426455+00:00:00', '54f4133339684788bcca9cfa902bf54d', 74) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426464+00:00:00', '2022-06-22 17:30:32.580411+00:00:00', 'sha1', '2022-06-22 17:30:32.426464+00:00:00', '27f374e179c0436ca185bc337f5a33cc', 74) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 74, 'http://www.customercontent.biz/experiences') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 74, 'http://www.dynamicnext-generation.biz/applications/redefine/mission-critical/generate') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 74, 'https://www.principalturn-key.io/web-enabled/expedite/roi') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 74, 'https://www.nationalvisionary.io/robust') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426435+00:00:00', '2022-06-22 17:30:32.582681+00:00:00', 'Goose', '2022-06-22 17:30:32.426435+00:00:00', 'Club affect life drink.', 'ingestion', 74, 'ba751f0e-6737-4556-a646-f90cc46ba25e', 4, 15, 'Wait reduce spend recall.', DEFAULT, 'Success', 'Duvel', 'Jamil Parisian') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426443+00:00:00', '2022-06-22 17:30:32.583161+00:00:00', 'Turkey', '2022-06-22 17:30:32.426443+00:00:00', 'Environment wife theatre weekend.', 'ingestion', 74, '9dabc3cc-6389-4c77-86a6-c8629c92d768', 4, 15, 'Prefer payment choice car.', DEFAULT, 'Success', 'HopSlam Ale', 'Lina McDermott') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426451+00:00:00', '2022-06-22 17:30:32.583722+00:00:00', 'Sheep', '2022-06-22 17:30:32.426451+00:00:00', 'Cost mind artist music.', 'ingestion', 74, '00da2324-84b4-46da-b81f-836eb1d9a453', 4, 15, 'Cook minister publication excuse.', DEFAULT, 'Success', 'La Fin Du Monde', 'Jerrod Jast') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426459+00:00:00', '2022-06-22 17:30:32.584248+00:00:00', 'Sheep', '2022-06-22 17:30:32.426459+00:00:00', 'Cover development use clean.', 'ingestion', 74, 'f69655f4-d27e-4504-b8e3-98538f9441a5', 4, 15, 'Point change stand door.', DEFAULT, 'Success', 'Arrogant Bastard Ale', 'Electa Reynolds') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426466+00:00:00', '2022-06-22 17:30:32.584731+00:00:00', 'birds', 6981990879857823644, 'test.edu/Lordowe/data/sizeenjoy39.csv', 15, 'A', '2022-02-22 17:30:32.426466+00:00:00', 4, 'Standard', 'febcdb2a-44c3-4969-8330-1179d3c539f6') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426475+00:00:00', '2022-06-22 17:30:32.585228+00:00:00', 'sha1', '2022-06-22 17:30:32.426475+00:00:00', '86036b296c144de2b5260ae2119e614f', 75) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426483+00:00:00', '2022-06-22 17:30:32.585643+00:00:00', 'sha1', '2022-06-22 17:30:32.426483+00:00:00', '81fea34ce2524db48d364cfe3de55cb2', 75) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42649+00:00:00', '2022-06-22 17:30:32.586108+00:00:00', 'sha1', '2022-06-22 17:30:32.42649+00:00:00', 'a52abdc698864a808eaa31112d27406b', 75) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426499+00:00:00', '2022-06-22 17:30:32.586519+00:00:00', 'sha1', '2022-06-22 17:30:32.426499+00:00:00', 'd0971946fe604f7698647b3c5942b119', 75) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 75, 'https://www.centralmatrix.info/e-tailers/revolutionize/back-end/supply-chains') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 75, 'http://www.dynamicimplement.com/relationships/utilize') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 75, 'http://www.legacyplatforms.info/redefine/drive/channels/collaborative') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 75, 'http://www.humanstrategic.name/holistic/open-source/interfaces') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42647+00:00:00', '2022-06-22 17:30:32.588744+00:00:00', 'Llama', '2022-06-22 17:30:32.42647+00:00:00', 'Index assume serve publish.', 'ingestion', 75, 'f787e18a-b07a-41a6-8744-f73c0754add3', 4, 15, 'Should floor seem remove.', DEFAULT, 'Success', 'Yeti Imperial Stout', 'Marilie Moen') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426478+00:00:00', '2022-06-22 17:30:32.589222+00:00:00', 'Turkey', '2022-06-22 17:30:32.426478+00:00:00', 'Hold do sustain argue.', 'ingestion', 75, '1ef7550c-e94d-4a7a-9b9a-caa2fd39c02c', 4, 15, 'Make presence worry mind.', DEFAULT, 'Success', 'Péché Mortel', 'Deshaun Windler') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426486+00:00:00', '2022-06-22 17:30:32.589696+00:00:00', 'Duck', '2022-06-22 17:30:32.426486+00:00:00', 'Claim position agent stick.', 'ingestion', 75, 'e494dc56-c3f5-45b8-94d2-21d14472f6dd', 4, 15, 'Campaign beat support message.', DEFAULT, 'Success', 'La Fin Du Monde', 'Impaq International') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426494+00:00:00', '2022-06-22 17:30:32.590162+00:00:00', 'Pig', '2022-06-22 17:30:32.426494+00:00:00', 'Doctor audience lead station.', 'ingestion', 75, 'f42ac761-f467-4048-8f4e-fa35bdb3ccb2', 4, 15, 'Responsibility waste do supply.', DEFAULT, 'Success', 'Chimay Grande Réserve', 'Carmine Hane') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426502+00:00:00', '2022-06-22 17:30:32.590631+00:00:00', 'invertebrates', 2918508615503584220, 'test.edu/Lordowe/data/couplerely602.gz', 15, 'A', '2022-02-22 17:30:32.426502+00:00:00', 4, 'Standard', '550f5b98-765a-4cd1-b18c-293236d4c19e') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426509+00:00:00', '2022-06-22 17:30:32.59113+00:00:00', 'sha1', '2022-06-22 17:30:32.426509+00:00:00', '52c5b8e6411349838ae6601e07a6f56e', 76) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426517+00:00:00', '2022-06-22 17:30:32.591632+00:00:00', 'sha1', '2022-06-22 17:30:32.426517+00:00:00', '219af75fada84260b11f1c8b6f1d5157', 76) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426525+00:00:00', '2022-06-22 17:30:32.59207+00:00:00', 'sha1', '2022-06-22 17:30:32.426525+00:00:00', '6a6b9b2c7fb443ee87051feb7a65a0c7', 76) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426534+00:00:00', '2022-06-22 17:30:32.592493+00:00:00', 'sha1', '2022-06-22 17:30:32.426534+00:00:00', '4acc3e6a84654e35bc89ba281b726925', 76) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 76, 'http://www.internationalglobal.io/web-enabled/networks/ubiquitous/seamless') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 76, 'https://www.principalone-to-one.net/experiences/extend/metrics/web-enabled') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 76, 'http://www.nationalembrace.name/enable/b2c/envisioneer/technologies') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 76, 'https://www.futureaction-items.biz/utilize/embrace/magnetic') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426505+00:00:00', '2022-06-22 17:30:32.595703+00:00:00', 'Duck', '2022-06-22 17:30:32.426505+00:00:00', 'Summer port bath ''re.', 'ingestion', 76, '9fa8b5e5-7a69-4a42-abfc-24cd46905374', 4, 15, 'Show focus burst justify.', DEFAULT, 'Success', 'Sierra Nevada Celebration Ale', 'Spokeo') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426512+00:00:00', '2022-06-22 17:30:32.596297+00:00:00', 'Cow', '2022-06-22 17:30:32.426512+00:00:00', 'Agriculture exploit content notice.', 'ingestion', 76, '4fbcaf60-54c8-4011-ba51-2d44c83f6f5a', 4, 15, 'Appear diet regard glass.', DEFAULT, 'Success', 'Maudite', 'Benjamin Ebert') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426521+00:00:00', '2022-06-22 17:30:32.597143+00:00:00', 'Llama', '2022-06-22 17:30:32.426521+00:00:00', 'Arm sound write shoot.', 'ingestion', 76, '1dcb7204-a3c3-4b46-8881-7fec71693e0c', 4, 15, 'Waste month sugar hope.', DEFAULT, 'Success', 'Oaked Arrogant Bastard Ale', 'Ivy Beatty') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426529+00:00:00', '2022-06-22 17:30:32.597703+00:00:00', 'Pig', '2022-06-22 17:30:32.426529+00:00:00', 'Bag run survive organise.', 'ingestion', 76, 'b2f8299f-3571-4e7c-8571-51023f30c6ac', 4, 15, 'Interpretation intelligence mary affect.', DEFAULT, 'Success', '90 Minute IPA', 'Marinexplore, Inc.') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426537+00:00:00', '2022-06-22 17:30:32.598229+00:00:00', 'mammals', 4894810764218750861, 'test.edu/Lordowe/data/footreflect119.ini', 15, 'A', '2022-02-22 17:30:32.426537+00:00:00', 4, 'Standard', '97f9dfeb-c8b8-4a3e-a332-aa0e5dddf2a2') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426544+00:00:00', '2022-06-22 17:30:32.598696+00:00:00', 'sha1', '2022-06-22 17:30:32.426544+00:00:00', 'fb322a1e26ed4c0486b7d15c7f213b22', 77) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426552+00:00:00', '2022-06-22 17:30:32.599159+00:00:00', 'sha1', '2022-06-22 17:30:32.426552+00:00:00', '3ed2c532a0404dd7925c6490dc069a7c', 77) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426559+00:00:00', '2022-06-22 17:30:32.599617+00:00:00', 'sha1', '2022-06-22 17:30:32.426559+00:00:00', '75ce73f7944b4bdcbaf09ca821d28947', 77) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426567+00:00:00', '2022-06-22 17:30:32.600038+00:00:00', 'sha1', '2022-06-22 17:30:32.426567+00:00:00', 'c57c8e2156554ee9bf239e8117611a21', 77) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 77, 'https://www.dynamiccompelling.info/plug-and-play/enterprise/brand') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 77, 'http://www.productmonetize.info/envisioneer/e-markets') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 77, 'https://www.regionalarchitect.biz/extensible/virtual/e-business') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 77, 'https://www.principalcutting-edge.io/b2b/niches') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42654+00:00:00', '2022-06-22 17:30:32.602296+00:00:00', 'Horse', '2022-06-22 17:30:32.42654+00:00:00', 'Appeal bother pretend care.', 'ingestion', 77, 'c44ac690-6037-4e78-b4eb-821318a74b34', 4, 15, 'Promise expert pair efficiency.', DEFAULT, 'Success', 'Brooklyn Black', 'Standard and Poor''s') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426547+00:00:00', '2022-06-22 17:30:32.602775+00:00:00', 'Goat', '2022-06-22 17:30:32.426547+00:00:00', 'Notion communication advice forest.', 'ingestion', 77, '3f5a7ec3-4854-44ab-92a4-534ac5d6b0b9', 4, 15, 'Rely involve couple supply.', DEFAULT, 'Success', 'Bourbon County Stout', 'Thinknum') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426555+00:00:00', '2022-06-22 17:30:32.603304+00:00:00', 'Turkey', '2022-06-22 17:30:32.426555+00:00:00', 'Level cry respond may.', 'ingestion', 77, 'b645b986-844c-4735-bd12-d7ffb72a48d5', 4, 15, 'South independence result passage.', DEFAULT, 'Success', 'Alpha King Pale Ale', 'IVES Group Inc') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426562+00:00:00', '2022-06-22 17:30:32.60384+00:00:00', 'Cow', '2022-06-22 17:30:32.426562+00:00:00', 'Self home box range.', 'ingestion', 77, '54a82a9c-b20a-4847-9d22-20d1b77530f9', 4, 15, 'Contribute operate aim weather.', DEFAULT, 'Success', 'Racer 5 India Pale Ale, Bear Republic Bre', 'Peterson''s') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.42657+00:00:00', '2022-06-22 17:30:32.60438+00:00:00', 'reptiles', 7163976385838931621, 'test.edu/Lordowe/data/villageget48.swift', 15, 'A', '2022-02-22 17:30:32.42657+00:00:00', 4, 'Standard', '4f8c1247-5cb7-44ad-9fee-a3153cb7ff84') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426577+00:00:00', '2022-06-22 17:30:32.604833+00:00:00', 'sha1', '2022-06-22 17:30:32.426577+00:00:00', '1436cc50947849ef8102bd5e4d9b1c8a', 78) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426584+00:00:00', '2022-06-22 17:30:32.605295+00:00:00', 'sha1', '2022-06-22 17:30:32.426584+00:00:00', 'fdd7f780f7fb4b15b52282df50584fb8', 78) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426593+00:00:00', '2022-06-22 17:30:32.605779+00:00:00', 'sha1', '2022-06-22 17:30:32.426593+00:00:00', '19a83d4df9974574881bee0384c2daa1', 78) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.4266+00:00:00', '2022-06-22 17:30:32.606222+00:00:00', 'sha1', '2022-06-22 17:30:32.4266+00:00:00', 'fc1d89e6aa3b46f7b4261ebb127c8b5b', 78) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 78, 'http://www.futuredeliver.io/initiatives/leverage') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 78, 'https://www.directexploit.com/leverage/architectures/revolutionize') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 78, 'https://www.centralleading-edge.io/killer/exploit') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 78, 'http://www.forwardplug-and-play.io/open-source/strategize') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426572+00:00:00', '2022-06-22 17:30:32.608581+00:00:00', 'Llama', '2022-06-22 17:30:32.426572+00:00:00', 'Cross demonstrate meat settle.', 'ingestion', 78, '849c3bcf-4600-4fbc-8596-7aa308480932', 4, 15, 'Vary authority pay implement.', DEFAULT, 'Success', 'Westmalle Trappist Tripel', 'HealthMap') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42658+00:00:00', '2022-06-22 17:30:32.60906+00:00:00', 'Sheep', '2022-06-22 17:30:32.42658+00:00:00', 'Predict friend play space.', 'ingestion', 78, 'ed3e02de-7e86-41d9-b2fe-8d56de1682d8', 4, 15, 'Appeal contact make bush.', DEFAULT, 'Success', 'Stone Imperial Russian Stout', 'Marion Runolfsdottir') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426587+00:00:00', '2022-06-22 17:30:32.609556+00:00:00', 'Llama', '2022-06-22 17:30:32.426587+00:00:00', 'Council demonstrate play purchase.', 'ingestion', 78, 'e553ac7b-8bb7-4f64-b4df-537c3a8988b6', 4, 15, 'Transfer thank dare serve.', DEFAULT, 'Success', 'Stone Imperial Russian Stout', 'Eleanora Watsica') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426596+00:00:00', '2022-06-22 17:30:32.610048+00:00:00', 'Llama', '2022-06-22 17:30:32.426596+00:00:00', 'Bill realize train clear.', 'ingestion', 78, 'a397562a-a8b6-4014-a2eb-213809a9eec6', 4, 15, 'Fire article art transport.', DEFAULT, 'Success', 'Shakespeare Oatmeal', 'OTC Markets') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426603+00:00:00', '2022-06-22 17:30:32.610542+00:00:00', 'fish', 8096820539848443685, 'test.edu/Lordowe/data/relationshiprecall407.wmv', 15, 'A', '2022-02-22 17:30:32.426603+00:00:00', 4, 'Standard', '11343981-53f6-47e3-8f74-50a5726cf5c3') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42661+00:00:00', '2022-06-22 17:30:32.611252+00:00:00', 'sha1', '2022-06-22 17:30:32.42661+00:00:00', '6bda38fa5ad24deb994b9d3e5609d7fa', 79) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426617+00:00:00', '2022-06-22 17:30:32.611819+00:00:00', 'sha1', '2022-06-22 17:30:32.426617+00:00:00', 'e8b86419701448188ee0760ef5851370', 79) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426625+00:00:00', '2022-06-22 17:30:32.612519+00:00:00', 'sha1', '2022-06-22 17:30:32.426625+00:00:00', 'eb94ef4677cb4d778ebaf64941e38240', 79) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426633+00:00:00', '2022-06-22 17:30:32.61297+00:00:00', 'sha1', '2022-06-22 17:30:32.426633+00:00:00', 'e255a5886f5448edbe49f972c43e6551', 79) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 79, 'https://www.leadinteractive.org/b2b/streamline') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 79, 'https://www.productusers.io/e-services/systems') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 79, 'https://www.seniordynamic.name/convergence/revolutionary/solutions/front-end') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 79, 'https://www.internationalexpedite.net/vertical/architect/dot-com') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426606+00:00:00', '2022-06-22 17:30:32.615202+00:00:00', 'Goose', '2022-06-22 17:30:32.426606+00:00:00', 'Earn drink status slip.', 'ingestion', 79, 'f83c5fc7-63d6-461d-902a-4782af953dca', 4, 15, 'Protection stretch emergency fruit.', DEFAULT, 'Success', 'Sublimely Self-Righteous Ale', 'Alanna Swaniawski') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426613+00:00:00', '2022-06-22 17:30:32.615714+00:00:00', 'Sheep', '2022-06-22 17:30:32.426613+00:00:00', 'River operate build fit.', 'ingestion', 79, '31f289ae-454b-429c-bbb4-5045c515de67', 4, 15, 'Learn peter link sort.', DEFAULT, 'Success', 'Founders Kentucky Breakfast', 'NuCivic') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426621+00:00:00', '2022-06-22 17:30:32.616261+00:00:00', 'Horse', '2022-06-22 17:30:32.426621+00:00:00', 'Victim fill oil rest.', 'ingestion', 79, '20ab685d-c7bc-4fdb-9093-7b0461450dd6', 4, 15, 'Implement belong door henry.', DEFAULT, 'Success', 'Samuel Smith’s Imperial IPA', 'Russell Investments') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426628+00:00:00', '2022-06-22 17:30:32.616759+00:00:00', 'Donkey', '2022-06-22 17:30:32.426628+00:00:00', 'Countryside vote authority grow.', 'ingestion', 79, '6e86460e-45d0-40b4-8111-ba1b6a304d14', 4, 15, 'Range tape drop do.', DEFAULT, 'Success', 'Founders Breakfast Stout', 'Anjali Harber') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426636+00:00:00', '2022-06-22 17:30:32.617198+00:00:00', 'reptiles', 4669982168075291977, 'test.edu/Lordowe/data/tracktelephone225.crx', 15, 'A', '2022-02-22 17:30:32.426636+00:00:00', 4, 'Standard', 'edf7d721-00cc-42be-8b58-62e5d3750552') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426643+00:00:00', '2022-06-22 17:30:32.617744+00:00:00', 'sha1', '2022-06-22 17:30:32.426643+00:00:00', '9620e2e2209441ee86ad06c3265550c3', 80) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426651+00:00:00', '2022-06-22 17:30:32.618163+00:00:00', 'sha1', '2022-06-22 17:30:32.426651+00:00:00', '7bae7c17895d44219e51df8fcfb78933', 80) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.42666+00:00:00', '2022-06-22 17:30:32.618595+00:00:00', 'sha1', '2022-06-22 17:30:32.42666+00:00:00', '029a0f81d49a454e9c81cc5358869875', 80) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426668+00:00:00', '2022-06-22 17:30:32.619028+00:00:00', 'sha1', '2022-06-22 17:30:32.426668+00:00:00', '9b3941fa2f43445bae8c76783fe7c006', 80) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 80, 'https://www.dynamicharness.info/iterate/partnerships/dynamic') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 80, 'http://www.forwarde-business.com/frictionless') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 80, 'https://www.regionalefficient.org/wireless/harness') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 80, 'http://www.dynamicsynergies.net/brand/dynamic') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426639+00:00:00', '2022-06-22 17:30:32.621184+00:00:00', 'Donkey', '2022-06-22 17:30:32.426639+00:00:00', 'Ask search limit eat.', 'ingestion', 80, '89d322c9-724b-46e2-aaf6-aeaf967fc0ff', 4, 15, 'Divide waste invest deliver.', DEFAULT, 'Success', 'Chimay Grande Réserve', 'Lorine Daugherty') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426646+00:00:00', '2022-06-22 17:30:32.621649+00:00:00', 'Pig', '2022-06-22 17:30:32.426646+00:00:00', 'Produce area eye forest.', 'ingestion', 80, 'db69b7b4-e939-48b9-b499-4d9c55a24e9b', 4, 15, 'Let text fund range.', DEFAULT, 'Success', 'St. Bernardus Abt 12', 'DataLogix') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426654+00:00:00', '2022-06-22 17:30:32.622144+00:00:00', 'Donkey', '2022-06-22 17:30:32.426654+00:00:00', 'Buy teach suit size.', 'ingestion', 80, 'b91cf832-04f7-460f-8259-72de195ddcdd', 4, 15, 'Night dance wish site.', DEFAULT, 'Success', 'Trappistes Rochefort 8', 'Emory Wilkinson') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426663+00:00:00', '2022-06-22 17:30:32.622604+00:00:00', 'Cow', '2022-06-22 17:30:32.426663+00:00:00', 'State upset plan defence.', 'ingestion', 80, 'ded1cdfb-be7e-402d-a530-507f83b07568', 4, 15, 'Commit clause frank die.', DEFAULT, 'Success', 'Two Hearted Ale', 'Antonette Block') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426671+00:00:00', '2022-06-22 17:30:32.623071+00:00:00', 'fish', 479014091589199037, 'test.edu/Lordowe/data/rangerecognise413.gz', 15, 'A', '2022-02-22 17:30:32.426671+00:00:00', 4, 'Standard', '65873f3b-8841-4f08-a44f-dec1235ad33b') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426677+00:00:00', '2022-06-22 17:30:32.623586+00:00:00', 'sha1', '2022-06-22 17:30:32.426677+00:00:00', '819b03638aa64552998f4ce513cb77f5', 81) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426685+00:00:00', '2022-06-22 17:30:32.62395+00:00:00', 'sha1', '2022-06-22 17:30:32.426685+00:00:00', '40c8f1741e974f0590e857fe5ec52b3e', 81) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426692+00:00:00', '2022-06-22 17:30:32.624397+00:00:00', 'sha1', '2022-06-22 17:30:32.426692+00:00:00', '982ecf7e7fa94c92861fc38e67fef523', 81) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.4267+00:00:00', '2022-06-22 17:30:32.624785+00:00:00', 'sha1', '2022-06-22 17:30:32.4267+00:00:00', '2979d7bc70dd4625a5f857da158362a6', 81) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 81, 'https://www.leadkiller.net/methodologies') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 81, 'http://www.corporatebenchmark.com/content') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 81, 'https://www.globaloptimize.name/morph/sexy/intuitive/roi') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 81, 'http://www.internationalroi.info/proactive') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426673+00:00:00', '2022-06-22 17:30:32.62711+00:00:00', 'Cow', '2022-06-22 17:30:32.426673+00:00:00', 'Sing reform count start.', 'ingestion', 81, '6586525e-bd86-4d84-b3ea-ea242d5bbf2b', 4, 15, 'Road allow mistake wait.', DEFAULT, 'Success', 'Westmalle Trappist Tripel', 'Housefax') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.42668+00:00:00', '2022-06-22 17:30:32.62795+00:00:00', 'Goat', '2022-06-22 17:30:32.42668+00:00:00', 'Contribute bath inform relax.', 'ingestion', 81, 'b273c07a-4915-43bd-9963-7f14a4cb092b', 4, 15, 'Context spend chief offence.', DEFAULT, 'Success', 'Hennepin', 'StreetCred Software, Inc') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426688+00:00:00', '2022-06-22 17:30:32.628534+00:00:00', 'Duck', '2022-06-22 17:30:32.426688+00:00:00', 'Species guess second conclusion.', 'ingestion', 81, 'e26b386d-fee1-4778-8e8e-acb69bfd6300', 4, 15, 'Ring purchase deliver convince.', DEFAULT, 'Success', 'Samuel Smith’s Imperial IPA', 'TrialX') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426696+00:00:00', '2022-06-22 17:30:32.629094+00:00:00', 'Cow', '2022-06-22 17:30:32.426696+00:00:00', 'Ignore generation increase close.', 'ingestion', 81, 'cd62df78-df47-43f8-b42e-a04dd8d11a30', 4, 15, 'Disappear focus monitor realize.', DEFAULT, 'Success', 'Yeti Imperial Stout', 'Emilio Ernser') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"generic_files\" (\"id\", \"created_at\", \"updated_at\", \"file_format\", \"size\", \"identifier\", \"intellectual_object_id\", \"state\", \"last_fixity_check\", \"institution_id\", \"storage_option\", \"uuid\") VALUES (DEFAULT, '2022-06-22 17:30:32.426703+00:00:00', '2022-06-22 17:30:32.629637+00:00:00', 'invertebrates', 3028955990541445742, 'test.edu/Lordowe/data/ministryreduce504.cab', 15, 'A', '2022-02-22 17:30:32.426703+00:00:00', 4, 'Standard', '036ed9c0-318f-4aef-b308-2f25ec84094b') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426711+00:00:00', '2022-06-22 17:30:32.630123+00:00:00', 'sha1', '2022-06-22 17:30:32.426711+00:00:00', 'cfd427e5f1ed4e898e8099413378f885', 82) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426718+00:00:00', '2022-06-22 17:30:32.630609+00:00:00', 'sha1', '2022-06-22 17:30:32.426718+00:00:00', 'ad96b5d30ec54b15956a0aa7ed81e4cc', 82) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426725+00:00:00', '2022-06-22 17:30:32.631081+00:00:00', 'sha1', '2022-06-22 17:30:32.426725+00:00:00', '052dfad9d5aa4f3dafe44fb18a6f4874', 82) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"checksums\" AS \"checksum\" (\"id\", \"created_at\", \"updated_at\", \"algorithm\", \"datetime\", \"digest\", \"generic_file_id\") VALUES (DEFAULT, '2022-06-22 17:30:32.426734+00:00:00', '2022-06-22 17:30:32.631508+00:00:00', 'sha1', '2022-06-22 17:30:32.426734+00:00:00', 'e422f8ca698f48df983ca28b2198766a', 82) ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 82, 'http://www.forwardstrategic.io/niches/cultivate') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 82, 'http://www.corporatereinvent.io/open-source/relationships') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 82, 'http://www.productrepurpose.name/deliverables/leverage/supply-chains/deploy') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" AS \"storage_record\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 82, 'https://www.customersynergize.net/relationships/technologies') ON CONFLICT DO NOTHING RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426705+00:00:00', '2022-06-22 17:30:32.633953+00:00:00', 'Horse', '2022-06-22 17:30:32.426705+00:00:00', 'Finance distinction failure assess.', 'ingestion', 82, '07f2ec25-cbe0-40fe-9cf6-a0bf6eebeca7', 4, 15, 'Challenge sound pain defend.', DEFAULT, 'Success', 'Schneider Aventinus', 'Marilou Howe') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426714+00:00:00', '2022-06-22 17:30:32.634443+00:00:00', 'Horse', '2022-06-22 17:30:32.426714+00:00:00', 'Suit partner outcome sleep.', 'ingestion', 82, '25e18e7a-8544-4d0a-920d-3b78ac6dda6b', 4, 15, 'Blame see reckon rail.', DEFAULT, 'Success', 'Two Hearted Ale', 'CityScan') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426721+00:00:00', '2022-06-22 17:30:32.635013+00:00:00', 'Horse', '2022-06-22 17:30:32.426721+00:00:00', 'Imagine institution link transfer.', 'ingestion', 82, 'da4ebc17-c8d6-499f-9326-1cfc74b76076', 4, 15, 'Owner grow benefit stuff.', DEFAULT, 'Success', 'Pliny The Elder', 'HealthMap') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:32.426729+00:00:00', '2022-06-22 17:30:32.635513+00:00:00', 'Donkey', '2022-06-22 17:30:32.426729+00:00:00', 'Beat lie service self.', 'ingestion', 82, 'fee968b4-c651-4d03-bf7c-72c8fdd7eced', 4, 15, 'Compete weather software memory.', DEFAULT, 'Success', 'Schneider Aventinus', 'Cletus Murazik') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/files/create_batch/4","ip":"","latency":206.492258,"user-agent":"","time":"2022-06-22T13:30:32-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\" FROM \"generic_files\" AS \"generic_file\" WHERE ((intellectual_object_id = 15))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 63))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 63))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 63))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 64))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 64))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 64))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 65))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 65))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 65))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 66))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 66))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 66))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 67))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 67))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 67))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 68))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 68))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 68))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 69))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 69))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 69))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 70))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 70))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 70))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 71))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 71))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 71))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 72))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 72))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 72))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 73))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 73))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 73))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 74))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 74))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 74))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 75))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 75))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 75))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 76))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 76))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 76))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 77))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 77))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 77))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 78))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 78))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 78))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 79))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 79))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 79))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 80))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 80))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 80))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 81))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 81))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 81))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((generic_file_id = 82))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE ((generic_file_id = 82))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = 82))"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:32-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: select update_counts();"}
{"level":"warn","time":"2022-06-22T13:30:33-04:00","message":"Forcing storage option back to 'Glacier-Deep-OR' on GenericFile 0 ()"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_view\".\"id\", \"institution_view\".\"name\", \"institution_view\".\"identifier\", \"institution_view\".\"state\", \"institution_view\".\"type\", \"institution_view\".\"deactivated_at\", \"institution_view\".\"otp_enabled\", \"institution_view\".\"enable_spot_restore\", \"institution_view\".\"receiving_bucket\", \"institution_view\".\"restore_bucket\", \"institution_view\".\"created_at\", \"institution_view\".\"updated_at\", \"institution_view\".\"parent_id\", \"institution_view\".\"parent_name\", \"institution_view\".\"parent_identifier\", \"institution_view\".\"parent_state\", \"institution_view\".\"parent_deactivated_at\" FROM \"institutions_view\" AS \"institution_view\" WHERE ((id = 1))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/institutions/show/1","ip":"","latency":3.780544,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_view\".\"id\", \"institution_view\".\"name\", \"institution_view\".\"identifier\", \"institution_view\".\"state\", \"institution_view\".\"type\", \"institution_view\".\"deactivated_at\", \"institution_view\".\"otp_enabled\", \"institution_view\".\"enable_spot_restore\", \"institution_view\".\"receiving_bucket\", \"institution_view\".\"restore_bucket\", \"institution_view\".\"created_at\", \"institution_view\".\"updated_at\", \"institution_view\".\"parent_id\", \"institution_view\".\"parent_name\", \"institution_view\".\"parent_identifier\", \"institution_view\".\"parent_state\", \"institution_view\".\"parent_deactivated_at\" FROM \"institutions_view\" AS \"institution_view\" WHERE ((id = 2))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/institutions/show/2","ip":"","latency":2.539802,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_view\".\"id\", \"institution_view\".\"name\", \"institution_view\".\"identifier\", \"institution_view\".\"state\", \"institution_view\".\"type\", \"institution_view\".\"deactivated_at\", \"institution_view\".\"otp_enabled\", \"institution_view\".\"enable_spot_restore\", \"institution_view\".\"receiving_bucket\", \"institution_view\".\"restore_bucket\", \"institution_view\".\"created_at\", \"institution_view\".\"updated_at\", \"institution_view\".\"parent_id\", \"institution_view\".\"parent_name\", \"institution_view\".\"parent_identifier\", \"institution_view\".\"parent_state\", \"institution_view\".\"parent_deactivated_at\" FROM \"institutions_view\" AS \"institution_view\" WHERE ((id = 3))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/institutions/show/3","ip":"","latency":1.600579,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_view\".\"id\", \"institution_view\".\"name\", \"institution_view\".\"identifier\", \"institution_view\".\"state\", \"institution_view\".\"type\", \"institution_view\".\"deactivated_at\", \"institution_view\".\"otp_enabled\", \"institution_view\".\"enable_spot_restore\", \"institution_view\".\"receiving_bucket\", \"institution_view\".\"restore_bucket\", \"institution_view\".\"created_at\", \"institution_view\".\"updated_at\", \"institution_view\".\"parent_id\", \"institution_view\".\"parent_name\", \"institution_view\".\"parent_identifier\", \"institution_view\".\"parent_state\", \"institution_view\".\"parent_deactivated_at\" FROM \"institutions_view\" AS \"institution_view\" WHERE ((id = 4))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/institutions/show/4","ip":"","latency":1.652966,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_view\".\"id\", \"institution_view\".\"name\", \"institution_view\".\"identifier\", \"institution_view\".\"state\", \"institution_view\".\"type\", \"institution_view\".\"deactivated_at\", \"institution_view\".\"otp_enabled\", \"institution_view\".\"enable_spot_restore\", \"institution_view\".\"receiving_bucket\", \"institution_view\".\"restore_bucket\", \"institution_view\".\"created_at\", \"institution_view\".\"updated_at\", \"institution_view\".\"parent_id\", \"institution_view\".\"parent_name\", \"institution_view\".\"parent_identifier\", \"institution_view\".\"parent_state\", \"institution_view\".\"parent_deactivated_at\" FROM \"institutions_view\" AS \"institution_view\" WHERE ((id = 5))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/institutions/show/5","ip":"","latency":1.519516,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/1","ip":"","latency":0.975602,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/1","ip":"","latency":0.84757,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/1","ip":"","latency":0.955785,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 7))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/1","ip":"","latency":0.878967,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/2"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/2","ip":"","latency":0.897636,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/2"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/2","ip":"","latency":0.875798,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/2"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/2","ip":"","latency":0.962933,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 7))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/2"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/2","ip":"","latency":1.273675,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/3"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/3","ip":"","latency":1.393839,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/3"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/3","ip":"","latency":1.171475,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/3"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/3","ip":"","latency":0.987462,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 7))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/3"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/3","ip":"","latency":0.984654,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/4, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/4"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/4","ip":"","latency":0.942465,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/4, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/4"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/4","ip":"","latency":0.92825,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/4, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/4"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/4","ip":"","latency":0.903458,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 7))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/4, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/4"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/4","ip":"","latency":0.878344,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/5, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/5"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/5","ip":"","latency":0.921718,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/5, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/5"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/5","ip":"","latency":0.894224,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/5, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/5"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/5","ip":"","latency":0.940831,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 7))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions/show/:id, Request Path: /admin-api/v3/institutions/show/5, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions/show/5"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions/show/5","ip":"","latency":0.954822,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_view\".\"id\", \"institution_view\".\"name\", \"institution_view\".\"identifier\", \"institution_view\".\"state\", \"institution_view\".\"type\", \"institution_view\".\"deactivated_at\", \"institution_view\".\"otp_enabled\", \"institution_view\".\"enable_spot_restore\", \"institution_view\".\"receiving_bucket\", \"institution_view\".\"restore_bucket\", \"institution_view\".\"created_at\", \"institution_view\".\"updated_at\", \"institution_view\".\"parent_id\", \"institution_view\".\"parent_name\", \"institution_view\".\"parent_identifier\", \"institution_view\".\"parent_state\", \"institution_view\".\"parent_deactivated_at\" FROM \"institutions_view\" AS \"institution_view\" ORDER BY \"name\" asc LIMIT 2 OFFSET 2"}
{"level":"info","time":"2022-06-22T13:30:33-04:00","message":"TypeName (1): InstitutionView"}
{"level":"info","time":"2022-06-22T13:30:33-04:00","message":"Cannot query count view for type InstitutionView: type is not supported for view count"}
{"level":"info","time":"2022-06-22T13:30:33-04:00","message":"API: Using standard count query for ''"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT count(*) FROM \"institutions_view\" AS \"institution_view\""}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/institutions?page=2&per_page=2","ip":"","latency":2.206037,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_view\".\"id\", \"institution_view\".\"name\", \"institution_view\".\"identifier\", \"institution_view\".\"state\", \"institution_view\".\"type\", \"institution_view\".\"deactivated_at\", \"institution_view\".\"otp_enabled\", \"institution_view\".\"enable_spot_restore\", \"institution_view\".\"receiving_bucket\", \"institution_view\".\"restore_bucket\", \"institution_view\".\"created_at\", \"institution_view\".\"updated_at\", \"institution_view\".\"parent_id\", \"institution_view\".\"parent_name\", \"institution_view\".\"parent_identifier\", \"institution_view\".\"parent_state\", \"institution_view\".\"parent_deactivated_at\" FROM \"institutions_view\" AS \"institution_view\" WHERE ((name ILIKE '%Institution%')) ORDER BY \"name\" asc LIMIT 20"}
{"level":"info","time":"2022-06-22T13:30:33-04:00","message":"TypeName (1): InstitutionView"}
{"level":"info","time":"2022-06-22T13:30:33-04:00","message":"Cannot query count view for type InstitutionView: type is not supported for view count"}
{"level":"info","time":"2022-06-22T13:30:33-04:00","message":"API: Using standard count query for '(name ILIKE ?)'"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT count(*) FROM \"institutions_view\" AS \"institution_view\" WHERE ((name ILIKE '%Institution%'))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/institutions?name__contains=Institution","ip":"","latency":3.602328,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions, Request Path: /admin-api/v3/institutions, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions","ip":"","latency":1.006237,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions, Request Path: /admin-api/v3/institutions, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions","ip":"","latency":0.927595,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions, Request Path: /admin-api/v3/institutions, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions","ip":"","latency":0.880066,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 7))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.InstitutionIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/institutions, Request Path: /admin-api/v3/institutions, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/institutions"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/institutions","ip":"","latency":0.904893,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 11)"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/11"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 11) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (11)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (11)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (11))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((institution_id = 3) AND (role = 'institutional_admin') AND (\"user\".\"deactivated_at\" is null)) LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:33.324445+00:00:00', '2022-06-22 17:30:33.324463+00:00:00', 'Sheep', '2022-06-22 17:30:33.324445+00:00:00', 'Contact sign equipment know.', 'ingestion', 11, '99df9b1a-eb28-4cbe-b31a-4b7342d8eea3', 3, 4, 'Economy reach sleep invest.', DEFAULT, 'Carry chest burst morning check.', 'Péché Mortel', 'Practice Fusion') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: INSERT INTO \"work_items\" (\"id\", \"created_at\", \"updated_at\", \"name\", \"etag\", \"institution_id\", \"intellectual_object_id\", \"generic_file_id\", \"bucket\", \"user\", \"note\", \"action\", \"stage\", \"status\", \"outcome\", \"bag_date\", \"date_processed\", \"retry\", \"node\", \"pid\", \"needs_admin_review\", \"queued_at\", \"size\", \"stage_started_at\", \"aptrust_approver\", \"inst_approver\") VALUES (DEFAULT, '2022-06-22 17:30:33.325846+00:00:00', '2022-06-22 17:30:33.325857+00:00:00', 'chocolate.tar', '4e7d0f67b40246f5ba94e8ac911cc225', 4, 4, 11, 'blah.receiving.blah', 'admin@inst2.edu', 'This item was created by the factory', 'Delete', 'Requested', 'Started', 'Outcome? WTF?', '2022-02-22 17:30:33.325846+00:00:00', '2022-06-22 17:30:33.325846+00:00:00', TRUE, DEFAULT, DEFAULT, FALSE, '2022-06-22 17:30:33.325846+00:00:00', 3012742690109076955, DEFAULT, DEFAULT, 'admin@inst2.edu') RETURNING \"id\", \"node\", \"pid\", \"stage_started_at\", \"aptrust_approver\""}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: INSERT INTO \"deletion_requests\" (\"id\", \"institution_id\", \"requested_by_id\", \"requested_at\", \"encrypted_confirmation_token\", \"confirmed_by_id\", \"confirmed_at\", \"cancelled_by_id\", \"cancelled_at\", \"work_item_id\") VALUES (DEFAULT, 3, 5, '2022-06-22 17:30:33.327516+00:00:00', '$2a$10$ciTMRt7BjOna/OruFcItZ.8VsiSFOi0e72whpxSsnUchx/vXO/3fG', 5, '2022-06-22 17:30:33.327516+00:00:00', DEFAULT, DEFAULT, 33) RETURNING \"id\", \"cancelled_by_id\", \"cancelled_at\""}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: insert into deletion_requests_generic_files (deletion_request_id, generic_file_id) values (4, 11) on conflict do nothing"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"POST","path":"/admin-api/v3/prepare_file_delete/11","ip":"","latency":150.438755,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst1.edu'))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareFileDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_file_delete/:id, Request Path: /admin-api/v3/prepare_file_delete/16, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/16"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_file_delete/16","ip":"","latency":68.384022,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst1.edu'))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareFileDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_file_delete/:id, Request Path: /admin-api/v3/prepare_file_delete/16, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/16"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_file_delete/16","ip":"","latency":68.397277,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst2.edu'))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareFileDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_file_delete/:id, Request Path: /admin-api/v3/prepare_file_delete/16, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/16"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_file_delete/16","ip":"","latency":68.357993,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst2.edu'))"}
{"level":"error","time":"2022-06-22T13:30:33-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareFileDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_file_delete/:id, Request Path: /admin-api/v3/prepare_file_delete/16, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/16"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_file_delete/16","ip":"","latency":68.391956,"user-agent":"","time":"2022-06-22T13:30:33-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:33-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: select update_counts();"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 2)"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/2"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 2))"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((institution_id = 2) AND (role = 'institutional_admin') AND (\"user\".\"deactivated_at\" is null)) LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:34.288239+00:00:00', '2022-06-22 17:30:34.288255+00:00:00', 'Goat', '2022-06-22 17:30:34.288239+00:00:00', 'Science be consult return.', 'ingestion', DEFAULT, '3bfe2ff0-6a0a-4be9-b60e-ecb61f053106', 2, 2, 'Lady selection proposal northern.', DEFAULT, 'Mistake fall front proportion recall.', 'Maharaj', 'Erik Lemke') RETURNING \"id\", \"generic_file_id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: INSERT INTO \"work_items\" (\"id\", \"created_at\", \"updated_at\", \"name\", \"etag\", \"institution_id\", \"intellectual_object_id\", \"generic_file_id\", \"bucket\", \"user\", \"note\", \"action\", \"stage\", \"status\", \"outcome\", \"bag_date\", \"date_processed\", \"retry\", \"node\", \"pid\", \"needs_admin_review\", \"queued_at\", \"size\", \"stage_started_at\", \"aptrust_approver\", \"inst_approver\") VALUES (DEFAULT, '2022-06-22 17:30:34.28961+00:00:00', '2022-06-22 17:30:34.289627+00:00:00', 'pdfs.tar', '376a3bd2615341a6912fb4a28274638f', 4, 2, DEFAULT, 'blah.receiving.blah', 'admin@inst1.edu', 'This item was created by the factory', 'Delete', 'Requested', 'Started', 'Outcome? WTF?', '2022-02-22 17:30:34.28961+00:00:00', '2022-06-22 17:30:34.28961+00:00:00', TRUE, DEFAULT, DEFAULT, FALSE, '2022-06-22 17:30:34.28961+00:00:00', 7966429891757283687, DEFAULT, DEFAULT, 'admin@inst1.edu') RETURNING \"id\", \"generic_file_id\", \"node\", \"pid\", \"stage_started_at\", \"aptrust_approver\""}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: INSERT INTO \"deletion_requests\" (\"id\", \"institution_id\", \"requested_by_id\", \"requested_at\", \"encrypted_confirmation_token\", \"confirmed_by_id\", \"confirmed_at\", \"cancelled_by_id\", \"cancelled_at\", \"work_item_id\") VALUES (DEFAULT, 2, 2, '2022-06-22 17:30:34.291057+00:00:00', '$2a$10$tOhQbeomtC1rVjFHd08IueuVssMzfVSwQzXCM/IweatmSIHkhSYjW', 2, '2022-06-22 17:30:34.291057+00:00:00', DEFAULT, DEFAULT, 33) RETURNING \"id\", \"cancelled_by_id\", \"cancelled_at\""}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: insert into deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id) values (4, 2) on conflict do nothing"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"POST","path":"/admin-api/v3/prepare_object_delete/2","ip":"","latency":151.238701,"user-agent":"","time":"2022-06-22T13:30:34-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst1.edu'))"}
{"level":"error","time":"2022-06-22T13:30:34-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareObjectDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_object_delete/:id, Request Path: /admin-api/v3/prepare_object_delete/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/3"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_object_delete/3","ip":"","latency":69.026793,"user-agent":"","time":"2022-06-22T13:30:34-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst1.edu'))"}
{"level":"error","time":"2022-06-22T13:30:34-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareObjectDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_object_delete/:id, Request Path: /admin-api/v3/prepare_object_delete/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/3"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_object_delete/3","ip":"","latency":68.328072,"user-agent":"","time":"2022-06-22T13:30:34-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst2.edu'))"}
{"level":"error","time":"2022-06-22T13:30:34-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareObjectDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_object_delete/:id, Request Path: /admin-api/v3/prepare_object_delete/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/3"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_object_delete/3","ip":"","latency":68.475784,"user-agent":"","time":"2022-06-22T13:30:34-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst2.edu'))"}
{"level":"error","time":"2022-06-22T13:30:34-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PrepareObjectDelete, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/prepare_object_delete/:id, Request Path: /admin-api/v3/prepare_object_delete/3, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/3"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/prepare_object_delete/3","ip":"","latency":68.270489,"user-agent":"","time":"2022-06-22T13:30:34-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:34-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: select update_counts();"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 11)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/11"}
{"level":"warn","status":405,"method":"POST","path":"/admin-api/v3/prepare_file_delete/11","ip":"","latency":70.725597,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Error #01: operation not supported\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 2)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/2"}
{"level":"warn","status":405,"method":"POST","path":"/admin-api/v3/prepare_object_delete/2","ip":"","latency":70.835191,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Error #01: operation not supported\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 11)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/11"}
{"level":"warn","status":405,"method":"POST","path":"/admin-api/v3/prepare_file_delete/11","ip":"","latency":68.89065,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Error #01: operation not supported\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 2)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/2"}
{"level":"warn","status":405,"method":"POST","path":"/admin-api/v3/prepare_object_delete/2","ip":"","latency":68.756922,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Error #01: operation not supported\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"generic_files\" AS \"generic_file\" WHERE (id = 11)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_file_delete/11"}
{"level":"warn","status":405,"method":"POST","path":"/admin-api/v3/prepare_file_delete/11","ip":"","latency":69.0896,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Error #01: operation not supported\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 2)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/2"}
{"level":"warn","status":405,"method":"POST","path":"/admin-api/v3/prepare_object_delete/2","ip":"","latency":70.500932,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Error #01: operation not supported\n"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 1)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"intellectual_object_view\".\"id\", \"intellectual_object_view\".\"title\", \"intellectual_object_view\".\"description\", \"intellectual_object_view\".\"identifier\", \"intellectual_object_view\".\"alt_identifier\", \"intellectual_object_view\".\"access\", \"intellectual_object_view\".\"bag_name\", \"intellectual_object_view\".\"institution_id\", \"intellectual_object_view\".\"created_at\", \"intellectual_object_view\".\"updated_at\", \"intellectual_object_view\".\"state\", \"intellectual_object_view\".\"etag\", \"intellectual_object_view\".\"bag_group_identifier\", \"intellectual_object_view\".\"storage_option\", \"intellectual_object_view\".\"bagit_profile_identifier\", \"intellectual_object_view\".\"source_organization\", \"intellectual_object_view\".\"internal_sender_identifier\", \"intellectual_object_view\".\"internal_sender_description\", \"intellectual_object_view\".\"institution_name\", \"intellectual_object_view\".\"institution_identifier\", \"intellectual_object_view\".\"institution_type\", \"intellectual_object_view\".\"institution_parent_id\", \"intellectual_object_view\".\"file_count\", \"intellectual_object_view\".\"size\", \"intellectual_object_view\".\"payload_file_count\", \"intellectual_object_view\".\"payload_size\" FROM \"intellectual_objects_view\" AS \"intellectual_object_view\" WHERE ((\"intellectual_object_view\".\"id\" = 1))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/objects/show/1","ip":"","latency":71.515109,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE ((\"intellectual_object\".\"identifier\" = 'institution1.edu/photos'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 1)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"intellectual_object_view\".\"id\", \"intellectual_object_view\".\"title\", \"intellectual_object_view\".\"description\", \"intellectual_object_view\".\"identifier\", \"intellectual_object_view\".\"alt_identifier\", \"intellectual_object_view\".\"access\", \"intellectual_object_view\".\"bag_name\", \"intellectual_object_view\".\"institution_id\", \"intellectual_object_view\".\"created_at\", \"intellectual_object_view\".\"updated_at\", \"intellectual_object_view\".\"state\", \"intellectual_object_view\".\"etag\", \"intellectual_object_view\".\"bag_group_identifier\", \"intellectual_object_view\".\"storage_option\", \"intellectual_object_view\".\"bagit_profile_identifier\", \"intellectual_object_view\".\"source_organization\", \"intellectual_object_view\".\"internal_sender_identifier\", \"intellectual_object_view\".\"internal_sender_description\", \"intellectual_object_view\".\"institution_name\", \"intellectual_object_view\".\"institution_identifier\", \"intellectual_object_view\".\"institution_type\", \"intellectual_object_view\".\"institution_parent_id\", \"intellectual_object_view\".\"file_count\", \"intellectual_object_view\".\"size\", \"intellectual_object_view\".\"payload_file_count\", \"intellectual_object_view\".\"payload_size\" FROM \"intellectual_objects_view\" AS \"intellectual_object_view\" WHERE ((\"intellectual_object_view\".\"id\" = 1))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/objects/show/institution1.edu/photos","ip":"","latency":70.648284,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:35-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.IntellectualObjectShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/objects/show/*id, Request Path: /admin-api/v3/objects/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/objects/show/1","ip":"","latency":1.007238,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"intellectual_object_view\".\"id\", \"intellectual_object_view\".\"title\", \"intellectual_object_view\".\"description\", \"intellectual_object_view\".\"identifier\", \"intellectual_object_view\".\"alt_identifier\", \"intellectual_object_view\".\"access\", \"intellectual_object_view\".\"bag_name\", \"intellectual_object_view\".\"institution_id\", \"intellectual_object_view\".\"created_at\", \"intellectual_object_view\".\"updated_at\", \"intellectual_object_view\".\"state\", \"intellectual_object_view\".\"etag\", \"intellectual_object_view\".\"bag_group_identifier\", \"intellectual_object_view\".\"storage_option\", \"intellectual_object_view\".\"bagit_profile_identifier\", \"intellectual_object_view\".\"source_organization\", \"intellectual_object_view\".\"internal_sender_identifier\", \"intellectual_object_view\".\"internal_sender_description\", \"intellectual_object_view\".\"institution_name\", \"intellectual_object_view\".\"institution_identifier\", \"intellectual_object_view\".\"institution_type\", \"intellectual_object_view\".\"institution_parent_id\", \"intellectual_object_view\".\"file_count\", \"intellectual_object_view\".\"size\", \"intellectual_object_view\".\"payload_file_count\", \"intellectual_object_view\".\"payload_size\" FROM \"intellectual_objects_view\" AS \"intellectual_object_view\" ORDER BY \"updated_at\" desc LIMIT 5 OFFSET 5"}
{"level":"info","time":"2022-06-22T13:30:35-04:00","message":"TypeName (1): IntellectualObjectView"}
{"level":"info","time":"2022-06-22T13:30:35-04:00","message":"API: Using view to count query ''"}
{"level":"info","time":"2022-06-22T13:30:35-04:00","message":"TypeName (1): IntellectualObjectView"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"row_count\" FROM \"intellectual_object_counts\" AS \"intellectual_object_count\" WHERE ((institution_id is null) AND (state is null))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/objects?page=2&per_page=5","ip":"","latency":73.742677,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:35-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.IntellectualObjectIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/objects, Request Path: /admin-api/v3/objects, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/objects?page=2&per_page=5","ip":"","latency":1.320616,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/create/4"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: INSERT INTO \"intellectual_objects\" (\"id\", \"created_at\", \"updated_at\", \"title\", \"description\", \"identifier\", \"alt_identifier\", \"access\", \"bag_name\", \"institution_id\", \"state\", \"etag\", \"bag_group_identifier\", \"storage_option\", \"bagit_profile_identifier\", \"source_organization\", \"internal_sender_identifier\", \"internal_sender_description\") VALUES (DEFAULT, '2022-06-22 17:30:35.903784+00:00:00', '2022-06-22 17:30:35.903784+00:00:00', 'bluetooth context-sensitive vortals', 'We need to navigate the online FTP array!', 'test.edu/Pollutionsucceed', 'Chicken', 'institution', 'auxiliary.tar', 4, 'A', 'bd7c3245d1f041e68beea1fdea5ff173', 'committee', 'Standard', 'https://example.com/profile.json', 'Test University', 'Butterball', 'Skateboard franzen franzen trust fund hashtag truffaut humblebrag kinfolk raw denim helvetica typewriter meggings.') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/objects/create/4","ip":"","latency":75.075841,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 15)"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/update/15"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 15))"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: UPDATE \"intellectual_objects\" AS \"intellectual_object\" SET \"created_at\" = '2022-06-22 17:30:35.903784+00:00:00', \"updated_at\" = '2022-06-22 17:30:35.979627+00:00:00', \"title\" = 'Updated Title', \"description\" = 'We need to navigate the online FTP array!', \"identifier\" = 'test.edu/Pollutionsucceed', \"alt_identifier\" = 'Chicken', \"access\" = 'consortia', \"bag_name\" = 'auxiliary.tar', \"institution_id\" = 4, \"state\" = 'A', \"etag\" = 'UpdatedETag', \"bag_group_identifier\" = 'committee', \"storage_option\" = 'Standard', \"bagit_profile_identifier\" = 'https://example.com/profile.json', \"source_organization\" = 'Test University', \"internal_sender_identifier\" = 'Butterball', \"internal_sender_description\" = 'Skateboard franzen franzen trust fund hashtag truffaut humblebrag kinfolk raw denim helvetica typewriter meggings.' WHERE \"intellectual_object\".\"id\" = 15"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"PUT","path":"/admin-api/v3/objects/update/15","ip":"","latency":75.245347,"user-agent":"","time":"2022-06-22T13:30:35-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:35-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 15)"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/prepare_object_delete/15"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 15))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((institution_id = 4) AND (role = 'institutional_admin') AND (\"user\".\"deactivated_at\" is null)) LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:36.056858+00:00:00', '2022-06-22 17:30:36.056888+00:00:00', 'Chicken', '2022-06-22 17:30:36.056858+00:00:00', 'Field recover replace end.', 'ingestion', DEFAULT, 'fa6f38c6-bade-4a4c-881d-e6711b742e4a', 4, 15, 'Spokesman team use add.', DEFAULT, 'Framework defend hide offence exhibition.', 'Sierra Nevada Bigfoot Barleywine Style Ale', 'GetRaised') RETURNING \"id\", \"generic_file_id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: INSERT INTO \"work_items\" (\"id\", \"created_at\", \"updated_at\", \"name\", \"etag\", \"institution_id\", \"intellectual_object_id\", \"generic_file_id\", \"bucket\", \"user\", \"note\", \"action\", \"stage\", \"status\", \"outcome\", \"bag_date\", \"date_processed\", \"retry\", \"node\", \"pid\", \"needs_admin_review\", \"queued_at\", \"size\", \"stage_started_at\", \"aptrust_approver\", \"inst_approver\") VALUES (DEFAULT, '2022-06-22 17:30:36.058872+00:00:00', '2022-06-22 17:30:36.058885+00:00:00', 'auxiliary.tar', '2bced493068440719280fa8b57220ac0', 4, 15, DEFAULT, 'blah.receiving.blah', 'admin@test.edu', 'This item was created by the factory', 'Delete', 'Requested', 'Started', 'Outcome? WTF?', '2022-02-22 17:30:36.058872+00:00:00', '2022-06-22 17:30:36.058872+00:00:00', TRUE, DEFAULT, DEFAULT, FALSE, '2022-06-22 17:30:36.058872+00:00:00', 381381263607617032, DEFAULT, DEFAULT, 'admin@test.edu') RETURNING \"id\", \"generic_file_id\", \"node\", \"pid\", \"stage_started_at\", \"aptrust_approver\""}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 8))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 8))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: INSERT INTO \"deletion_requests\" (\"id\", \"institution_id\", \"requested_by_id\", \"requested_at\", \"encrypted_confirmation_token\", \"confirmed_by_id\", \"confirmed_at\", \"cancelled_by_id\", \"cancelled_at\", \"work_item_id\") VALUES (DEFAULT, 4, 8, '2022-06-22 17:30:36.060627+00:00:00', '$2a$10$780NA0So2YUtZ3b9KfMF0.Oj24Q7Fb/nL7iUVYDTxO4g/sTBQq4pS', 8, '2022-06-22 17:30:36.060627+00:00:00', DEFAULT, DEFAULT, 33) RETURNING \"id\", \"cancelled_by_id\", \"cancelled_at\""}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: insert into deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id) values (4, 15) on conflict do nothing"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"POST","path":"/admin-api/v3/prepare_object_delete/15","ip":"","latency":156.32424,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"intellectual_objects\" AS \"intellectual_object\" WHERE (id = 15)"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/delete/15"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 15))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT 1 FROM \"generic_files\" AS \"generic_file\" WHERE (intellectual_object_id = 15 and state = 'A') LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((intellectual_object_id = 15) AND (event_type = 'ingestion') AND (generic_file_id is null)) ORDER BY \"created_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((intellectual_object_id = 15) AND (event_type = 'deletion') AND (generic_file_id is null)) ORDER BY \"created_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"work_item\".\"id\", \"work_item\".\"created_at\", \"work_item\".\"updated_at\", \"work_item\".\"name\", \"work_item\".\"etag\", \"work_item\".\"institution_id\", \"work_item\".\"intellectual_object_id\", \"work_item\".\"generic_file_id\", \"work_item\".\"bucket\", \"work_item\".\"user\", \"work_item\".\"note\", \"work_item\".\"action\", \"work_item\".\"stage\", \"work_item\".\"status\", \"work_item\".\"outcome\", \"work_item\".\"bag_date\", \"work_item\".\"date_processed\", \"work_item\".\"retry\", \"work_item\".\"node\", \"work_item\".\"pid\", \"work_item\".\"needs_admin_review\", \"work_item\".\"queued_at\", \"work_item\".\"size\", \"work_item\".\"stage_started_at\", \"work_item\".\"aptrust_approver\", \"work_item\".\"inst_approver\" FROM \"work_items\" AS \"work_item\" WHERE ((intellectual_object_id = 15) AND (generic_file_id is null) AND (action = 'Delete') AND (status = 'Started')) ORDER BY \"updated_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"deletion_request_view\".\"id\", \"deletion_request_view\".\"institution_id\", \"deletion_request_view\".\"institution_name\", \"deletion_request_view\".\"institution_identifier\", \"deletion_request_view\".\"requested_by_id\", \"deletion_request_view\".\"requested_by_name\", \"deletion_request_view\".\"requested_by_email\", \"deletion_request_view\".\"requested_at\", \"deletion_request_view\".\"confirmed_by_id\", \"deletion_request_view\".\"confirmed_by_name\", \"deletion_request_view\".\"confirmed_by_email\", \"deletion_request_view\".\"confirmed_at\", \"deletion_request_view\".\"cancelled_by_id\", \"deletion_request_view\".\"cancelled_by_name\", \"deletion_request_view\".\"cancelled_by_email\", \"deletion_request_view\".\"cancelled_at\", \"deletion_request_view\".\"file_count\", \"deletion_request_view\".\"object_count\", \"deletion_request_view\".\"work_item_id\", \"deletion_request_view\".\"stage\", \"deletion_request_view\".\"status\", \"deletion_request_view\".\"date_processed\", \"deletion_request_view\".\"size\", \"deletion_request_view\".\"note\" FROM \"deletion_requests_view\" AS \"deletion_request_view\" WHERE ((work_item_id = 33) AND (object_count > 0) AND (file_count = 0))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"work_item\".\"id\", \"work_item\".\"created_at\", \"work_item\".\"updated_at\", \"work_item\".\"name\", \"work_item\".\"etag\", \"work_item\".\"institution_id\", \"work_item\".\"intellectual_object_id\", \"work_item\".\"generic_file_id\", \"work_item\".\"bucket\", \"work_item\".\"user\", \"work_item\".\"note\", \"work_item\".\"action\", \"work_item\".\"stage\", \"work_item\".\"status\", \"work_item\".\"outcome\", \"work_item\".\"bag_date\", \"work_item\".\"date_processed\", \"work_item\".\"retry\", \"work_item\".\"node\", \"work_item\".\"pid\", \"work_item\".\"needs_admin_review\", \"work_item\".\"queued_at\", \"work_item\".\"size\", \"work_item\".\"stage_started_at\", \"work_item\".\"aptrust_approver\", \"work_item\".\"inst_approver\" FROM \"work_items\" AS \"work_item\" WHERE ((intellectual_object_id = 15) AND (generic_file_id is null) AND (action = 'Delete') AND (status = 'Started')) ORDER BY \"updated_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"deletion_request_view\".\"id\", \"deletion_request_view\".\"institution_id\", \"deletion_request_view\".\"institution_name\", \"deletion_request_view\".\"institution_identifier\", \"deletion_request_view\".\"requested_by_id\", \"deletion_request_view\".\"requested_by_name\", \"deletion_request_view\".\"requested_by_email\", \"deletion_request_view\".\"requested_at\", \"deletion_request_view\".\"confirmed_by_id\", \"deletion_request_view\".\"confirmed_by_name\", \"deletion_request_view\".\"confirmed_by_email\", \"deletion_request_view\".\"confirmed_at\", \"deletion_request_view\".\"cancelled_by_id\", \"deletion_request_view\".\"cancelled_by_name\", \"deletion_request_view\".\"cancelled_by_email\", \"deletion_request_view\".\"cancelled_at\", \"deletion_request_view\".\"file_count\", \"deletion_request_view\".\"object_count\", \"deletion_request_view\".\"work_item_id\", \"deletion_request_view\".\"stage\", \"deletion_request_view\".\"status\", \"deletion_request_view\".\"date_processed\", \"deletion_request_view\".\"size\", \"deletion_request_view\".\"note\" FROM \"deletion_requests_view\" AS \"deletion_request_view\" WHERE ((work_item_id = 33) AND (object_count > 0) AND (file_count = 0))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: UPDATE \"intellectual_objects\" AS \"intellectual_object\" SET \"created_at\" = '2022-06-22 17:30:35.903784+00:00:00', \"updated_at\" = '2022-06-22 17:30:36.217169+00:00:00', \"title\" = 'Updated Title', \"description\" = 'We need to navigate the online FTP array!', \"identifier\" = 'test.edu/Pollutionsucceed', \"alt_identifier\" = 'Chicken', \"access\" = 'consortia', \"bag_name\" = 'auxiliary.tar', \"institution_id\" = 4, \"state\" = 'D', \"etag\" = 'UpdatedETag', \"bag_group_identifier\" = 'committee', \"storage_option\" = 'Standard', \"bagit_profile_identifier\" = 'https://example.com/profile.json', \"source_organization\" = 'Test University', \"internal_sender_identifier\" = 'Butterball', \"internal_sender_description\" = 'Skateboard franzen franzen trust fund hashtag truffaut humblebrag kinfolk raw denim helvetica typewriter meggings.' WHERE \"intellectual_object\".\"id\" = 15"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:36.220495+00:00:00', '2022-06-22 17:30:36.220495+00:00:00', 'APTrust preservation services', '2022-06-22 17:30:36.220476+00:00:00', 'Object deleted from preservation storage', 'deletion', DEFAULT, 'e3719eb4-8e4c-48e1-9c6f-6f6032ddc129', 4, 15, 'Minio S3 library', DEFAULT, 'Success', 'admin@test.edu', 'Object deleted at the request of admin@test.edu. Institutional approver: admin@test.edu.') RETURNING \"id\", \"generic_file_id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"DELETE","path":"/admin-api/v3/objects/delete/15","ip":"","latency":84.874702,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 15))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE ((intellectual_object_id = 15) AND (event_type = 'deletion') AND (generic_file_id is null)) ORDER BY \"created_at\" desc LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.IntellectualObjectCreate, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/objects/create/:institution_id, Request Path: /admin-api/v3/objects/create/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/create/2"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/objects/create/2","ip":"","latency":1.101868,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.IntellectualObjectCreate, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/objects/create/:institution_id, Request Path: /admin-api/v3/objects/create/2, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/create/2"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/objects/create/2","ip":"","latency":1.001967,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/middleware.CSRF.func1, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: , Request Path: /admin-api/v3/objects/update/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/update/1"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/objects/update/1","ip":"","latency":1.489637,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/middleware.CSRF.func1, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: , Request Path: /admin-api/v3/objects/update/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/update/1"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/objects/update/1","ip":"","latency":1.012248,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((\"intellectual_object\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 2))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/middleware.CSRF.func1, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: , Request Path: /admin-api/v3/objects/delete/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/delete/1"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/objects/delete/1","ip":"","latency":1.228766,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 3))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/middleware.CSRF.func1, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: , Request Path: /admin-api/v3/objects/delete/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/objects/delete/1"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/objects/delete/1","ip":"","latency":1.050249,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"warn","time":"2022-06-22T13:30:36-04:00","message":"Forcing storage option back to 'Glacier-Deep-OR' on IntellectualObject 0 ()"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 21) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (21)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (21)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (21))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/events/create"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:36.237295+00:00:00', '2022-06-22 17:30:36.306055+00:00:00', 'Llama', '2022-06-22 17:30:36.237295+00:00:00', 'Reflect square star exercise.', 'ingestion', 21, 'c04d6cea-cfd8-47c4-853e-75fbff9ae0ba', 4, 7, 'Vote select death window.', DEFAULT, 'Win want white travel exercise.', 'Trappistes Rochefort 8', 'optiGov') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/events/create","ip":"","latency":70.334013,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst1.edu'))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PremisEventCreate, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/events/create, Request Path: /admin-api/v3/events/create, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/events/create"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/events/create","ip":"","latency":70.866244,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst1.edu'))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User user@inst1.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PremisEventCreate, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/events/create, Request Path: /admin-api/v3/events/create, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/events/create"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/events/create","ip":"","latency":68.754443,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'admin@inst2.edu'))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PremisEventCreate, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/events/create, Request Path: /admin-api/v3/events/create, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/events/create"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/events/create","ip":"","latency":68.477155,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'user@inst2.edu'))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User user@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.PremisEventCreate, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/events/create, Request Path: /admin-api/v3/events/create, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/events/create"}
{"level":"warn","status":403,"method":"POST","path":"/admin-api/v3/events/create","ip":"","latency":68.466508,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 21) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (21)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (21)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (21))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/events/create"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: INSERT INTO \"premis_events\" (\"id\", \"created_at\", \"updated_at\", \"agent\", \"date_time\", \"detail\", \"event_type\", \"generic_file_id\", \"identifier\", \"institution_id\", \"intellectual_object_id\", \"object\", \"old_uuid\", \"outcome\", \"outcome_detail\", \"outcome_information\") VALUES (DEFAULT, '2022-06-22 17:30:36.587514+00:00:00', '2022-06-22 17:30:36.659923+00:00:00', 'Horse', '2022-06-22 17:30:36.587511+00:00:00', 'Revenue commit realise drive.', 'fixity check', 21, 'd9a6cc0f-9bde-4a4f-84e9-adbceb5ab0a1', 4, 7, 'Seem lift parent tradition.', DEFAULT, 'Language right base detail future.', 'Westmalle Trappist Tripel', 'Sophic Systems Alliance') RETURNING \"id\", \"old_uuid\""}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 21) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (21)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (21)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (21))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: UPDATE \"generic_files\" AS \"generic_file\" SET \"created_at\" = '2020-08-26 15:26:41+00:00:00', \"updated_at\" = '2022-06-22 17:30:36.664807+00:00:00', \"file_format\" = 'application/json', \"size\" = 20471, \"identifier\" = 'test.edu/btr-512-test-restore/data/sample.json', \"intellectual_object_id\" = 7, \"state\" = 'A', \"last_fixity_check\" = '2022-06-22 17:30:36.587511+00:00:00', \"institution_id\" = 4, \"storage_option\" = 'Standard', \"uuid\" = '669e2c86-b3e0-4a46-8e24-811d526c1ec0' WHERE \"generic_file\".\"id\" = 21"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/events/create","ip":"","latency":78.437859,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 21) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (21)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (21)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (21))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((id = 1))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"generic_file\".\"institution_id\" AS \"generic_file__institution_id\" FROM \"storage_records\" AS \"storage_record\" LEFT JOIN \"generic_files\" AS \"generic_file\" ON \"generic_file\".\"id\" = \"storage_record\".\"generic_file_id\" WHERE (\"storage_record\".\"id\" = 1)"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((id = 1))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/storage_records/show/1","ip":"","latency":1.840547,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.StorageRecordShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/storage_records/show/:id, Request Path: /admin-api/v3/storage_records/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/storage_records/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/storage_records/show/1","ip":"","latency":0.915497,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.StorageRecordShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/storage_records/show/:id, Request Path: /admin-api/v3/storage_records/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/storage_records/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/storage_records/show/1","ip":"","latency":0.939992,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 1))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = '1')) ORDER BY \"id\" asc LIMIT 1"}
{"level":"info","time":"2022-06-22T13:30:36-04:00","message":"TypeName (1): StorageRecord"}
{"level":"info","time":"2022-06-22T13:30:36-04:00","message":"Cannot query count view for type StorageRecord: type is not supported for view count"}
{"level":"info","time":"2022-06-22T13:30:36-04:00","message":"API: Using standard count query for '(generic_file_id = ?)'"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT count(*) FROM \"storage_records\" AS \"storage_record\" WHERE ((generic_file_id = '1'))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/storage_records?generic_file_id=1&page=1&per_page=1&sort=id__asc","ip":"","latency":2.071027,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.StorageRecordIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/storage_records, Request Path: /admin-api/v3/storage_records, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/storage_records"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/storage_records","ip":"","latency":0.99143,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:36-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/admin.StorageRecordIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/storage_records, Request Path: /admin-api/v3/storage_records, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/storage_records"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/storage_records","ip":"","latency":1.387275,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 12) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (12)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (12)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (12))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"IsAPIRoute - YES - /admin-api/v3/storage_records/create/3"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"generic_file\".\"id\", \"generic_file\".\"created_at\", \"generic_file\".\"updated_at\", \"generic_file\".\"file_format\", \"generic_file\".\"size\", \"generic_file\".\"identifier\", \"generic_file\".\"intellectual_object_id\", \"generic_file\".\"state\", \"generic_file\".\"last_fixity_check\", \"generic_file\".\"institution_id\", \"generic_file\".\"storage_option\", \"generic_file\".\"uuid\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\", \"intellectual_object\".\"id\" AS \"intellectual_object__id\", \"intellectual_object\".\"created_at\" AS \"intellectual_object__created_at\", \"intellectual_object\".\"updated_at\" AS \"intellectual_object__updated_at\", \"intellectual_object\".\"title\" AS \"intellectual_object__title\", \"intellectual_object\".\"description\" AS \"intellectual_object__description\", \"intellectual_object\".\"identifier\" AS \"intellectual_object__identifier\", \"intellectual_object\".\"alt_identifier\" AS \"intellectual_object__alt_identifier\", \"intellectual_object\".\"access\" AS \"intellectual_object__access\", \"intellectual_object\".\"bag_name\" AS \"intellectual_object__bag_name\", \"intellectual_object\".\"institution_id\" AS \"intellectual_object__institution_id\", \"intellectual_object\".\"state\" AS \"intellectual_object__state\", \"intellectual_object\".\"etag\" AS \"intellectual_object__etag\", \"intellectual_object\".\"bag_group_identifier\" AS \"intellectual_object__bag_group_identifier\", \"intellectual_object\".\"storage_option\" AS \"intellectual_object__storage_option\", \"intellectual_object\".\"bagit_profile_identifier\" AS \"intellectual_object__bagit_profile_identifier\", \"intellectual_object\".\"source_organization\" AS \"intellectual_object__source_organization\", \"intellectual_object\".\"internal_sender_identifier\" AS \"intellectual_object__internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\" AS \"intellectual_object__internal_sender_description\" FROM \"generic_files\" AS \"generic_file\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"generic_file\".\"institution_id\" LEFT JOIN \"intellectual_objects\" AS \"intellectual_object\" ON \"intellectual_object\".\"id\" = \"generic_file\".\"intellectual_object_id\" WHERE (generic_file.id = 12) ORDER BY \"generic_file\".\"id\" LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"premis_event\".\"id\", \"premis_event\".\"created_at\", \"premis_event\".\"updated_at\", \"premis_event\".\"agent\", \"premis_event\".\"date_time\", \"premis_event\".\"detail\", \"premis_event\".\"event_type\", \"premis_event\".\"generic_file_id\", \"premis_event\".\"identifier\", \"premis_event\".\"institution_id\", \"premis_event\".\"intellectual_object_id\", \"premis_event\".\"object\", \"premis_event\".\"old_uuid\", \"premis_event\".\"outcome\", \"premis_event\".\"outcome_detail\", \"premis_event\".\"outcome_information\" FROM \"premis_events\" AS \"premis_event\" WHERE (\"premis_event\".\"generic_file_id\" IN (12)) ORDER BY \"premis_event\".\"date_time\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"checksum\".\"id\", \"checksum\".\"created_at\", \"checksum\".\"updated_at\", \"checksum\".\"algorithm\", \"checksum\".\"datetime\", \"checksum\".\"digest\", \"checksum\".\"generic_file_id\" FROM \"checksums\" AS \"checksum\" WHERE (\"checksum\".\"generic_file_id\" IN (12)) ORDER BY \"checksum\".\"created_at\" desc"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE (\"storage_record\".\"generic_file_id\" IN (12))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: INSERT INTO \"storage_records\" (\"id\", \"generic_file_id\", \"url\") VALUES (DEFAULT, 12, 'https://example.com/bucket/unit-test-record') RETURNING \"id\""}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/storage_records/create/3","ip":"","latency":78.213077,"user-agent":"","time":"2022-06-22T13:30:36-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: SELECT \"storage_record\".\"id\", \"storage_record\".\"generic_file_id\", \"storage_record\".\"url\" FROM \"storage_records\" AS \"storage_record\" WHERE ((id = 89))"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"ar_internal_metadata\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"bulk_delete_jobs_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"confirmation_tokens\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"emails\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"emails_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"emails_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"emails_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"emails_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"old_passwords\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"schema_migrations\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"snapshots\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"usage_samples\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"alerts_work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"alerts_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"alerts_premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"alerts\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"deletion_requests_intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"deletion_requests\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"work_items\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"premis_events\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"storage_records\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"checksums\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"generic_files\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"intellectual_objects\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"roles_users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"users\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"institutions\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"roles\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: drop table if exists \"storage_options\" cascade"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:36-04:00","message":"Starting SQL: --\n-- schema.sql\n--\n-- This file represents the full registry schema.\n--\n-- The migrations.sql file updates the old Pharos schema, as it existed\n-- in the feature/storage_record branch, so that it matches this schema.\n--\n-- https://github.com/APTrust/pharos/blob/feature/storage-record/db/schema.rb\n--\n\n\n-- public.ar_internal_metadata definition\n--\n-- This is a legacy table used by ActiveRecord.\n-- We can drop this once production is stable.\n--\nCREATE TABLE public.ar_internal_metadata (\n\t\"key\" varchar NOT NULL,\n\tvalue varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT ar_internal_metadata_pkey PRIMARY KEY (key)\n);\n\n\n-- public.bulk_delete_jobs definition\n--\n-- This is the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs (\n\tid bigserial NOT NULL,\n\trequested_by varchar NULL,\n\tinstitutional_approver varchar NULL,\n\taptrust_approver varchar NULL,\n\tinstitutional_approval_at timestamp NULL,\n\taptrust_approval_at timestamp NULL,\n\tnote text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id int4 NOT NULL,\n\tCONSTRAINT bulk_delete_jobs_pkey PRIMARY KEY (id)\n);\n\n\n-- public.bulk_delete_jobs_emails definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_emails (\n\tbulk_delete_job_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_emails_on_bulk_delete_job_id ON public.bulk_delete_jobs_emails USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_emails_on_email_id ON public.bulk_delete_jobs_emails USING btree (email_id);\n\n\n-- public.bulk_delete_jobs_generic_files definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_generic_files (\n\tbulk_delete_job_id int8 NULL,\n\tgeneric_file_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_bulk_delete_job_id ON public.bulk_delete_jobs_generic_files USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_generic_files_on_generic_file_id ON public.bulk_delete_jobs_generic_files USING btree (generic_file_id);\n\n\n-- public.bulk_delete_jobs_institutions definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_institutions (\n\tbulk_delete_job_id int8 NULL,\n\tinstitution_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_bulk_delete_job_id ON public.bulk_delete_jobs_institutions USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_institutions_on_institution_id ON public.bulk_delete_jobs_institutions USING btree (institution_id);\n\n\n-- public.bulk_delete_jobs_intellectual_objects definition\n--\n-- Related to the legacy bulk delete table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.bulk_delete_jobs_intellectual_objects (\n\tbulk_delete_job_id int8 NULL,\n\tintellectual_object_id int8 NULL\n);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_bulk_job_id ON public.bulk_delete_jobs_intellectual_objects USING btree (bulk_delete_job_id);\nCREATE INDEX index_bulk_delete_jobs_intellectual_objects_on_object_id ON public.bulk_delete_jobs_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.confirmation_tokens definition\n--\n-- This is a legacy table. We can likely delete it\n-- after production is stable.\n--\nCREATE TABLE public.confirmation_tokens (\n\tid bigserial NOT NULL,\n\t\"token\" varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tuser_id int4 NULL,\n\tCONSTRAINT confirmation_tokens_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails definition\n--\n-- This legacy table will be replaced by the new alerts table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails (\n\tid bigserial NOT NULL,\n\temail_type varchar NULL,\n\tevent_identifier varchar NULL,\n\titem_id int4 NULL,\n\temail_text text NULL,\n\tuser_list text NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tinstitution_id int4 NULL,\n\tCONSTRAINT emails_pkey PRIMARY KEY (id)\n);\n\n\n-- public.emails_generic_files definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_generic_files (\n\tgeneric_file_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_generic_files_on_email_id ON public.emails_generic_files USING btree (email_id);\nCREATE INDEX index_emails_generic_files_on_generic_file_id ON public.emails_generic_files USING btree (generic_file_id);\n\n\n-- public.emails_intellectual_objects definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_intellectual_objects (\n\tintellectual_object_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_intellectual_objects_on_email_id ON public.emails_intellectual_objects USING btree (email_id);\nCREATE INDEX index_emails_intellectual_objects_on_intellectual_object_id ON public.emails_intellectual_objects USING btree (intellectual_object_id);\n\n\n-- public.emails_premis_events definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_premis_events (\n\tpremis_event_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_premis_events_on_email_id ON public.emails_premis_events USING btree (email_id);\nCREATE INDEX index_emails_premis_events_on_premis_event_id ON public.emails_premis_events USING btree (premis_event_id);\n\n\n-- public.emails_work_items definition\n--\n-- Related to the legacy emails table.\n-- We should eventually archive this, but keep the\n-- data somewhere for historical and audit purposes.\n--\nCREATE TABLE public.emails_work_items (\n\twork_item_id int8 NULL,\n\temail_id int8 NULL\n);\nCREATE INDEX index_emails_work_items_on_email_id ON public.emails_work_items USING btree (email_id);\nCREATE INDEX index_emails_work_items_on_work_item_id ON public.emails_work_items USING btree (work_item_id);\n\n\n-- public.generic_files definition\nCREATE TABLE public.generic_files (\n\tid serial NOT NULL,\n\tfile_format varchar NULL,\n\t\"size\" int8 NULL,\n\tidentifier varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tlast_fixity_check timestamp NOT NULL DEFAULT '2000-01-01 00:00:00'::timestamp without time zone,\n\tinstitution_id int4 NOT NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tuuid varchar NOT NULL,\n\tCONSTRAINT generic_files_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_generic_files_on_created_at ON public.generic_files USING btree (created_at);\nCREATE UNIQUE INDEX index_generic_files_on_identifier ON public.generic_files USING btree (identifier);\nCREATE INDEX index_generic_files_on_institution_id ON public.generic_files USING btree (institution_id);\nCREATE INDEX index_generic_files_on_institution_id_and_state ON public.generic_files USING btree (institution_id, state);\nCREATE INDEX index_generic_files_on_institution_id_and_updated_at ON public.generic_files USING btree (institution_id, updated_at);\nCREATE INDEX index_generic_files_on_intellectual_object_id ON public.generic_files USING btree (intellectual_object_id);\nCREATE INDEX index_generic_files_on_updated_at ON public.generic_files USING btree (updated_at);\nCREATE UNIQUE INDEX index_generic_files_on_uuid ON public.generic_files USING btree (uuid);\nCREATE INDEX ix_gf_last_fixity_check ON public.generic_files USING btree (last_fixity_check);\n\n\n-- public.institutions definition\nCREATE TABLE public.institutions (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\tidentifier varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\t\"type\" varchar NULL,\n\tmember_institution_id int4 NULL,\n\tdeactivated_at timestamp NULL,\n\totp_enabled bool NULL,\n    enable_spot_restore bool not null default false,\n\treceiving_bucket varchar NOT NULL,\n\trestore_bucket varchar NOT NULL,\n\tCONSTRAINT institutions_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_institutions_on_name ON public.institutions USING btree (name);\n\n\n-- public.intellectual_objects definition\nCREATE TABLE public.intellectual_objects (\n\tid serial NOT NULL,\n\ttitle varchar NULL,\n\tdescription text NULL,\n\tidentifier varchar NULL,\n\talt_identifier varchar NULL,\n\t\"access\" varchar NULL,\n\tbag_name varchar NULL,\n\tinstitution_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tstate varchar NULL,\n\tetag varchar NULL,\n\tbag_group_identifier varchar NULL,\n\tstorage_option varchar NOT NULL DEFAULT 'Standard'::character varying,\n\tbagit_profile_identifier varchar NULL,\n\tsource_organization varchar NULL,\n\tinternal_sender_identifier varchar NULL,\n\tinternal_sender_description text NULL,\n\tCONSTRAINT intellectual_objects_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_intellectual_objects_on_bag_name ON public.intellectual_objects USING btree (bag_name);\nCREATE INDEX index_intellectual_objects_on_created_at ON public.intellectual_objects USING btree (created_at);\nCREATE UNIQUE INDEX index_intellectual_objects_on_identifier ON public.intellectual_objects USING btree (identifier);\nCREATE INDEX index_intellectual_objects_on_institution_id ON public.intellectual_objects USING btree (institution_id);\nCREATE INDEX index_intellectual_objects_on_updated_at ON public.intellectual_objects USING btree (updated_at);\n\n\n-- public.old_passwords definition\n--\n-- This is a legacy table. We can get rid of this if we\n-- abandon mandatory password changes. Wait until that's\n-- decided.\n--\nCREATE TABLE public.old_passwords (\n\tid bigserial NOT NULL,\n\tencrypted_password varchar NOT NULL,\n\tpassword_salt varchar NULL,\n\tpassword_archivable_type varchar NOT NULL,\n\tpassword_archivable_id int4 NOT NULL,\n\tcreated_at timestamp NULL,\n\tCONSTRAINT old_passwords_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_password_archivable ON public.old_passwords USING btree (password_archivable_type, password_archivable_id);\n\n\n-- public.premis_events definition\nCREATE TABLE public.premis_events (\n\tid serial NOT NULL,\n\tidentifier varchar NULL,\n\tevent_type varchar NULL,\n\tdate_time varchar NULL,\n\toutcome_detail varchar NULL,\n\tdetail varchar NULL,\n\toutcome_information varchar NULL,\n\t\"object\" varchar NULL,\n\tagent varchar NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\toutcome varchar NULL,\n\tinstitution_id int4 NULL,\n\told_uuid varchar NULL,\n\tCONSTRAINT premis_events_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_premis_events_date_time_desc ON public.premis_events USING btree (date_time DESC);\nCREATE INDEX index_premis_events_on_event_type ON public.premis_events USING btree (event_type);\nCREATE INDEX index_premis_events_on_event_type_and_outcome ON public.premis_events USING btree (event_type, outcome);\nCREATE INDEX index_premis_events_on_generic_file_id ON public.premis_events USING btree (generic_file_id);\nCREATE UNIQUE INDEX index_premis_events_on_identifier ON public.premis_events USING btree (identifier);\nCREATE INDEX index_premis_events_on_institution_id ON public.premis_events USING btree (institution_id);\nCREATE INDEX index_premis_events_on_intellectual_object_id ON public.premis_events USING btree (intellectual_object_id);\nCREATE INDEX index_premis_events_on_outcome ON public.premis_events USING btree (outcome);\n\n\n-- public.schema_migrations definition\n--\n-- This is a legacy table used by ActiveRecord\n-- to track which migrations have been applied.\n--\n-- We can delete this when production is stable.\n--\nCREATE TABLE public.schema_migrations (\n\t\"version\" varchar NOT NULL,\n\tCONSTRAINT schema_migrations_pkey PRIMARY KEY (version)\n);\n\n\n-- public.snapshots definition\n--\n-- This table stores point-in-time snapshots\n-- of how much data each depositor has in the repo.\n--\n-- We may eventually delete this, but keep for now.\n--\nCREATE TABLE public.snapshots (\n\tid bigserial NOT NULL,\n\taudit_date timestamp NULL,\n\tinstitution_id int4 NULL,\n\tapt_bytes int8 NULL,\n\t\"cost\" numeric NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tsnapshot_type varchar NULL,\n\tcs_bytes int8 NULL,\n\tgo_bytes int8 NULL,\n\tCONSTRAINT snapshots_pkey PRIMARY KEY (id)\n);\n\n\n-- public.usage_samples definition\n--\n-- No idea what this was supposed to be, but the\n-- table never had any data in the production DB.\n-- Consider deleting this after we're sure it's not used.\n--\nCREATE TABLE public.usage_samples (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tinstitution_id varchar NULL,\n\t\"data\" text NULL,\n\tCONSTRAINT usage_samples_pkey PRIMARY KEY (id)\n);\n\n\n-- public.work_items definition\nCREATE TABLE public.work_items (\n\tid serial NOT NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tintellectual_object_id int4 NULL,\n\tgeneric_file_id int4 NULL,\n\t\"name\" varchar NULL,\n\tetag varchar NULL,\n\tbucket varchar NULL,\n\t\"user\" varchar NULL,\n\tnote text NULL,\n\t\"action\" varchar NULL,\n\tstage varchar NULL,\n\tstatus varchar NULL,\n\toutcome text NULL,\n\tbag_date timestamp NULL,\n\tdate_processed timestamp NULL,\n\tretry bool NOT NULL DEFAULT false,\n\tnode varchar(255) NULL,\n\tpid int4 NULL DEFAULT 0,\n\tneeds_admin_review bool NOT NULL DEFAULT false,\n\tinstitution_id int4 NULL,\n\tqueued_at timestamp NULL,\n\t\"size\" int8 NULL,\n\tstage_started_at timestamp NULL,\n\taptrust_approver varchar NULL,\n\tinst_approver varchar NULL,\n\tCONSTRAINT work_items_pkey PRIMARY KEY (id)\n);\nCREATE INDEX index_work_items_on_action ON public.work_items USING btree (action);\nCREATE INDEX index_work_items_on_date ON public.work_items USING btree (date_processed);\nCREATE INDEX index_work_items_on_etag_and_name ON public.work_items USING btree (etag, name);\nCREATE INDEX index_work_items_on_generic_file_id ON public.work_items USING btree (generic_file_id);\nCREATE INDEX index_work_items_on_institution_id ON public.work_items USING btree (institution_id);\nCREATE INDEX index_work_items_on_institution_id_and_date ON public.work_items USING btree (institution_id, date_processed);\nCREATE INDEX index_work_items_on_intellectual_object_id ON public.work_items USING btree (intellectual_object_id);\nCREATE INDEX index_work_items_on_stage ON public.work_items USING btree (stage);\nCREATE INDEX index_work_items_on_status ON public.work_items USING btree (status);\n\n\n-- public.checksums definition\nCREATE TABLE public.checksums (\n\tid serial NOT NULL,\n\talgorithm varchar NULL,\n\tdatetime timestamp NULL,\n\tdigest varchar NULL,\n\tgeneric_file_id int4 NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tCONSTRAINT checksums_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_89bb0866e7 FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_checksums_on_generic_file_id ON public.checksums USING btree (generic_file_id);\n\n\n-- public.storage_records definition\nCREATE TABLE public.storage_records (\n\tid bigserial NOT NULL,\n\tgeneric_file_id int4 NULL,\n\turl varchar NULL,\n\tCONSTRAINT storage_records_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_a126ea6adc FOREIGN KEY (generic_file_id) REFERENCES generic_files(id)\n);\nCREATE INDEX index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\n\n-- public.users definition\nCREATE TABLE public.users (\n\tid serial NOT NULL,\n\t\"name\" varchar NULL,\n\temail varchar NULL,\n\tphone_number varchar NULL,\n\tcreated_at timestamp NOT NULL,\n\tupdated_at timestamp NOT NULL,\n\tencrypted_password varchar NOT NULL DEFAULT ''::character varying,\n\treset_password_token varchar NULL,\n\treset_password_sent_at timestamp NULL,\n\tremember_created_at timestamp NULL,\n\tsign_in_count int4 NOT NULL DEFAULT 0,\n\tcurrent_sign_in_at timestamp NULL,\n\tlast_sign_in_at timestamp NULL,\n\tcurrent_sign_in_ip varchar NULL,\n\tlast_sign_in_ip varchar NULL,\n\tinstitution_id int4 NULL,\n\tencrypted_api_secret_key text NULL,\n\tpassword_changed_at timestamp NULL,\n\tencrypted_otp_secret varchar NULL,\n\tencrypted_otp_secret_iv varchar NULL,\n\tencrypted_otp_secret_salt varchar NULL,\n    encrypted_otp_sent_at timestamp NULL,\n\tconsumed_timestep int4 NULL,\n\totp_required_for_login bool NULL,\n\tdeactivated_at timestamp NULL,\n\tenabled_two_factor bool NULL DEFAULT false,\n\tconfirmed_two_factor bool NULL DEFAULT false,\n\totp_backup_codes _varchar NULL,\n\tauthy_id varchar NULL,\n\tlast_sign_in_with_authy timestamp NULL,\n\tauthy_status varchar NULL,\n\temail_verified bool NULL DEFAULT false,\n\tinitial_password_updated bool NULL DEFAULT false,\n\tforce_password_update bool NULL DEFAULT false,\n\taccount_confirmed bool NULL DEFAULT true,\n\tgrace_period timestamp NULL,\n    awaiting_second_factor boolean not null default false,\n    \"role\" varchar(50) NOT NULL default 'none',\n\tCONSTRAINT users_pkey PRIMARY KEY (id),\n\tCONSTRAINT fk_rails_7fcf39ca13 FOREIGN KEY (institution_id) REFERENCES institutions(id)\n);\nCREATE INDEX index_users_on_authy_id ON public.users USING btree (authy_id);\nCREATE UNIQUE INDEX index_users_on_email ON public.users USING btree (email);\nCREATE INDEX index_users_on_institution_id ON public.users USING btree (institution_id);\nCREATE INDEX index_users_on_password_changed_at ON public.users USING btree (password_changed_at);\nCREATE UNIQUE INDEX index_users_on_reset_password_token ON public.users USING btree (reset_password_token);\n\n-------------------------------------------------------------------------------\n-- New tables that were not part of Pharos.\n-- alerts              + join tables\n-- deletion_requests   + join tables\n-------------------------------------------------------------------------------\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index index_alerts_institution_id ON public.alerts (institution_id);\ncreate index index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table public.alerts_users (\n    alert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table public.alerts_work_items (\n    alert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index index_storage_options_name ON public.storage_options (\"name\");\n\n\n\n-------------------------------------------------------------------------------\n-- Functions\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: -- migrations.sql\n--\n-- This file contains ALL alterations that should be applied to the\n-- existing Pharos DB schema (as it exists in the feature/storage-option\n-- branch) to make it match schema.sql.\n--\n-- All operations in this file must be idempotent, so we can run it\n-- any number of times and always know that it will leave the DB in\n-- consistent and known state that matches schema.sql.\n--\n-- NOTE: When migrating old Pharos DB, we will also need to create the\n--       views in the schema.sql file.\n-------------------------------------------------------------------------------\n\n---------------------------------------------------------\n-- START OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n---------------------------------------------------------\n\n-- Drop legacy table from Pharos DB.\ndrop table if exists work_item_states;\n\n-- Create the storage_records table, with indexes.\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\tcreate table public.storage_records (\n    \tid bigserial not null,\n    \tgeneric_file_id int8 not null,\n    \turl varchar not null,\n    \tconstraint storage_records_pkey primary key (id),\n    \tconstraint fk_rails_a126ea6adc foreign key (generic_file_id) references generic_files(id)\n\t);\n\tcreate index if not exists index_storage_records_on_generic_file_id ON public.storage_records USING btree (generic_file_id);\n\tcreate unique index if not exists index_storage_records_on_url ON public.storage_records(\"url\");\n  end if;\nend\n$$;\n\n-- Add column generic_files.uuid.\nalter table generic_files add column if not exists \"uuid\" varchar;\n\n-- Copy uuid from uri into uuid field.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\tupdate generic_files set uuid=split_part(uri, '/', 5);\n  end if;\nend\n$$;\n\n-- Change generic_files.uuid to not null and add a unique index.\ndo\n$$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uuid' and is_nullable = 'YES') then\n  \talter table generic_files alter column \"uuid\" set not null;\n\tcreate unique index if not exists index_generic_files_on_uuid on generic_files(uuid);\n  end if;\nend\n$$;\n\n-- Copy generic_files.uri from storage_records.url.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='generic_files' AND column_name='uri') then\n\n  \t  -- Get the intial URL. All items, regadless of storage option, have one URL.\n      -- The inner if statement makes sure this hasn't already run. (Prevents duplicate inserts.)\n\t  if exists (select 1 from information_schema.columns where table_schema='public' AND table_name='storage_records') then\n\t    if not exists (select 1 from storage_records where length(url) > 0) then\n\t\t  insert into storage_records (generic_file_id, url) select id, uri from generic_files gf order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- For items in standard storage, we need to add a Glacier URL. URLs differ per environment, so we check.\n\t  -- In each case, the inner if statement tries to ensure that these inserts have not already run.\n\n\t  -- Production\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.preservation.storage/', '/aptrust.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.preservation.storage/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Test/Demo\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.test.preservation.oregon/%') then\n\t      insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.test.preservation/', '/aptrust.test.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.test.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n\t  -- Staging\n\t  if exists (select 1 from generic_files gf where uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%') then\n\t    if not exists (select 1 from storage_records where url like 'https://s3.amazonaws.com/aptrust.staging.preservation.oregon/%') then\n\t\t  insert into storage_records(generic_file_id, url)\n\t\t  select gf.id, replace(uri, '/aptrust.staging.preservation/', '/aptrust.staging.preservation.oregon/') from generic_files gf\n\t\t  where gf.uri like 'https://s3.amazonaws.com/aptrust.staging.preservation/%' order by gf.id;\n\t\tend if;\n\t  end if;\n\n  end if;\nend\n$$;\n\n-- Now remove generic_files.uri, since the data is now in storage_records\nalter table generic_files drop column if exists uri;\n\n-------------------------------------------------------\n-- END OF PHAROS MASTER -> STORAGE RECORD MIGRATIONS --\n-------------------------------------------------------\n\n-- The premis_events.date_time column is varchar, but it should be\n-- timestamp. We need to change it. This change may fail if 1) there\n-- are invalid or badly formatted dates in the date_time column, or\n-- 2) if any views referencing premis_events.date_time already exist.\n-- Drop premis_events_view if necessary and recreate it after this alteration.\n--\n-- This change may take a long time, as premis_events has over 100M rows.\ndo\n$$\nbegin\n\tif exists(\n\t\tselect 1 from information_schema.columns\n\t\twhere table_schema = 'public'\n\t\tand table_name = 'premis_events'\n\t\tand column_name = 'date_time'\n\t\tand data_type = 'character varying')\n\tthen\n\t\talter table premis_events alter column date_time type timestamp\n\t\tusing TO_TIMESTAMP(date_time, 'YYYY-MM-DDTHH24:MI:SS');\n\tend if;\nend\n$$;\n\n-- We need to fix the user role structure. Pharos allows a user to have\n-- multiple roles at a single institution, though our business rules disallow\n-- that, and no user has ever had more than one role. To simplify the DB\n-- and our queries, we need to do the following:\n--\n-- 1. Create a role column in the users table.\n-- 2. Populate that column with the value with each user's role from\n--    user -> roles_user -> roles.\n-- 3. Drop the roles_users table.\n-- 4. Drop the roles table.\n\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='role') then\n \talter table users add column \"role\" varchar(50) not null default 'none';\n \tupdate users u set \"role\" = coalesce((select r.name from \"roles\" r inner join roles_users ru on ru.role_id = r.id where ru.user_id = u.id), 'none');\n    drop table if exists roles_users;\n    drop table if exists roles;\n  end if;\nend\n$$;\n\n-- Add awaiting_second_factor\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='awaiting_second_factor') then\n \talter table users add column \"awaiting_second_factor\" boolean not null default false;\n  end if;\nend\n$$;\n\n-- Add encrypted_otp_sent_at\ndo $$\nbegin\n  if not exists (select 1 from information_schema.columns where table_schema='public' AND table_name='users' AND column_name='encrypted_otp_sent_at') then\n \talter table users add column \"encrypted_otp_sent_at\" timestamp null;\n  end if;\nend\n$$;\n\n\n-- The ingest_state columns were part of a proposed architecture we never\n-- implemented. They have never been used, and we don't need them.\nalter table intellectual_objects drop column if exists ingest_state;\nalter table generic_files drop column if exists ingest_state;\n\n\n-- intellectual_objects.bag_group_identifier is almost always empty.\n-- Make this column nullable to ease inserts.\nalter table intellectual_objects alter column bag_group_identifier drop not null;\n\n\n-- Remove object_identifier and generic_file_identifier from work_items.\n-- We can use a view to join the files & objects tables, avoiding the\n-- duplicate data.\nalter table work_items drop column if exists object_identifier;\nalter table work_items drop column if exists generic_file_identifier;\n\n-- The work_items.date column actually refers to the datetime on which\n-- the item was last processed by one of our Go workers. The name \"date\"\n-- is too vague and ambiguous, so let's call it what it is.\ndo $$\nbegin\n  if exists (select 1 from information_schema.columns\n    where table_schema='public' AND table_name='work_items' AND column_name='date') then\n    alter table work_items rename column \"date\" to \"date_processed\";\n  end if;\nend\n$$;\n\n-- Update the indexes on work_items to reflect the change from date to\n-- date_processed.\n\ndrop index if exists index_work_items_on_date;\ndrop index if exists index_work_items_on_institution_id_and_date;\n\ncreate index if not exists index_work_items_on_date_processed on work_items(date_processed);\ncreate index if not exists index_work_items_on_inst_id_and_date_processed on work_items(institution_id, date_processed);\n\n-- These columns are unnecessary in the premis_events table.\n-- We can get them by joining other tables in a view.\n-- This will have a large impact on storage space, since these\n-- two fields together average ~100 bytes per record, and as of\n-- Jan. 2021, we have around 120M records. Dropping these columns\n-- also drops the indexes on these two columns, which are huge and\n-- are rarely used.\nalter table premis_events drop column if exists intellectual_object_identifier;\nalter table premis_events drop column if exists generic_file_identifier;\n\n-- Get rid of useless indexes. We can add these back if they actually turn\n-- out to be useful.\n--\n-- generic_files\ndrop index if exists index_files_on_inst_state_and_format;\ndrop index if exists index_files_on_inst_state_and_updated;\ndrop index if exists index_generic_files_on_file_format;\ndrop index if exists index_generic_files_on_file_format_and_state;\ndrop index if exists index_generic_files_on_institution_id_and_size_and_state;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_file_format;\ndrop index if exists index_generic_files_on_intellectual_object_id_and_state;\ndrop index if exists index_generic_files_on_size;\ndrop index if exists index_generic_files_on_size_and_state;\ndrop index if exists index_generic_files_on_state;\ndrop index if exists index_generic_files_on_state_and_updated_at;\n\n-- intellectual_objects\ndrop index if exists index_intellectual_objects_on_access;\ndrop index if exists index_intellectual_objects_on_institution_id_and_state;\ndrop index if exists index_intellectual_objects_on_state;\n\n-- premis_events\ndrop index if exists index_premis_events_on_generic_file_id_and_event_type;\ndrop index if exists index_premis_events_on_identifier_and_institution_id;\n\n-- institutions\ncreate unique index if not exists index_institutions_identifier on institutions using btree(identifier);\ncreate unique index if not exists index_institutions_receiving_bucket on institutions using btree(receiving_bucket);\ncreate unique index if not exists index_institutions_restore_bucket on institutions using btree(restore_bucket);\n\n-- Allow institutions to turn spot restoration tests on or off.\n-- Default is off.\nalter table institutions add column if not exists enable_spot_restore boolean not null default false;\n\n-- ********************************************************************\n--\n-- Add tables for alerts and deletions that did not exist in Pharos\n--\n-- ********************************************************************\n\n-- deletion_requests track requests for file and object deletions,\n-- who initiated them and who approved them\ncreate table if not exists public.deletion_requests (\n\tid bigserial primary key,\n\tinstitution_id integer not null references public.institutions(id),\n\trequested_by_id integer not null references public.users(id),\n\trequested_at timestamp not null,\n\tencrypted_confirmation_token varchar not null,\n\tconfirmed_by_id integer references public.users(id),\n\tconfirmed_at timestamp,\n\tcancelled_by_id integer references public.users(id),\n\tcancelled_at timestamp,\n    work_item_id integer null references public.work_items(id)\n);\ncreate index if not exists index_deletion_requests_institution_id ON public.deletion_requests (institution_id);\n\n\n-- deletion_requests_generic_files records which files belong to a deletion request\ncreate table if not exists public.deletion_requests_generic_files (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tgeneric_file_id integer not null references public.generic_files(id)\n);\ncreate unique index if not exists index_drgf_unique ON public.deletion_requests_generic_files (deletion_request_id, generic_file_id);\n\n-- deletion_requests_intellectual_objects records which objects belong to a deletion request\ncreate table if not exists public.deletion_requests_intellectual_objects (\n\tdeletion_request_id integer not null references public.deletion_requests(id),\n\tintellectual_object_id integer not null references public.intellectual_objects(id)\n);\ncreate unique index if not exists index_drio_unique ON public.deletion_requests_intellectual_objects (deletion_request_id, intellectual_object_id);\n\n\n-- alerts stores the content of alert messages. These messages appear in the web UI\n-- and may also be emailed to users, depending on the alert type.\n-- Column deletion_request_id will typically be null.\ncreate table if not exists public.alerts (\n\tid bigserial primary key,\n\tinstitution_id integer references public.institutions(id),\n\t\"type\" varchar not null,\n    \"subject\" varchar not null,\n\t\"content\" text not null,\n\tdeletion_request_id integer references public.deletion_requests(id),\n\tcreated_at timestamp not null\n);\ncreate index if not exists index_alerts_institution_id ON public.alerts (institution_id);\ncreate index if not exists index_alerts_type ON public.alerts (\"type\");\n\n\n-- alerts_users tracks which users should see which alerts. Depending on alert.type,\n-- the message may be emailed to the user (for example, a deletion approval alert),\n-- or it may simply be displayed in the web UI.\ncreate table if not exists public.alerts_users (\n\talert_id integer not null references public.alerts(id),\n\tuser_id integer not null references public.users(id),\n\tsent_at timestamp default null,\n\tread_at timestamp default null\n);\ncreate index if not exists index_alerts_users_alert_id ON public.alerts_users (alert_id);\ncreate index if not exists index_alerts_users_user_id ON public.alerts_users (user_id);\ncreate unique index if not exists index_alerts_users_unique ON public.alerts_users (alert_id, user_id);\n\n\n-- alerts_work_items link an alerts to one or more work items.\ncreate table if not exists public.alerts_work_items (\n\talert_id integer not null references public.alerts(id),\n\twork_item_id integer not null references public.work_items(id)\n);\ncreate index if not exists index_alerts_work_items_alert_id ON public.alerts_work_items (alert_id);\ncreate unique index if not exists index_alerts_work_items_unique ON public.alerts_work_items (alert_id, work_item_id);\n\n\n-- alerts_premis_events link alerts to one or more premis_events.\ncreate table if not exists public.alerts_premis_events (\n\talert_id integer not null references public.alerts(id),\n\tpremis_event_id integer not null references public.premis_events(id)\n);\ncreate index if not exists index_alerts_premis_events_alert_id ON public.alerts_premis_events(alert_id);\ncreate unique index if not exists index_alerts_premis_events_unique ON public.alerts_premis_events(alert_id, premis_event_id);\n\n\n-- storage_options contains info about storage options that we use\n-- to calculate monthly bills.\ncreate table if not exists public.storage_options (\n\tid bigserial primary key,\n\t\"provider\" varchar not null,\n    \"service\" varchar not null,\n    \"region\" varchar not null,\n    \"name\" varchar not null,\n    cost_gb_per_month decimal(12,8) not null,\n    \"comment\" varchar not null,\n\tupdated_at timestamp not null\n);\ncreate unique index if not exists index_storage_options_name ON public.storage_options (\"name\");\n\n-- In Pharos DB, many generic_file_ids in premis_events are set to zero when they should be null.\n-- Fix that here.\nupdate premis_events set generic_file_id = null where generic_file_id = 0;\n\n-- In Pharos, the Devise auth system leaves stale password reset data forever.\n-- We have to clear these values in Registry, or all users will be stuck in\n-- the \"please finish resetting your password\" loop forever. We have no idea\n-- what reset tokens Devise sent two years ago, so no one will be able to\n-- unlock their accounts.\nupdate users set reset_password_token = null, reset_password_sent_at = null;\n\n\n-------------------------------------------------------------------------------\n-- Functions\n--\n-- Fuctions are defined in schema.sql as well. Adding them to migrations\n-- ensures they'll be present in converted DB.\n-------------------------------------------------------------------------------\n\nCREATE OR REPLACE FUNCTION create_constraint_if_not_exists (t_name text, c_name text, constraint_sql text)\n  RETURNS void\nAS\n$BODY$\n  begin\n    -- Look for our constraint\n    if not exists (select constraint_name\n                   from information_schema.constraint_column_usage\n                   where table_name = t_name  and constraint_name = c_name) then\n        execute 'ALTER TABLE ' || t_name || ' ADD CONSTRAINT ' || c_name || ' ' || constraint_sql;\n    end if;\nend;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: -------------------------------------------------------------------------------\n-- Views\n-------------------------------------------------------------------------------\n\n-- Create a view to pull in columns that used to be in the WorkItems table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view work_items_view as\nselect\n\twi.id,\n\twi.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\twi.intellectual_object_id,\n\tio.identifier as \"object_identifier\",\n\tio.alt_identifier,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\twi.generic_file_id,\n\tgf.identifier as \"generic_file_identifier\",\n\twi.\"name\",\n\twi.etag,\n\twi.bucket,\n\twi.\"user\",\n\twi.note,\n\twi.\"action\",\n\twi.stage,\n\twi.status,\n\twi.outcome,\n\twi.bag_date,\n\twi.date_processed,\n\twi.retry,\n\twi.node,\n\twi.pid,\n\twi.needs_admin_review,\n\twi.\"size\",\n\twi.queued_at,\n\twi.stage_started_at,\n\twi.aptrust_approver,\n\twi.inst_approver,\n\twi.created_at,\n\twi.updated_at\nfrom work_items wi\nleft join institutions i on wi.institution_id = i.id\nleft join intellectual_objects io on wi.intellectual_object_id = io.id\nleft join generic_files gf on wi.generic_file_id = gf.id;\n\n\n-- Create a view to pull in columns that used to be in the PremisEvents table.\n-- These include intellectual_object_identifier and generic_file_identifier.\ncreate or replace view premis_events_view as\nselect\n\tpe.id,\n\tpe.identifier,\n\tpe.institution_id,\n\ti.\"name\" as institution_name,\n\tpe.intellectual_object_id,\n\tio.identifier as intellectual_object_identifier,\n\tpe.generic_file_id,\n\tgf.identifier as generic_file_identifier,\n\tpe.event_type,\n\tpe.date_time,\n\tpe.detail,\n\tpe.outcome,\n\tpe.outcome_detail,\n\tpe.outcome_information,\n\tpe.\"object\",\n\tpe.agent,\n\tpe.created_at,\n\tpe.updated_at,\n\tpe.old_uuid\nfrom premis_events pe\nleft join institutions i on pe.institution_id = i.id\nleft join intellectual_objects io on pe.intellectual_object_id = io.id\nleft join generic_files gf on pe.generic_file_id = gf.id;\n\n\n-- users_view makes it easier to list and search on institution-related\n-- attributes for users.\ncreate or replace view users_view as\nselect\n\tu.id,\n\tu.\"name\",\n\tu.email,\n\tu.phone_number,\n\tu.created_at,\n\tu.updated_at,\n\tu.reset_password_sent_at,\n\tu.remember_created_at,\n\tu.sign_in_count,\n\tu.current_sign_in_at,\n\tu.last_sign_in_at,\n\tu.current_sign_in_ip,\n\tu.last_sign_in_ip,\n\tu.institution_id,\n\tu.password_changed_at,\n\tu.consumed_timestep,\n\tu.otp_required_for_login,\n\tu.deactivated_at,\n\tu.enabled_two_factor,\n\tu.confirmed_two_factor,\n\tu.authy_id,\n\tu.last_sign_in_with_authy,\n\tu.authy_status,\n\tu.email_verified,\n\tu.initial_password_updated,\n\tu.force_password_update,\n\tu.account_confirmed,\n\tu.grace_period,\n\tu.\"role\",\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.state as institution_state,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id,\n\ti2.\"name\" as member_institution_name,\n\ti2.identifier as member_institution_identifier,\n\ti2.state as member_institution_state,\n\ti.otp_enabled,\n\ti.receiving_bucket,\n\ti.restore_bucket\nfrom users u\nleft join institutions i on u.institution_id = i.id\nleft join institutions i2 on i.member_institution_id = i2.id;\n\n\n-- institutions_view shows an institution along with essential\n-- information about its parent, if it has a parent.\n\ncreate or replace view institutions_view as\nselect\n\ti.id,\n\ti.\"name\",\n\ti.identifier,\n\ti.state,\n\ti.\"type\",\n\ti.deactivated_at,\n\ti.otp_enabled,\n\ti.enable_spot_restore,\n\ti.receiving_bucket,\n\ti.restore_bucket,\n\ti.created_at,\n\ti.updated_at,\n\ti.member_institution_id as \"parent_id\",\n\tparent.\"name\" as \"parent_name\",\n\tparent.identifier as \"parent_identifier\",\n\tparent.state as \"parent_state\",\n\tparent.deactivated_at as \"parent_deactivated_at\"\nfrom institutions i\nleft join institutions parent on i.member_institution_id = parent.id;\n\n-- intellectual_objects_view\n\ncreate or replace view intellectual_objects_view as\nselect\n\tio.id,\n\tio.title,\n\tio.description,\n\tio.identifier,\n\tio.alt_identifier,\n\tio.access,\n\tio.bag_name,\n\tio.institution_id,\n\tio.state,\n\tio.etag,\n\tio.bag_group_identifier,\n\tio.storage_option,\n\tio.bagit_profile_identifier,\n\tio.source_organization,\n\tio.internal_sender_identifier,\n\tio.internal_sender_description,\n\tio.created_at,\n\tio.updated_at,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ti.\"type\" as institution_type,\n\ti.member_institution_id as institution_parent_id,\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A') as \"size\",\n\t(select count(*) from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_file_count\",\n\t(select sum(gf.\"size\") from generic_files gf where gf.intellectual_object_id = io.id and gf.state = 'A' and identifier like concat(io.identifier, '/data/%')) as \"payload_size\"\nfrom intellectual_objects io\nleft join institutions i on io.institution_id = i.id;\n\n-- deletion_requests_view\n\ncreate or replace view deletion_requests_view as\nselect dr.id,\n       dr.institution_id,\n       i.\"name\" as institution_name,\n       i.identifier as institution_identifier,\n       dr.requested_by_id,\n       req.\"name\" as requested_by_name,\n       req.email as requested_by_email,\n       dr.requested_at,\n       dr.confirmed_by_id,\n       conf.\"name\" as confirmed_by_name,\n       conf.email as confirmed_by_email,\n       dr.confirmed_at,\n       dr.cancelled_by_id,\n       can.\"name\" as cancelled_by_name,\n       can.email as cancelled_by_email,\n       dr.cancelled_at,\n       (select count(*) from deletion_requests_generic_files drgf where drgf.deletion_request_id = dr.id) as file_count,\n       (select count(*) from deletion_requests_intellectual_objects drio where drio.deletion_request_id = dr.id) as object_count,\n       dr.work_item_id,\n       wi.stage,\n       wi.status,\n       wi.date_processed,\n       wi.\"size\",\n       wi.note\nfrom deletion_requests dr\nleft join institutions i on dr.institution_id = i.id\nleft join users req on dr.requested_by_id = req.id\nleft join users conf on dr.confirmed_by_id = conf.id\nleft join users can on dr.confirmed_by_id = can.id\nleft join work_items wi on dr.work_item_id = wi.id;\n\n-- alerts view\n\ncreate or replace view alerts_view as\nselect\n\ta.id,\n\ta.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\ta.\"type\",\n\ta.subject,\n\ta.\"content\",\n\ta.deletion_request_id,\n\ta.created_at,\n\tau.user_id,\n\tu.\"name\" as user_name,\n\tau.sent_at,\n\tau.read_at\nfrom alerts a\nleft join alerts_users au on a.id = au.alert_id\nleft join users u on au.user_id = u.id\nleft join institutions i on a.institution_id = i.id;\n\n-- storage_option_stats\ncreate or replace view storage_option_stats as\nwith stats as (\n\tselect\n\t\tsum(\"gf\".\"size\") as total_bytes,\n\t\tcount(*) as file_count,\n\t\tgf.institution_id,\n\t\tgf.storage_option\n\tfrom generic_files gf\n\twhere gf.state = 'A'\n\tgroup by rollup (gf.institution_id, gf.storage_option)\n\t)\nselect\n\ts.total_bytes,\n\ts.file_count,\n\ts.institution_id,\n\ts.storage_option,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier\nfrom stats s\nleft join institutions i on s.institution_id = i.id;\n\ncreate or replace view generic_files_view as\nselect\n\tgf.id,\n\tgf.file_format,\n\tgf.\"size\",\n\tgf.identifier,\n\tgf.intellectual_object_id,\n\tio.identifier as object_identifier,\n\tio.\"access\",\n\tgf.state,\n\tgf.last_fixity_check,\n\tgf.institution_id,\n\ti.\"name\" as institution_name,\n\ti.identifier as institution_identifier,\n\tgf.storage_option,\n\tgf.uuid,\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='md5' order by created_at desc limit 1) as \"md5\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha1' order by created_at desc limit 1) as \"sha1\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha256' order by created_at desc limit 1) as \"sha256\",\n\t(select digest from checksums where generic_file_id = gf.id and algorithm='sha512' order by created_at desc limit 1) as \"sha512\",\n\tgf.created_at,\n\tgf.updated_at\nfrom generic_files gf\nleft join intellectual_objects io on io.id = gf.intellectual_object_id\nleft join institutions i on i.id = gf.institution_id;\n\n-- Checksums view\ncreate or replace view checksums_view as\nselect cs.id,\n       cs.algorithm,\n       cs.datetime,\n       cs.digest,\n       gf.state,\n       gf.identifier as \"generic_file_identifier\",\n       cs.generic_file_id,\n       gf.intellectual_object_id,\n       gf.institution_id,\n       cs.created_at,\n       cs.updated_at\nfrom checksums cs\nleft join generic_files gf on cs.generic_file_id = gf.id;\n\n\n---------------------------------------------------------------------------\n--\n-- Count Views\n--\n-- We create these views because count queries on large tables are slow\n-- in postgres. Even if a query can use an index to get a count, it still\n-- has to scan every row in the result set to see if that row is visible\n-- under postgres' mvcc rules. \n--\n-- If the count returns a million rows, postgres has to scan all million\n-- rows. The result is a query that can take 5-15 seconds. The \n-- premis_events table is the worst of the lot. It should surpass 200M\n-- rows by the end of 2022. We do not want to scan those rows every time\n-- someone hits the events page or the events API endpoint.\n--\n-- We run count queries all the time to manage paging in both the web UI\n-- and the API. For large counts, such as \"all events for an institution\",\n-- or \"all files for an institution\", we'll use the counts in the views\n-- below. \n--\n-- For smaller counts, such as \"all files for my institution created \n-- within the past week\", we'll suck it up and let postgres scan the \n-- smaller row sets.\n--\n-- These views will be refreshed every hour or so using an async go \n-- routine so they don't slow down web and API requests.\n--\n-- That means some large counts may be up to an hour out of date, but we\n-- can live with that tradeoff, since this will vastly speed up the loading\n-- of our most commonly hit web and API endpoints.\n--\n-- Note the function update_counts() below. It refreshes all of the count\n-- views.\n-- \n---------------------------------------------------------------------------\n\n-- premis_event_counts\ncreate materialized view if not exists premis_event_counts as\n\tselect institution_id, count(id) as row_count, event_type, outcome\n\tfrom premis_events group by cube(institution_id, event_type, outcome)\n\torder by institution_id, event_type, outcome;\n\n-- intellectual_object_counts\ncreate materialized view if not exists intellectual_object_counts as\n\tselect institution_id, count(id) as row_count, \"state\" \n\tfrom intellectual_objects group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- generic_file_counts\ncreate materialized view if not exists generic_file_counts as\n\tselect institution_id, count(id) as row_count, \"state\"\n\tfrom generic_files group by cube(institution_id, \"state\")\n\torder by institution_id, state; \n\n-- work_item_counts\ncreate materialized view if not exists work_item_counts as\n\tselect institution_id, count(id) as row_count, \"action\"\n\tfrom work_items group by cube(institution_id, \"action\")\n\torder by institution_id, \"action\";\n\n-- \nCREATE OR REPLACE FUNCTION update_counts ()\n  RETURNS integer\nAS\n$BODY$\n  begin\n    refresh materialized view premis_event_counts;\n    refresh materialized view intellectual_object_counts;\n    refresh materialized view generic_file_counts;\n    refresh materialized view work_item_counts;    \n    return 1;\n  end;\n$BODY$\nLANGUAGE plpgsql VOLATILE;\n"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"storage_options\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_options.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"institutions\" from '/Users/diamond/aptrust/registry/db/fixtures/institutions.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"users\" from '/Users/diamond/aptrust/registry/db/fixtures/users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"checksums\" from '/Users/diamond/aptrust/registry/db/fixtures/checksums.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"storage_records\" from '/Users/diamond/aptrust/registry/db/fixtures/storage_records.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"deletion_requests\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"deletion_requests_generic_files\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_generic_files.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"deletion_requests_intellectual_objects\" from '/Users/diamond/aptrust/registry/db/fixtures/deletion_requests_intellectual_objects.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"alerts\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"alerts_premis_events\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_premis_events.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"alerts_users\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_users.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: copy \"alerts_work_items\" from '/Users/diamond/aptrust/registry/db/fixtures/alerts_work_items.csv' csv header"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_options', 'id'), MAX(id)) FROM \"storage_options\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('institutions', 'id'), MAX(id)) FROM \"institutions\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('users', 'id'), MAX(id)) FROM \"users\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('intellectual_objects', 'id'), MAX(id)) FROM \"intellectual_objects\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('generic_files', 'id'), MAX(id)) FROM \"generic_files\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('checksums', 'id'), MAX(id)) FROM \"checksums\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('storage_records', 'id'), MAX(id)) FROM \"storage_records\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('premis_events', 'id'), MAX(id)) FROM \"premis_events\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('work_items', 'id'), MAX(id)) FROM \"work_items\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('deletion_requests', 'id'), MAX(id)) FROM \"deletion_requests\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT setval(pg_get_serial_sequence('alerts', 'id'), MAX(id)) FROM \"alerts\";"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: select update_counts();"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"work_item\".\"id\", \"work_item\".\"created_at\", \"work_item\".\"updated_at\", \"work_item\".\"name\", \"work_item\".\"etag\", \"work_item\".\"institution_id\", \"work_item\".\"intellectual_object_id\", \"work_item\".\"generic_file_id\", \"work_item\".\"bucket\", \"work_item\".\"user\", \"work_item\".\"note\", \"work_item\".\"action\", \"work_item\".\"stage\", \"work_item\".\"status\", \"work_item\".\"outcome\", \"work_item\".\"bag_date\", \"work_item\".\"date_processed\", \"work_item\".\"retry\", \"work_item\".\"node\", \"work_item\".\"pid\", \"work_item\".\"needs_admin_review\", \"work_item\".\"queued_at\", \"work_item\".\"size\", \"work_item\".\"stage_started_at\", \"work_item\".\"aptrust_approver\", \"work_item\".\"inst_approver\" FROM \"work_items\" AS \"work_item\" WHERE ((id = 1))"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"work_items\" AS \"work_item\" WHERE (id = 1)"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" WHERE ((id = 1))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/items/show/1","ip":"","latency":78.206244,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:37-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.WorkItemShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/items/show/:id, Request Path: /admin-api/v3/items/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRoute - YES - /admin-api/v3/items/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/items/show/1","ip":"","latency":1.009069,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:37-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.WorkItemShow, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/items/show/:id, Request Path: /admin-api/v3/items/show/1, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRoute - YES - /admin-api/v3/items/show/1"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/items/show/1","ip":"","latency":1.059308,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" ORDER BY \"updated_at\" desc LIMIT 5 OFFSET 5"}
{"level":"info","time":"2022-06-22T13:30:37-04:00","message":"TypeName (1): WorkItemView"}
{"level":"info","time":"2022-06-22T13:30:37-04:00","message":"API: Using view to count query ''"}
{"level":"info","time":"2022-06-22T13:30:37-04:00","message":"TypeName (1): WorkItemView"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"row_count\" FROM \"work_item_counts\" AS \"work_item_count\" WHERE ((institution_id is null) AND (action is null))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/items?page=2&per_page=5","ip":"","latency":76.10229,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"work_item_view\".\"id\", \"work_item_view\".\"name\", \"work_item_view\".\"etag\", \"work_item_view\".\"institution_id\", \"work_item_view\".\"institution_name\", \"work_item_view\".\"institution_identifier\", \"work_item_view\".\"intellectual_object_id\", \"work_item_view\".\"object_identifier\", \"work_item_view\".\"alt_identifier\", \"work_item_view\".\"bag_group_identifier\", \"work_item_view\".\"storage_option\", \"work_item_view\".\"bagit_profile_identifier\", \"work_item_view\".\"source_organization\", \"work_item_view\".\"internal_sender_identifier\", \"work_item_view\".\"generic_file_id\", \"work_item_view\".\"generic_file_identifier\", \"work_item_view\".\"bucket\", \"work_item_view\".\"user\", \"work_item_view\".\"note\", \"work_item_view\".\"action\", \"work_item_view\".\"stage\", \"work_item_view\".\"status\", \"work_item_view\".\"outcome\", \"work_item_view\".\"bag_date\", \"work_item_view\".\"date_processed\", \"work_item_view\".\"retry\", \"work_item_view\".\"node\", \"work_item_view\".\"pid\", \"work_item_view\".\"needs_admin_review\", \"work_item_view\".\"queued_at\", \"work_item_view\".\"size\", \"work_item_view\".\"stage_started_at\", \"work_item_view\".\"aptrust_approver\", \"work_item_view\".\"inst_approver\", \"work_item_view\".\"created_at\", \"work_item_view\".\"updated_at\" FROM \"work_items_view\" AS \"work_item_view\" WHERE ((institution_id = '3')) ORDER BY \"updated_at\" desc LIMIT 20"}
{"level":"info","time":"2022-06-22T13:30:37-04:00","message":"TypeName (1): WorkItemView"}
{"level":"info","time":"2022-06-22T13:30:37-04:00","message":"API: Using view to count query '(institution_id = ?)'"}
{"level":"info","time":"2022-06-22T13:30:37-04:00","message":"TypeName (1): WorkItemView"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"row_count\" FROM \"work_item_counts\" AS \"work_item_count\" WHERE ((institution_id = '3') AND (action is null))"}
{"level":"info","status":200,"method":"GET","path":"/admin-api/v3/items?institution_id=3","ip":"","latency":72.889696,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:37-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.WorkItemIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/items, Request Path: /admin-api/v3/items, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRoute - YES - /admin-api/v3/items"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/items","ip":"","latency":1.367829,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"id\" = 5))"}
{"level":"error","time":"2022-06-22T13:30:37-04:00","message":"Not Authorized: User admin@inst2.edu, Remote IP: , Handler: github.com/APTrust/registry/web/api/common.WorkItemIndex, ResourceType: Forbidden, ResourceID: 0, InstID: 0, Gin Path: /admin-api/v3/items, Request Path: /admin-api/v3/items, Permission: , ResourceIdentifier:  , Error: non-admins must use the member api"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRoute - YES - /admin-api/v3/items"}
{"level":"warn","status":403,"method":"GET","path":"/admin-api/v3/items","ip":"","latency":0.993378,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"intellectual_object\".\"id\", \"intellectual_object\".\"created_at\", \"intellectual_object\".\"updated_at\", \"intellectual_object\".\"title\", \"intellectual_object\".\"description\", \"intellectual_object\".\"identifier\", \"intellectual_object\".\"alt_identifier\", \"intellectual_object\".\"access\", \"intellectual_object\".\"bag_name\", \"intellectual_object\".\"institution_id\", \"intellectual_object\".\"state\", \"intellectual_object\".\"etag\", \"intellectual_object\".\"bag_group_identifier\", \"intellectual_object\".\"storage_option\", \"intellectual_object\".\"bagit_profile_identifier\", \"intellectual_object\".\"source_organization\", \"intellectual_object\".\"internal_sender_identifier\", \"intellectual_object\".\"internal_sender_description\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"intellectual_objects\" AS \"intellectual_object\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"intellectual_object\".\"institution_id\" WHERE ((institution_id = 4)) LIMIT 1"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRoute - YES - /admin-api/v3/items/create/4"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: INSERT INTO \"work_items\" (\"id\", \"created_at\", \"updated_at\", \"name\", \"etag\", \"institution_id\", \"intellectual_object_id\", \"generic_file_id\", \"bucket\", \"user\", \"note\", \"action\", \"stage\", \"status\", \"outcome\", \"bag_date\", \"date_processed\", \"retry\", \"node\", \"pid\", \"needs_admin_review\", \"queued_at\", \"size\", \"stage_started_at\", \"aptrust_approver\", \"inst_approver\") VALUES (DEFAULT, '2022-06-22 17:30:37.688397+00:00:00', '2022-06-22 17:30:37.76075+00:00:00', 'btr-512-test-restore', 'cbc7eaa33d924128829420fdea2b3334', 4, 1, 1, 'blah.receiving.blah', 'someone@example.com', 'This item was created by the factory', 'Ingest', 'Requested', 'Pending', 'Outcome? WTF?', '2022-02-22 17:30:37.688397+00:00:00', '2022-06-22 17:30:37.688397+00:00:00', TRUE, DEFAULT, DEFAULT, FALSE, '2022-06-22 17:30:37.688397+00:00:00', 5899111791559184180, DEFAULT, DEFAULT, DEFAULT) RETURNING \"id\", \"node\", \"pid\", \"stage_started_at\", \"aptrust_approver\", \"inst_approver\""}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":201,"method":"POST","path":"/admin-api/v3/items/create/4","ip":"","latency":74.324567,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"user\".\"id\", \"user\".\"created_at\", \"user\".\"updated_at\", \"user\".\"name\", \"user\".\"email\", \"user\".\"phone_number\", \"user\".\"encrypted_password\", \"user\".\"reset_password_token\", \"user\".\"reset_password_sent_at\", \"user\".\"remember_created_at\", \"user\".\"sign_in_count\", \"user\".\"current_sign_in_at\", \"user\".\"last_sign_in_at\", \"user\".\"current_sign_in_ip\", \"user\".\"last_sign_in_ip\", \"user\".\"institution_id\", \"user\".\"encrypted_api_secret_key\", \"user\".\"password_changed_at\", \"user\".\"encrypted_otp_secret\", \"user\".\"encrypted_otp_secret_iv\", \"user\".\"encrypted_otp_secret_salt\", \"user\".\"encrypted_otp_sent_at\", \"user\".\"consumed_timestep\", \"user\".\"otp_required_for_login\", \"user\".\"deactivated_at\", \"user\".\"enabled_two_factor\", \"user\".\"confirmed_two_factor\", \"user\".\"otp_backup_codes\", \"user\".\"authy_id\", \"user\".\"last_sign_in_with_authy\", \"user\".\"authy_status\", \"user\".\"email_verified\", \"user\".\"initial_password_updated\", \"user\".\"force_password_update\", \"user\".\"grace_period\", \"user\".\"awaiting_second_factor\", \"user\".\"role\", \"institution\".\"id\" AS \"institution__id\", \"institution\".\"created_at\" AS \"institution__created_at\", \"institution\".\"updated_at\" AS \"institution__updated_at\", \"institution\".\"name\" AS \"institution__name\", \"institution\".\"identifier\" AS \"institution__identifier\", \"institution\".\"state\" AS \"institution__state\", \"institution\".\"type\" AS \"institution__type\", \"institution\".\"member_institution_id\" AS \"institution__member_institution_id\", \"institution\".\"deactivated_at\" AS \"institution__deactivated_at\", \"institution\".\"otp_enabled\" AS \"institution__otp_enabled\", \"institution\".\"enable_spot_restore\" AS \"institution__enable_spot_restore\", \"institution\".\"receiving_bucket\" AS \"institution__receiving_bucket\", \"institution\".\"restore_bucket\" AS \"institution__restore_bucket\" FROM \"users\" AS \"user\" LEFT JOIN \"institutions\" AS \"institution\" ON \"institution\".\"id\" = \"user\".\"institution_id\" WHERE ((\"user\".\"email\" = 'system@aptrust.org'))"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"institution_id\" FROM \"work_items\" AS \"work_item\" WHERE (id = 33)"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRequest - IsAPIAuthenticated: true"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"IsAPIRoute - YES - /admin-api/v3/items/update/33"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: SELECT \"work_item\".\"id\", \"work_item\".\"created_at\", \"work_item\".\"updated_at\", \"work_item\".\"name\", \"work_item\".\"etag\", \"work_item\".\"institution_id\", \"work_item\".\"intellectual_object_id\", \"work_item\".\"generic_file_id\", \"work_item\".\"bucket\", \"work_item\".\"user\", \"work_item\".\"note\", \"work_item\".\"action\", \"work_item\".\"stage\", \"work_item\".\"status\", \"work_item\".\"outcome\", \"work_item\".\"bag_date\", \"work_item\".\"date_processed\", \"work_item\".\"retry\", \"work_item\".\"node\", \"work_item\".\"pid\", \"work_item\".\"needs_admin_review\", \"work_item\".\"queued_at\", \"work_item\".\"size\", \"work_item\".\"stage_started_at\", \"work_item\".\"aptrust_approver\", \"work_item\".\"inst_approver\" FROM \"work_items\" AS \"work_item\" WHERE ((id = 33))"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: BEGIN"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: UPDATE \"work_items\" AS \"work_item\" SET \"created_at\" = '2022-06-22 17:30:37.688397+00:00:00', \"updated_at\" = '2022-06-22 17:30:37.834344+00:00:00', \"name\" = 'btr-512-test-restore', \"etag\" = 'cbc7eaa33d924128829420fdea2b3334', \"institution_id\" = 4, \"intellectual_object_id\" = 1, \"generic_file_id\" = 1, \"bucket\" = 'blah.receiving.blah', \"user\" = 'someone@example.com', \"note\" = 'This item was created by the factory', \"action\" = 'Ingest', \"stage\" = 'Requested', \"status\" = 'Pending', \"outcome\" = 'This outcome has been edited', \"bag_date\" = '2022-02-22 17:30:37.688397+00:00:00', \"date_processed\" = '2022-06-22 17:30:37.688397+00:00:00', \"retry\" = TRUE, \"node\" = NULL, \"pid\" = NULL, \"needs_admin_review\" = FALSE, \"queued_at\" = '2022-06-22 17:30:37.688397+00:00:00', \"size\" = 5899111791559184380, \"stage_started_at\" = NULL, \"aptrust_approver\" = NULL, \"inst_approver\" = NULL WHERE \"work_item\".\"id\" = 33"}
{"level":"debug","time":"2022-06-22T13:30:37-04:00","message":"Starting SQL: COMMIT"}
{"level":"info","status":200,"method":"PUT","path":"/admin-api/v3/items/update/33","ip":"","latency":72.763381,"user-agent":"","time":"2022-06-22T13:30:37-04:00","message":"Request"}
